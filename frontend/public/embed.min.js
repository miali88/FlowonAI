!function(){"use strict";!function(){var e="undefined"!=typeof window?window:this;function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n,i,r,o,a={exports:{}},s={},c={exports:{}},l={};function u(){if(n)return l;n=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),s=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var k=y.prototype=new b;k.constructor=y,m(k,v.prototype),k.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function E(t,n,i){var r,o={},a=null,s=null;if(null!=n)for(r in void 0!==n.ref&&(s=n.ref),void 0!==n.key&&(a=""+n.key),n)S.call(n,r)&&!C.hasOwnProperty(r)&&(o[r]=n[r]);var c=arguments.length-2;if(1===c)o.children=i;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}if(t&&t.defaultProps)for(r in c=t.defaultProps)void 0===o[r]&&(o[r]=c[r]);return{$$typeof:e,type:t,key:a,ref:s,props:o,_owner:T.current}}function P(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var x=/\/+/g;function R(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(n,i,r,o,a){var s=typeof n;"undefined"!==s&&"boolean"!==s||(n=null);var c=!1;if(null===n)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(n.$$typeof){case e:case t:c=!0}}if(c)return a=a(c=n),n=""===o?"."+R(c,0):o,w(a)?(r="",null!=n&&(r=n.replace(x,"$&/")+"/"),O(a,i,r,"",(function(e){return e}))):null!=a&&(P(a)&&(a=function(t,n){return{$$typeof:e,type:t.type,key:n,ref:t.ref,props:t.props,_owner:t._owner}}(a,r+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(x,"$&/")+"/")+n)),i.push(a)),1;if(c=0,o=""===o?".":o+":",w(n))for(var l=0;l<n.length;l++){var u=o+R(s=n[l],l);c+=O(s,i,r,u,a)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(n),"function"==typeof u)for(n=u.call(n),l=0;!(s=n.next()).done;)c+=O(s=s.value,i,r,u=o+R(s,l++),a);else if("object"===s)throw i=String(n),Error("Objects are not valid as a React child (found: "+("[object Object]"===i?"object with keys {"+Object.keys(n).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return c}function _(e,t,n){if(null==e)return e;var i=[],r=0;return O(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function I(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N={current:null},M={transition:null},D={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:M,ReactCurrentOwner:T};function L(){throw Error("act(...) is not supported in production builds of React.")}return l.Children={map:_,forEach:function(e,t,n){_(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return _(e,(function(){t++})),t},toArray:function(e){return _(e,(function(e){return e}))||[]},only:function(e){if(!P(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},l.Component=v,l.Fragment=i,l.Profiler=o,l.PureComponent=y,l.StrictMode=r,l.Suspense=u,l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,l.act=L,l.cloneElement=function(t,n,i){if(null==t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=m({},t.props),o=t.key,a=t.ref,s=t._owner;if(null!=n){if(void 0!==n.ref&&(a=n.ref,s=T.current),void 0!==n.key&&(o=""+n.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(l in n)S.call(n,l)&&!C.hasOwnProperty(l)&&(r[l]=void 0===n[l]&&void 0!==c?c[l]:n[l])}var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:e,type:t.type,key:o,ref:a,props:r,_owner:s}},l.createContext=function(e){return(e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},l.createElement=E,l.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},l.createRef=function(){return{current:null}},l.forwardRef=function(e){return{$$typeof:c,render:e}},l.isValidElement=P,l.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:I}},l.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},l.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},l.unstable_act=L,l.useCallback=function(e,t){return N.current.useCallback(e,t)},l.useContext=function(e){return N.current.useContext(e)},l.useDebugValue=function(){},l.useDeferredValue=function(e){return N.current.useDeferredValue(e)},l.useEffect=function(e,t){return N.current.useEffect(e,t)},l.useId=function(){return N.current.useId()},l.useImperativeHandle=function(e,t,n){return N.current.useImperativeHandle(e,t,n)},l.useInsertionEffect=function(e,t){return N.current.useInsertionEffect(e,t)},l.useLayoutEffect=function(e,t){return N.current.useLayoutEffect(e,t)},l.useMemo=function(e,t){return N.current.useMemo(e,t)},l.useReducer=function(e,t,n){return N.current.useReducer(e,t,n)},l.useRef=function(e){return N.current.useRef(e)},l.useState=function(e){return N.current.useState(e)},l.useSyncExternalStore=function(e,t,n){return N.current.useSyncExternalStore(e,t,n)},l.useTransition=function(){return N.current.useTransition()},l.version="18.3.1",l}function d(){return i||(i=1,c.exports=u()),c.exports}
/**
	 * @license React
	 * react-jsx-runtime.production.min.js
	 *
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 */var h,p,f,m,g,v=(o||(o=1,a.exports=function(){if(r)return s;r=1;var e=d(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,r){var s,c={},l=null,u=null;for(s in void 0!==r&&(l=""+r),void 0!==n.key&&(l=""+n.key),void 0!==n.ref&&(u=n.ref),n)i.call(n,s)&&!a.hasOwnProperty(s)&&(c[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===c[s]&&(c[s]=n[s]);return{$$typeof:t,type:e,key:l,ref:u,props:c,_owner:o.current}}return s.Fragment=n,s.jsx=c,s.jsxs=c,s}()),a.exports),b=d(),y=t(b),k={},w={exports:{}},S={},T={exports:{}},C={};function E(){return p||(p=1,T.exports=(h||(h=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,o=e[i];if(!(0<r(o,t)))break e;e[i]=t,e[n]=o,n=i}}function n(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,o=e.length,a=o>>>1;i<a;){var s=2*(i+1)-1,c=e[s],l=s+1,u=e[l];if(0>r(c,n))l<o&&0>r(u,c)?(e[i]=u,e[l]=n,i=l):(e[i]=c,e[s]=n,i=s);else{if(!(l<o&&0>r(u,n)))break e;e[i]=u,e[l]=n,i=l}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var c=[],l=[],u=1,d=null,h=3,p=!1,f=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var r=n(l);null!==r;){if(null===r.callback)i(l);else{if(!(r.startTime<=e))break;i(l),r.sortIndex=r.expirationTime,t(c,r)}r=n(l)}}function k(e){if(m=!1,y(e),!f)if(null!==n(c))f=!0,N(w);else{var t=n(l);null!==t&&M(k,t.startTime-e)}}function w(t,r){f=!1,m&&(m=!1,v(E),E=-1),p=!0;var o=h;try{for(y(r),d=n(c);null!==d&&(!(d.expirationTime>r)||t&&!R());){var a=d.callback;if("function"==typeof a){d.callback=null,h=d.priorityLevel;var s=a(d.expirationTime<=r);r=e.unstable_now(),"function"==typeof s?d.callback=s:d===n(c)&&i(c),y(r)}else i(c);d=n(c)}if(null!==d)var u=!0;else{var g=n(l);null!==g&&M(k,g.startTime-r),u=!1}return u}finally{d=null,h=o,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,C=null,E=-1,P=5,x=-1;function R(){return!(e.unstable_now()-x<P)}function O(){if(null!==C){var t=e.unstable_now();x=t;var n=!0;try{n=C(!0,t)}finally{n?S():(T=!1,C=null)}}else T=!1}if("function"==typeof b)S=function(){b(O)};else if("undefined"!=typeof MessageChannel){var _=new MessageChannel,I=_.port2;_.port1.onmessage=O,S=function(){I.postMessage(null)}}else S=function(){g(O,0)};function N(e){C=e,T||(T=!0,S())}function M(t,n){E=g((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,N(w))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(i,r,o){var a=e.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?a+o:a,i){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return i={id:u++,callback:r,priorityLevel:i,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(i.sortIndex=o,t(l,i),null===n(c)&&i===n(l)&&(m?(v(E),E=-1):m=!0,M(k,o-a))):(i.sortIndex=s,t(c,i),f||p||(f=!0,N(w))),i},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(C)),C)),T.exports}
/**
	 * @license React
	 * react-dom.production.min.js
	 *
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 */function P(){if(f)return S;f=1;var e=d(),t=E();function n(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,r={};function o(e,t){a(e,t),a(e+"Capture",t)}function a(e,t){for(r[e]=t,e=0;e<t.length;e++)i.add(t[e])}var s=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),c=Object.prototype.hasOwnProperty,l=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},h={};function p(e,t,n,i,r,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new p(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new p(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new p(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new p(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new p(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new p(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,i){var r=m.hasOwnProperty(t)?m[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!c.call(h,e)||!c.call(u,e)&&(l.test(e)?h[e]=!0:(u[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,v);m[t]=new p(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,v);m[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,v);m[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)}));var y=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),x=Symbol.for("react.provider"),R=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),D=Symbol.for("react.offscreen"),L=Symbol.iterator;function A(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=L&&e[L]||e["@@iterator"])?e:null}var U,j=Object.assign;function F(e){if(void 0===U)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var B=!1;function z(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var i=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){i=e}e.call(t.prototype)}else{try{throw Error()}catch(e){i=e}e()}}catch(t){if(t&&i&&"string"==typeof t.stack){for(var r=t.stack.split("\n"),o=i.stack.split("\n"),a=r.length-1,s=o.length-1;1<=a&&0<=s&&r[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(r[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||r[a]!==o[s]){var c="\n"+r[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function V(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case T:return"Fragment";case w:return"Portal";case P:return"Profiler";case C:return"StrictMode";case _:return"Suspense";case I:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case x:return(e._context.displayName||"Context")+".Provider";case O:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case M:t=e._payload,e=e._init;try{return q(e(t))}catch(e){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=K(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function J(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return j({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Z(e,t){Y(e,t);var n=H(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?te(e,t.type,n):t.hasOwnProperty("defaultValue")&&te(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ee(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function te(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ne=Array.isArray;function ie(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(n(91));return j({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(n(92));if(ne(i)){if(1<i.length)throw Error(n(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:H(i)}}function ae(e,t){var n=H(t.value),i=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ce(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ce(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,de,he=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return de(e,t)}))}:de);function pe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=ge(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(fe).forEach((function(e){me.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var be=j({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(be[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(n(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(n(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(n(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(n(62))}}function ke(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Te=null,Ce=null,Ee=null;function Pe(e){if(e=kr(e)){if("function"!=typeof Te)throw Error(n(280));var t=e.stateNode;t&&(t=Sr(t),Te(e.stateNode,e.type,t))}}function xe(e){Ce?Ee?Ee.push(e):Ee=[e]:Ce=e}function Re(){if(Ce){var e=Ce,t=Ee;if(Ee=Ce=null,Pe(e),t)for(e=0;e<t.length;e++)Pe(t[e])}}function Oe(e,t){return e(t)}function _e(){}var Ie=!1;function Ne(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return Oe(e,t,n)}finally{Ie=!1,(null!==Ce||null!==Ee)&&(_e(),Re())}}function Me(e,t){var i=e.stateNode;if(null===i)return null;var r=Sr(i);if(null===r)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(n(231,t,typeof i));return i}var De=!1;if(s)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){De=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(de){De=!1}function Ae(e,t,n,i,r,o,a,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(e){this.onError(e)}}var Ue=!1,je=null,Fe=!1,Be=null,ze={onError:function(e){Ue=!0,je=e}};function Ve(e,t,n,i,r,o,a,s,c){Ue=!1,je=null,Ae.apply(ze,arguments)}function qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(qe(e)!==e)throw Error(n(188))}function Ke(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(n(188));return t!==e?null:e}for(var i=e,r=t;;){var o=i.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(r=o.return)){i=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===i)return He(o),e;if(a===r)return He(o),t;a=a.sibling}throw Error(n(188))}if(i.return!==r.return)i=o,r=a;else{for(var s=!1,c=o.child;c;){if(c===i){s=!0,i=o,r=a;break}if(c===r){s=!0,r=o,i=a;break}c=c.sibling}if(!s){for(c=a.child;c;){if(c===i){s=!0,i=a,r=o;break}if(c===r){s=!0,r=a,i=o;break}c=c.sibling}if(!s)throw Error(n(189))}}if(i.alternate!==r)throw Error(n(190))}if(3!==i.tag)throw Error(n(188));return i.stateNode.current===i?e:t}(e),null!==e?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Qe=t.unstable_scheduleCallback,Je=t.unstable_cancelCallback,$e=t.unstable_shouldYield,Xe=t.unstable_requestPaint,Ye=t.unstable_now,Ze=t.unstable_getCurrentPriorityLevel,et=t.unstable_ImmediatePriority,tt=t.unstable_UserBlockingPriority,nt=t.unstable_NormalPriority,it=t.unstable_LowPriority,rt=t.unstable_IdlePriority,ot=null,at=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ct(e)/lt|0)|0},ct=Math.log,lt=Math.LN2;var ut=64,dt=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~r;0!==s?i=ht(s):0!==(o&=a)&&(i=ht(o))}else 0!==(a=n&~r)?i=ht(a):0!==o&&(i=ht(o));if(0===i)return 0;if(0!==t&&t!==i&&!(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&4194240&o))return t;if(4&i&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-st(t)),i|=e[n],t&=~r;return i}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ut;return!(4194240&(ut<<=1))&&(ut=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function bt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-st(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var kt=0;function wt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var St,Tt,Ct,Et,Pt,xt=!1,Rt=[],Ot=null,_t=null,It=null,Nt=new Map,Mt=new Map,Dt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function At(e,t){switch(e){case"focusin":case"focusout":Ot=null;break;case"dragenter":case"dragleave":_t=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mt.delete(t.pointerId)}}function Ut(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=kr(t))&&Tt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function jt(e){var t=yr(e.target);if(null!==t){var n=qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void Pt(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=kr(n))&&Tt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);we=i,n.target.dispatchEvent(i),we=null,t.shift()}return!0}function Bt(e,t,n){Ft(e)&&n.delete(t)}function zt(){xt=!1,null!==Ot&&Ft(Ot)&&(Ot=null),null!==_t&&Ft(_t)&&(_t=null),null!==It&&Ft(It)&&(It=null),Nt.forEach(Bt),Mt.forEach(Bt)}function Vt(e,n){e.blockedOn===n&&(e.blockedOn=null,xt||(xt=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,zt)))}function qt(e){function t(t){return Vt(t,e)}if(0<Rt.length){Vt(Rt[0],e);for(var n=1;n<Rt.length;n++){var i=Rt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Ot&&Vt(Ot,e),null!==_t&&Vt(_t,e),null!==It&&Vt(It,e),Nt.forEach(t),Mt.forEach(t),n=0;n<Dt.length;n++)(i=Dt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)jt(n),null===n.blockedOn&&Dt.shift()}var Wt=y.ReactCurrentBatchConfig,Ht=!0;function Kt(e,t,n,i){var r=kt,o=Wt.transition;Wt.transition=null;try{kt=1,Qt(e,t,n,i)}finally{kt=r,Wt.transition=o}}function Gt(e,t,n,i){var r=kt,o=Wt.transition;Wt.transition=null;try{kt=4,Qt(e,t,n,i)}finally{kt=r,Wt.transition=o}}function Qt(e,t,n,i){if(Ht){var r=$t(e,t,n,i);if(null===r)Hi(e,t,i,Jt,n),At(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Ot=Ut(Ot,e,t,n,i,r),!0;case"dragenter":return _t=Ut(_t,e,t,n,i,r),!0;case"mouseover":return It=Ut(It,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return Nt.set(o,Ut(Nt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Mt.set(o,Ut(Mt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(At(e,i),4&t&&-1<Lt.indexOf(e)){for(;null!==r;){var o=kr(r);if(null!==o&&St(o),null===(o=$t(e,t,n,i))&&Hi(e,t,i,Jt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Hi(e,t,i,null,n)}}var Jt=null;function $t(e,t,n,i){if(Jt=null,null!==(e=yr(e=Se(i))))if(null===(t=qe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Jt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case et:return 1;case tt:return 4;case nt:case it:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Yt=null,Zt=null,en=null;function tn(){if(en)return en;var e,t,n=Zt,i=n.length,r="value"in Yt?Yt.value:Yt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[o-t];t++);return en=r.slice(e,1<t?1-t:void 0)}function nn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rn(){return!0}function on(){return!1}function an(e){function t(t,n,i,r,o){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?rn:on,this.isPropagationStopped=on,this}return j(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rn)},persist:function(){},isPersistent:rn}),t}var sn,cn,ln,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=an(un),hn=j({},un,{view:0,detail:0}),pn=an(hn),fn=j({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,cn=e.screenY-ln.screenY):cn=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:cn}}),mn=an(fn),gn=an(j({},fn,{dataTransfer:0})),vn=an(j({},hn,{relatedTarget:0})),bn=an(j({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=j({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),kn=an(yn),wn=an(j({},un,{data:0})),Sn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function Pn(){return En}var xn=j({},hn,{key:function(e){if(e.key){var t=Sn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=nn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Tn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pn,charCode:function(e){return"keypress"===e.type?nn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?nn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=an(xn),On=an(j({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),_n=an(j({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pn})),In=an(j({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=j({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Mn=an(Nn),Dn=[9,13,27,32],Ln=s&&"CompositionEvent"in window,An=null;s&&"documentMode"in document&&(An=document.documentMode);var Un=s&&"TextEvent"in window&&!An,jn=s&&(!Ln||An&&8<An&&11>=An),Fn=String.fromCharCode(32),Bn=!1;function zn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var qn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Kn(e,t,n,i){xe(i),0<(t=Gi(t,"onChange")).length&&(n=new dn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Gn=null,Qn=null;function Jn(e){Fi(e,0)}function $n(e){if(Q(wr(e)))return e}function Xn(e,t){if("change"===e)return t}var Yn=!1;if(s){var Zn;if(s){var ei="oninput"in document;if(!ei){var ti=document.createElement("div");ti.setAttribute("oninput","return;"),ei="function"==typeof ti.oninput}Zn=ei}else Zn=!1;Yn=Zn&&(!document.documentMode||9<document.documentMode)}function ni(){Gn&&(Gn.detachEvent("onpropertychange",ii),Qn=Gn=null)}function ii(e){if("value"===e.propertyName&&$n(Qn)){var t=[];Kn(t,Qn,e,Se(e)),Ne(Jn,t)}}function ri(e,t,n){"focusin"===e?(ni(),Qn=n,(Gn=t).attachEvent("onpropertychange",ii)):"focusout"===e&&ni()}function oi(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return $n(Qn)}function ai(e,t){if("click"===e)return $n(t)}function si(e,t){if("input"===e||"change"===e)return $n(t)}var ci="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function li(e,t){if(ci(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!c.call(t,r)||!ci(e[r],t[r]))return!1}return!0}function ui(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function di(e,t){var n,i=ui(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ui(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pi(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=pi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=di(n,o);var a=di(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gi=s&&"documentMode"in document&&11>=document.documentMode,vi=null,bi=null,yi=null,ki=!1;function wi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ki||null==vi||vi!==J(i)||("selectionStart"in(i=vi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Gi(bi,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=vi)))}function Si(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ti={animationend:Si("Animation","AnimationEnd"),animationiteration:Si("Animation","AnimationIteration"),animationstart:Si("Animation","AnimationStart"),transitionend:Si("Transition","TransitionEnd")},Ci={},Ei={};function Pi(e){if(Ci[e])return Ci[e];if(!Ti[e])return e;var t,n=Ti[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ei)return Ci[e]=n[t];return e}s&&(Ei=document.createElement("div").style,"AnimationEvent"in window||(delete Ti.animationend.animation,delete Ti.animationiteration.animation,delete Ti.animationstart.animation),"TransitionEvent"in window||delete Ti.transitionend.transition);var xi=Pi("animationend"),Ri=Pi("animationiteration"),Oi=Pi("animationstart"),_i=Pi("transitionend"),Ii=new Map,Ni="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mi(e,t){Ii.set(e,t),o(t,[e])}for(var Di=0;Di<Ni.length;Di++){var Li=Ni[Di];Mi(Li.toLowerCase(),"on"+(Li[0].toUpperCase()+Li.slice(1)))}Mi(xi,"onAnimationEnd"),Mi(Ri,"onAnimationIteration"),Mi(Oi,"onAnimationStart"),Mi("dblclick","onDoubleClick"),Mi("focusin","onFocus"),Mi("focusout","onBlur"),Mi(_i,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ai="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ui=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ai));function ji(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,r,o,a,s,c,l){if(Ve.apply(this,arguments),Ue){if(!Ue)throw Error(n(198));var u=je;Ue=!1,je=null,Fe||(Fe=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function Fi(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&r.isPropagationStopped())break e;ji(r,s,l),o=c}else for(a=0;a<i.length;a++){if(c=(s=i[a]).instance,l=s.currentTarget,s=s.listener,c!==o&&r.isPropagationStopped())break e;ji(r,s,l),o=c}}}if(Fe)throw e=Be,Fe=!1,Be=null,e}function Bi(e,t){var n=t[gr];void 0===n&&(n=t[gr]=new Set);var i=e+"__bubble";n.has(i)||(Wi(t,e,2,!1),n.add(i))}function zi(e,t,n){var i=0;t&&(i|=4),Wi(n,e,i,t)}var Vi="_reactListening"+Math.random().toString(36).slice(2);function qi(e){if(!e[Vi]){e[Vi]=!0,i.forEach((function(t){"selectionchange"!==t&&(Ui.has(t)||zi(t,!1,e),zi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vi]||(t[Vi]=!0,zi("selectionchange",!1,t))}}function Wi(e,t,n,i){switch(Xt(t)){case 1:var r=Kt;break;case 4:r=Gt;break;default:r=Qt}n=r.bind(null,t,n,e),r=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Hi(e,t,n,i,r){var o=i;if(!(1&t||2&t||null===i))e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===r||8===c.nodeType&&c.parentNode===r))return;a=a.return}for(;null!==s;){if(null===(a=yr(s)))return;if(5===(c=a.tag)||6===c){i=o=a;continue e}s=s.parentNode}}i=i.return}Ne((function(){var i=o,r=Se(n),a=[];e:{var s=Ii.get(e);if(void 0!==s){var c=dn,l=e;switch(e){case"keypress":if(0===nn(n))break e;case"keydown":case"keyup":c=Rn;break;case"focusin":l="focus",c=vn;break;case"focusout":l="blur",c=vn;break;case"beforeblur":case"afterblur":c=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=_n;break;case xi:case Ri:case Oi:c=bn;break;case _i:c=In;break;case"scroll":c=pn;break;case"wheel":c=Mn;break;case"copy":case"cut":case"paste":c=kn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=On}var u=!!(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Me(f,h))&&u.push(Ki(f,m,p)))),d)break;f=f.return}0<u.length&&(s=new c(s,l,null,n,r),a.push({event:s,listeners:u}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===we||!(l=n.relatedTarget||n.fromElement)||!yr(l)&&!l[mr])&&(c||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=i,null!==(l=(l=n.relatedTarget||n.toElement)?yr(l):null)&&(l!==(d=qe(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=i),c!==l)){if(u=mn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=On,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==c?s:wr(c),p=null==l?s:wr(l),(s=new u(m,f+"leave",c,n,r)).target=d,s.relatedTarget=p,m=null,yr(r)===i&&((u=new u(h,f+"enter",l,n,r)).target=p,u.relatedTarget=d,m=u),d=m,c&&l)e:{for(h=l,f=0,p=u=c;p;p=Qi(p))f++;for(p=0,m=h;m;m=Qi(m))p++;for(;0<f-p;)u=Qi(u),f--;for(;0<p-f;)h=Qi(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Qi(u),h=Qi(h)}u=null}else u=null;null!==c&&Ji(a,s,c,u,!1),null!==l&&null!==d&&Ji(a,d,l,u,!0)}if("select"===(c=(s=i?wr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=Xn;else if(Hn(s))if(Yn)g=si;else{g=oi;var v=ri}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ai);switch(g&&(g=g(e,i))?Kn(a,g,n,r):(v&&v(e,s,i),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&te(s,"number",s.value)),v=i?wr(i):window,e){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(vi=v,bi=i,yi=null);break;case"focusout":yi=bi=vi=null;break;case"mousedown":ki=!0;break;case"contextmenu":case"mouseup":case"dragend":ki=!1,wi(a,n,r);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":wi(a,n,r)}var b;if(Ln)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else qn?zn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(jn&&"ko"!==n.locale&&(qn||"onCompositionStart"!==y?"onCompositionEnd"===y&&qn&&(b=tn()):(Zt="value"in(Yt=r)?Yt.value:Yt.textContent,qn=!0)),0<(v=Gi(i,y)).length&&(y=new wn(y,e,null,n,r),a.push({event:y,listeners:v}),b?y.data=b:null!==(b=Vn(n))&&(y.data=b))),(b=Un?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(qn)return"compositionend"===e||!Ln&&zn(e,t)?(e=tn(),en=Zt=Yt=null,qn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Gi(i,"onBeforeInput")).length&&(r=new wn("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=b))}Fi(a,t)}))}function Ki(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Me(e,n))&&i.unshift(Ki(e,o,r)),null!=(o=Me(e,t))&&i.push(Ki(e,o,r))),e=e.return}return i}function Qi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ji(e,t,n,i,r){for(var o=t._reactName,a=[];null!==n&&n!==i;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===i)break;5===s.tag&&null!==l&&(s=l,r?null!=(c=Me(n,o))&&a.unshift(Ki(n,c,s)):r||null!=(c=Me(n,o))&&a.push(Ki(n,c,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var $i=/\r\n?/g,Xi=/\u0000|\uFFFD/g;function Yi(e){return("string"==typeof e?e:""+e).replace($i,"\n").replace(Xi,"")}function Zi(e,t,i){if(t=Yi(t),Yi(e)!==t&&i)throw Error(n(425))}function er(){}var tr=null,nr=null;function ir(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rr="function"==typeof setTimeout?setTimeout:void 0,or="function"==typeof clearTimeout?clearTimeout:void 0,ar="function"==typeof Promise?Promise:void 0,sr="function"==typeof queueMicrotask?queueMicrotask:void 0!==ar?function(e){return ar.resolve(null).then(e).catch(cr)}:rr;function cr(e){setTimeout((function(){throw e}))}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void qt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);qt(t)}function ur(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),pr="__reactFiber$"+hr,fr="__reactProps$"+hr,mr="__reactContainer$"+hr,gr="__reactEvents$"+hr,vr="__reactListeners$"+hr,br="__reactHandles$"+hr;function yr(e){var t=e[pr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mr]||n[pr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=dr(e);null!==e;){if(n=e[pr])return n;e=dr(e)}return t}n=(e=n).parentNode}return null}function kr(e){return!(e=e[pr]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(n(33))}function Sr(e){return e[fr]||null}var Tr=[],Cr=-1;function Er(e){return{current:e}}function Pr(e){0>Cr||(e.current=Tr[Cr],Tr[Cr]=null,Cr--)}function xr(e,t){Cr++,Tr[Cr]=e.current,e.current=t}var Rr={},Or=Er(Rr),_r=Er(!1),Ir=Rr;function Nr(e,t){var n=e.type.contextTypes;if(!n)return Rr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Mr(e){return null!=(e=e.childContextTypes)}function Dr(){Pr(_r),Pr(Or)}function Lr(e,t,i){if(Or.current!==Rr)throw Error(n(168));xr(Or,t),xr(_r,i)}function Ar(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return i;for(var o in r=r.getChildContext())if(!(o in t))throw Error(n(108,W(e)||"Unknown",o));return j({},i,r)}function Ur(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Rr,Ir=Or.current,xr(Or,e),xr(_r,_r.current),!0}function jr(e,t,i){var r=e.stateNode;if(!r)throw Error(n(169));i?(e=Ar(e,t,Ir),r.__reactInternalMemoizedMergedChildContext=e,Pr(_r),Pr(Or),xr(Or,e)):Pr(_r),xr(_r,i)}var Fr=null,Br=!1,zr=!1;function Vr(e){null===Fr?Fr=[e]:Fr.push(e)}function qr(){if(!zr&&null!==Fr){zr=!0;var e=0,t=kt;try{var n=Fr;for(kt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Fr=null,Br=!1}catch(t){throw null!==Fr&&(Fr=Fr.slice(e+1)),Qe(et,qr),t}finally{kt=t,zr=!1}}return null}var Wr=[],Hr=0,Kr=null,Gr=0,Qr=[],Jr=0,$r=null,Xr=1,Yr="";function Zr(e,t){Wr[Hr++]=Gr,Wr[Hr++]=Kr,Kr=e,Gr=t}function eo(e,t,n){Qr[Jr++]=Xr,Qr[Jr++]=Yr,Qr[Jr++]=$r,$r=e;var i=Xr;e=Yr;var r=32-st(i)-1;i&=~(1<<r),n+=1;var o=32-st(t)+r;if(30<o){var a=r-r%5;o=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Xr=1<<32-st(t)+r|n<<r|i,Yr=o+e}else Xr=1<<o|n<<r|i,Yr=e}function to(e){null!==e.return&&(Zr(e,1),eo(e,1,0))}function no(e){for(;e===Kr;)Kr=Wr[--Hr],Wr[Hr]=null,Gr=Wr[--Hr],Wr[Hr]=null;for(;e===$r;)$r=Qr[--Jr],Qr[Jr]=null,Yr=Qr[--Jr],Qr[Jr]=null,Xr=Qr[--Jr],Qr[Jr]=null}var io=null,ro=null,oo=!1,ao=null;function so(e,t){var n=Nl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function co(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,io=e,ro=ur(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,io=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==$r?{id:Xr,overflow:Yr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,io=e,ro=null,!0);default:return!1}}function lo(e){return!(!(1&e.mode)||128&e.flags)}function uo(e){if(oo){var t=ro;if(t){var i=t;if(!co(e,t)){if(lo(e))throw Error(n(418));t=ur(i.nextSibling);var r=io;t&&co(e,t)?so(r,i):(e.flags=-4097&e.flags|2,oo=!1,io=e)}}else{if(lo(e))throw Error(n(418));e.flags=-4097&e.flags|2,oo=!1,io=e}}}function ho(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;io=e}function po(e){if(e!==io)return!1;if(!oo)return ho(e),oo=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ir(e.type,e.memoizedProps)),t&&(t=ro)){if(lo(e))throw fo(),Error(n(418));for(;t;)so(e,t),t=ur(t.nextSibling)}if(ho(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){ro=ur(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}ro=null}}else ro=io?ur(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=ro;e;)e=ur(e.nextSibling)}function mo(){ro=io=null,oo=!1}function go(e){null===ao?ao=[e]:ao.push(e)}var vo=y.ReactCurrentBatchConfig;function bo(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(n(309));var r=i.stateNode}if(!r)throw Error(n(147,e));var o=r,a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=o.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!=typeof e)throw Error(n(284));if(!i._owner)throw Error(n(290,e))}return e}function yo(e,t){throw e=Object.prototype.toString.call(t),Error(n(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ko(e){return(0,e._init)(e._payload)}function wo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function i(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Dl(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=jl(n,e.mode,i)).return=e,t):((t=o(t,n)).return=e,t)}function l(e,t,n,i){var r=n.type;return r===T?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===r||"object"==typeof r&&null!==r&&r.$$typeof===M&&ko(r)===t.type)?((i=o(t,n.props)).ref=bo(e,t,n),i.return=e,i):((i=Ll(n.type,n.key,n.props,null,e.mode,i)).ref=bo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fl(n,e.mode,i)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,i,r){return null===t||7!==t.tag?((t=Al(n,e.mode,i,r)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=jl(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case k:return(n=Ll(t.type,t.key,t.props,null,e.mode,n)).ref=bo(e,null,t),n.return=e,n;case w:return(t=Fl(t,e.mode,n)).return=e,t;case M:return h(e,(0,t._init)(t._payload),n)}if(ne(t)||A(t))return(t=Al(t,e.mode,n,null)).return=e,t;yo(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:c(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case k:return n.key===r?l(e,t,n,i):null;case w:return n.key===r?u(e,t,n,i):null;case M:return p(e,t,(r=n._init)(n._payload),i)}if(ne(n)||A(n))return null!==r?null:d(e,t,n,i,null);yo(e,n)}return null}function f(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case k:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case M:return f(e,t,n,(0,i._init)(i._payload),r)}if(ne(i)||A(i))return d(t,e=e.get(n)||null,i,r,null);yo(t,i)}return null}function m(n,o,s,c){for(var l=null,u=null,d=o,m=o=0,g=null;null!==d&&m<s.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(n,d,s[m],c);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(n,d),o=a(v,o,m),null===u?l=v:u.sibling=v,u=v,d=g}if(m===s.length)return i(n,d),oo&&Zr(n,m),l;if(null===d){for(;m<s.length;m++)null!==(d=h(n,s[m],c))&&(o=a(d,o,m),null===u?l=d:u.sibling=d,u=d);return oo&&Zr(n,m),l}for(d=r(n,d);m<s.length;m++)null!==(g=f(d,n,m,s[m],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=a(g,o,m),null===u?l=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(n,e)})),oo&&Zr(n,m),l}function g(o,s,c,l){var u=A(c);if("function"!=typeof u)throw Error(n(150));if(null==(c=u.call(c)))throw Error(n(151));for(var d=u=null,m=s,g=s=0,v=null,b=c.next();null!==m&&!b.done;g++,b=c.next()){m.index>g?(v=m,m=null):v=m.sibling;var y=p(o,m,b.value,l);if(null===y){null===m&&(m=v);break}e&&m&&null===y.alternate&&t(o,m),s=a(y,s,g),null===d?u=y:d.sibling=y,d=y,m=v}if(b.done)return i(o,m),oo&&Zr(o,g),u;if(null===m){for(;!b.done;g++,b=c.next())null!==(b=h(o,b.value,l))&&(s=a(b,s,g),null===d?u=b:d.sibling=b,d=b);return oo&&Zr(o,g),u}for(m=r(o,m);!b.done;g++,b=c.next())null!==(b=f(m,o,g,b.value,l))&&(e&&null!==b.alternate&&m.delete(null===b.key?g:b.key),s=a(b,s,g),null===d?u=b:d.sibling=b,d=b);return e&&m.forEach((function(e){return t(o,e)})),oo&&Zr(o,g),u}return function e(n,r,a,c){if("object"==typeof a&&null!==a&&a.type===T&&null===a.key&&(a=a.props.children),"object"==typeof a&&null!==a){switch(a.$$typeof){case k:e:{for(var l=a.key,u=r;null!==u;){if(u.key===l){if((l=a.type)===T){if(7===u.tag){i(n,u.sibling),(r=o(u,a.props.children)).return=n,n=r;break e}}else if(u.elementType===l||"object"==typeof l&&null!==l&&l.$$typeof===M&&ko(l)===u.type){i(n,u.sibling),(r=o(u,a.props)).ref=bo(n,u,a),r.return=n,n=r;break e}i(n,u);break}t(n,u),u=u.sibling}a.type===T?((r=Al(a.props.children,n.mode,c,a.key)).return=n,n=r):((c=Ll(a.type,a.key,a.props,null,n.mode,c)).ref=bo(n,r,a),c.return=n,n=c)}return s(n);case w:e:{for(u=a.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){i(n,r.sibling),(r=o(r,a.children||[])).return=n,n=r;break e}i(n,r);break}t(n,r),r=r.sibling}(r=Fl(a,n.mode,c)).return=n,n=r}return s(n);case M:return e(n,r,(u=a._init)(a._payload),c)}if(ne(a))return m(n,r,a,c);if(A(a))return g(n,r,a,c);yo(n,a)}return"string"==typeof a&&""!==a||"number"==typeof a?(a=""+a,null!==r&&6===r.tag?(i(n,r.sibling),(r=o(r,a)).return=n,n=r):(i(n,r),(r=jl(a,n.mode,c)).return=n,n=r),s(n)):i(n,r)}}var So=wo(!0),To=wo(!1),Co=Er(null),Eo=null,Po=null,xo=null;function Ro(){xo=Po=Eo=null}function Oo(e){var t=Co.current;Pr(Co),e._currentValue=t}function _o(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Io(e,t){Eo=e,xo=Po=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(ks=!0),e.firstContext=null)}function No(e){var t=e._currentValue;if(xo!==e)if(e={context:e,memoizedValue:t,next:null},null===Po){if(null===Eo)throw Error(n(308));Po=e,Eo.dependencies={lanes:0,firstContext:e}}else Po=Po.next=e;return t}var Mo=null;function Do(e){null===Mo?Mo=[e]:Mo.push(e)}function Lo(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Do(t)):(n.next=r.next,r.next=n),t.interleaved=n,Ao(e,i)}function Ao(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Uo=!1;function jo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Bo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,2&Oc){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Ao(e,n)}return null===(r=i.interleaved)?(t.next=t,Do(i)):(t.next=r.next,r.next=t),i.interleaved=t,Ao(e,n)}function Vo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function qo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wo(e,t,n,i){var r=e.updateQueue;Uo=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var c=s,l=c.next;c.next=null,null===a?o=l:a.next=l,a=c;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(null!==o){var d=r.baseState;for(a=0,u=l=c=null,s=o;;){var h=s.lane,p=s.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(h=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=m.payload)?f.call(p,d,h):f))break e;d=j({},d,h);break e;case 2:Uo=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(l=u=p,c=d):u=u.next=p,a|=h;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(h=s).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Uc|=a,e.lanes=a,e.memoizedState=d}}function Ho(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=i,"function"!=typeof o)throw Error(n(191,o));o.call(r)}}}var Ko={},Go=Er(Ko),Qo=Er(Ko),Jo=Er(Ko);function $o(e){if(e===Ko)throw Error(n(174));return e}function Xo(e,t){switch(xr(Jo,t),xr(Qo,e),xr(Go,Ko),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Pr(Go),xr(Go,t)}function Yo(){Pr(Go),Pr(Qo),Pr(Jo)}function Zo(e){$o(Jo.current);var t=$o(Go.current),n=le(t,e.type);t!==n&&(xr(Qo,e),xr(Go,n))}function ea(e){Qo.current===e&&(Pr(Go),Pr(Qo))}var ta=Er(0);function na(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ia=[];function ra(){for(var e=0;e<ia.length;e++)ia[e]._workInProgressVersionPrimary=null;ia.length=0}var oa=y.ReactCurrentDispatcher,aa=y.ReactCurrentBatchConfig,sa=0,ca=null,la=null,ua=null,da=!1,ha=!1,pa=0,fa=0;function ma(){throw Error(n(321))}function ga(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ci(e[n],t[n]))return!1;return!0}function va(e,t,i,r,o,a){if(sa=a,ca=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,oa.current=null===e||null===e.memoizedState?es:ts,e=i(r,o),ha){a=0;do{if(ha=!1,pa=0,25<=a)throw Error(n(301));a+=1,ua=la=null,t.updateQueue=null,oa.current=ns,e=i(r,o)}while(ha)}if(oa.current=Za,t=null!==la&&null!==la.next,sa=0,ua=la=ca=null,da=!1,t)throw Error(n(300));return e}function ba(){var e=0!==pa;return pa=0,e}function ya(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ua?ca.memoizedState=ua=e:ua=ua.next=e,ua}function ka(){if(null===la){var e=ca.alternate;e=null!==e?e.memoizedState:null}else e=la.next;var t=null===ua?ca.memoizedState:ua.next;if(null!==t)ua=t,la=e;else{if(null===e)throw Error(n(310));e={memoizedState:(la=e).memoizedState,baseState:la.baseState,baseQueue:la.baseQueue,queue:la.queue,next:null},null===ua?ca.memoizedState=ua=e:ua=ua.next=e}return ua}function wa(e,t){return"function"==typeof t?t(e):t}function Sa(e){var t=ka(),i=t.queue;if(null===i)throw Error(n(311));i.lastRenderedReducer=e;var r=la,o=r.baseQueue,a=i.pending;if(null!==a){if(null!==o){var s=o.next;o.next=a.next,a.next=s}r.baseQueue=o=a,i.pending=null}if(null!==o){a=o.next,r=r.baseState;var c=s=null,l=null,u=a;do{var d=u.lane;if((sa&d)===d)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=h,s=r):l=l.next=h,ca.lanes|=d,Uc|=d}u=u.next}while(null!==u&&u!==a);null===l?s=r:l.next=c,ci(r,t.memoizedState)||(ks=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,i.lastRenderedState=r}if(null!==(e=i.interleaved)){o=e;do{a=o.lane,ca.lanes|=a,Uc|=a,o=o.next}while(o!==e)}else null===o&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Ta(e){var t=ka(),i=t.queue;if(null===i)throw Error(n(311));i.lastRenderedReducer=e;var r=i.dispatch,o=i.pending,a=t.memoizedState;if(null!==o){i.pending=null;var s=o=o.next;do{a=e(a,s.action),s=s.next}while(s!==o);ci(a,t.memoizedState)||(ks=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),i.lastRenderedState=a}return[a,r]}function Ca(){}function Ea(e,t){var i=ca,r=ka(),o=t(),a=!ci(r.memoizedState,o);if(a&&(r.memoizedState=o,ks=!0),r=r.queue,Ua(Ra.bind(null,i,r,e),[e]),r.getSnapshot!==t||a||null!==ua&&1&ua.memoizedState.tag){if(i.flags|=2048,Na(9,xa.bind(null,i,r,o,t),void 0,null),null===_c)throw Error(n(349));30&sa||Pa(i,t,o)}return o}function Pa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ca.updateQueue)?(t={lastEffect:null,stores:null},ca.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function xa(e,t,n,i){t.value=n,t.getSnapshot=i,Oa(t)&&_a(e)}function Ra(e,t,n){return n((function(){Oa(t)&&_a(e)}))}function Oa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ci(e,n)}catch(e){return!0}}function _a(e){var t=Ao(e,1);null!==t&&il(t,e,1,-1)}function Ia(e){var t=ya();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wa,lastRenderedState:e},t.queue=e,e=e.dispatch=Ja.bind(null,ca,e),[t.memoizedState,e]}function Na(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ca.updateQueue)?(t={lastEffect:null,stores:null},ca.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ma(){return ka().memoizedState}function Da(e,t,n,i){var r=ya();ca.flags|=e,r.memoizedState=Na(1|t,n,void 0,void 0===i?null:i)}function La(e,t,n,i){var r=ka();i=void 0===i?null:i;var o=void 0;if(null!==la){var a=la.memoizedState;if(o=a.destroy,null!==i&&ga(i,a.deps))return void(r.memoizedState=Na(t,n,o,i))}ca.flags|=e,r.memoizedState=Na(1|t,n,o,i)}function Aa(e,t){return Da(8390656,8,e,t)}function Ua(e,t){return La(2048,8,e,t)}function ja(e,t){return La(4,2,e,t)}function Fa(e,t){return La(4,4,e,t)}function Ba(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function za(e,t,n){return n=null!=n?n.concat([e]):null,La(4,4,Ba.bind(null,t,e),n)}function Va(){}function qa(e,t){var n=ka();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ga(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Wa(e,t){var n=ka();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ga(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ha(e,t,n){return 21&sa?(ci(n,t)||(n=gt(),ca.lanes|=n,Uc|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ks=!0),e.memoizedState=n)}function Ka(e,t){var n=kt;kt=0!==n&&4>n?n:4,e(!0);var i=aa.transition;aa.transition={};try{e(!1),t()}finally{kt=n,aa.transition=i}}function Ga(){return ka().memoizedState}function Qa(e,t,n){var i=nl(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},$a(e))Xa(t,n);else if(null!==(n=Lo(e,t,n,i))){il(n,e,i,tl()),Ya(n,t,i)}}function Ja(e,t,n){var i=nl(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if($a(e))Xa(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(r.hasEagerState=!0,r.eagerState=s,ci(s,a)){var c=t.interleaved;return null===c?(r.next=r,Do(t)):(r.next=c.next,c.next=r),void(t.interleaved=r)}}catch(e){}null!==(n=Lo(e,t,r,i))&&(il(n,e,i,r=tl()),Ya(n,t,i))}}function $a(e){var t=e.alternate;return e===ca||null!==t&&t===ca}function Xa(e,t){ha=da=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ya(e,t,n){if(4194240&n){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Za={readContext:No,useCallback:ma,useContext:ma,useEffect:ma,useImperativeHandle:ma,useInsertionEffect:ma,useLayoutEffect:ma,useMemo:ma,useReducer:ma,useRef:ma,useState:ma,useDebugValue:ma,useDeferredValue:ma,useTransition:ma,useMutableSource:ma,useSyncExternalStore:ma,useId:ma,unstable_isNewReconciler:!1},es={readContext:No,useCallback:function(e,t){return ya().memoizedState=[e,void 0===t?null:t],e},useContext:No,useEffect:Aa,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Da(4194308,4,Ba.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Da(4194308,4,e,t)},useInsertionEffect:function(e,t){return Da(4,2,e,t)},useMemo:function(e,t){var n=ya();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ya();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Qa.bind(null,ca,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ya().memoizedState=e},useState:Ia,useDebugValue:Va,useDeferredValue:function(e){return ya().memoizedState=e},useTransition:function(){var e=Ia(!1),t=e[0];return e=Ka.bind(null,e[1]),ya().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=ca,o=ya();if(oo){if(void 0===i)throw Error(n(407));i=i()}else{if(i=t(),null===_c)throw Error(n(349));30&sa||Pa(r,t,i)}o.memoizedState=i;var a={value:i,getSnapshot:t};return o.queue=a,Aa(Ra.bind(null,r,a,e),[e]),r.flags|=2048,Na(9,xa.bind(null,r,a,i,t),void 0,null),i},useId:function(){var e=ya(),t=_c.identifierPrefix;if(oo){var n=Yr;t=":"+t+"R"+(n=(Xr&~(1<<32-st(Xr)-1)).toString(32)+n),0<(n=pa++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ts={readContext:No,useCallback:qa,useContext:No,useEffect:Ua,useImperativeHandle:za,useInsertionEffect:ja,useLayoutEffect:Fa,useMemo:Wa,useReducer:Sa,useRef:Ma,useState:function(){return Sa(wa)},useDebugValue:Va,useDeferredValue:function(e){return Ha(ka(),la.memoizedState,e)},useTransition:function(){return[Sa(wa)[0],ka().memoizedState]},useMutableSource:Ca,useSyncExternalStore:Ea,useId:Ga,unstable_isNewReconciler:!1},ns={readContext:No,useCallback:qa,useContext:No,useEffect:Ua,useImperativeHandle:za,useInsertionEffect:ja,useLayoutEffect:Fa,useMemo:Wa,useReducer:Ta,useRef:Ma,useState:function(){return Ta(wa)},useDebugValue:Va,useDeferredValue:function(e){var t=ka();return null===la?t.memoizedState=e:Ha(t,la.memoizedState,e)},useTransition:function(){return[Ta(wa)[0],ka().memoizedState]},useMutableSource:Ca,useSyncExternalStore:Ea,useId:Ga,unstable_isNewReconciler:!1};function is(e,t){if(e&&e.defaultProps){for(var n in t=j({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:j({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var os={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tl(),r=nl(e),o=Bo(i,r);o.payload=t,null!=n&&(o.callback=n),null!==(t=zo(e,o,r))&&(il(t,e,r,i),Vo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tl(),r=nl(e),o=Bo(i,r);o.tag=1,o.payload=t,null!=n&&(o.callback=n),null!==(t=zo(e,o,r))&&(il(t,e,r,i),Vo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tl(),i=nl(e),r=Bo(n,i);r.tag=2,null!=t&&(r.callback=t),null!==(t=zo(e,r,i))&&(il(t,e,i,n),Vo(t,e,i))}};function as(e,t,n,i,r,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,o))}function ss(e,t,n){var i=!1,r=Rr,o=t.contextType;return"object"==typeof o&&null!==o?o=No(o):(r=Mr(t)?Ir:Or.current,o=(i=null!=(i=t.contextTypes))?Nr(e,r):Rr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=os,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function cs(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&os.enqueueReplaceState(t,t.state,null)}function ls(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},jo(e);var o=t.contextType;"object"==typeof o&&null!==o?r.context=No(o):(o=Mr(t)?Ir:Or.current,r.context=Nr(e,o)),r.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(rs(e,t,o,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&os.enqueueReplaceState(r,r.state,null),Wo(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function us(e,t){try{var n="",i=t;do{n+=V(i),i=i.return}while(i);var r=n}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:r,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var ps="function"==typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Bo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Hc||(Hc=!0,Kc=i),hs(0,t)},n}function ms(e,t,n){(n=Bo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){hs(0,t)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!=typeof i&&(null===Gc?Gc=new Set([this]):Gc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function gs(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ps;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Pl.bind(null,e,t,n),t.then(e,e))}function vs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function bs(e,t,n,i,r){return 1&e.mode?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Bo(-1,1)).tag=2,zo(n,t,1))),n.lanes|=1),e)}var ys=y.ReactCurrentOwner,ks=!1;function ws(e,t,n,i){t.child=null===e?To(t,null,n,i):So(t,e.child,n,i)}function Ss(e,t,n,i,r){n=n.render;var o=t.ref;return Io(t,r),i=va(e,t,n,i,o,r),n=ba(),null===e||ks?(oo&&n&&to(t),t.flags|=1,ws(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Hs(e,t,r))}function Ts(e,t,n,i,r){if(null===e){var o=n.type;return"function"!=typeof o||Ml(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ll(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Cs(e,t,o,i,r))}if(o=e.child,!(e.lanes&r)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&e.ref===t.ref)return Hs(e,t,r)}return t.flags|=1,(e=Dl(o,i)).ref=t.ref,e.return=t,t.child=e}function Cs(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(li(o,i)&&e.ref===t.ref){if(ks=!1,t.pendingProps=i=o,!(e.lanes&r))return t.lanes=e.lanes,Hs(e,t,r);131072&e.flags&&(ks=!0)}}return xs(e,t,n,i,r)}function Es(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xr(Dc,Mc),Mc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,xr(Dc,Mc),Mc|=i}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xr(Dc,Mc),Mc|=n;else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,xr(Dc,Mc),Mc|=i;return ws(e,t,r,n),t.child}function Ps(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function xs(e,t,n,i,r){var o=Mr(n)?Ir:Or.current;return o=Nr(t,o),Io(t,r),n=va(e,t,n,i,o,r),i=ba(),null===e||ks?(oo&&i&&to(t),t.flags|=1,ws(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Hs(e,t,r))}function Rs(e,t,n,i,r){if(Mr(n)){var o=!0;Ur(t)}else o=!1;if(Io(t,r),null===t.stateNode)Ws(e,t),ss(t,n,i),ls(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var c=a.context,l=n.contextType;"object"==typeof l&&null!==l?l=No(l):l=Nr(t,l=Mr(n)?Ir:Or.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof a.getSnapshotBeforeUpdate;d||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==i||c!==l)&&cs(t,a,i,l),Uo=!1;var h=t.memoizedState;a.state=h,Wo(t,i,a,r),c=t.memoizedState,s!==i||h!==c||_r.current||Uo?("function"==typeof u&&(rs(t,n,u,i),c=t.memoizedState),(s=Uo||as(t,n,s,i,h,c,l))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),a.props=i,a.state=c,a.context=l,i=s):("function"==typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Fo(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:is(t.type,s),a.props=l,d=t.pendingProps,h=a.context,"object"==typeof(c=n.contextType)&&null!==c?c=No(c):c=Nr(t,c=Mr(n)?Ir:Or.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==d||h!==c)&&cs(t,a,i,c),Uo=!1,h=t.memoizedState,a.state=h,Wo(t,i,a,r);var f=t.memoizedState;s!==d||h!==f||_r.current||Uo?("function"==typeof p&&(rs(t,n,p,i),f=t.memoizedState),(l=Uo||as(t,n,l,i,h,f,c)||!1)?(u||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(i,f,c),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,f,c)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),a.props=i,a.state=f,a.context=c,i=l):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Os(e,t,n,i,o,r)}function Os(e,t,n,i,r,o){Ps(e,t);var a=!!(128&t.flags);if(!i&&!a)return r&&jr(t,n,!1),Hs(e,t,o);i=t.stateNode,ys.current=t;var s=a&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=So(t,e.child,null,o),t.child=So(t,null,s,o)):ws(e,t,s,o),t.memoizedState=i.state,r&&jr(t,n,!0),t.child}function _s(e){var t=e.stateNode;t.pendingContext?Lr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Lr(0,t.context,!1),Xo(e,t.containerInfo)}function Is(e,t,n,i,r){return mo(),go(r),t.flags|=256,ws(e,t,n,i),t.child}var Ns,Ms,Ds,Ls,As={dehydrated:null,treeContext:null,retryLane:0};function Us(e){return{baseLanes:e,cachePool:null,transitions:null}}function js(e,t,i){var r,o=t.pendingProps,a=ta.current,s=!1,c=!!(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&!!(2&a)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),xr(ta,1&a),null===e)return uo(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(c=o.children,e=o.fallback,s?(o=t.mode,s=t.child,c={mode:"hidden",children:c},1&o||null===s?s=Ul(c,o,0,null):(s.childLanes=0,s.pendingProps=c),e=Al(e,o,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Us(i),t.memoizedState=As,e):Fs(t,c));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,i,r,o,a,s){if(i)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,r=ds(Error(n(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,o=t.mode,r=Ul({mode:"visible",children:r.children},o,0,null),(a=Al(a,o,s,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,1&t.mode&&So(t,e.child,null,s),t.child.memoizedState=Us(s),t.memoizedState=As,a);if(!(1&t.mode))return Bs(e,t,s,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var c=r.dgst;return r=c,Bs(e,t,s,r=ds(a=Error(n(419)),r,void 0))}if(c=!!(s&e.childLanes),ks||c){if(null!==(r=_c)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=o&(r.suspendedLanes|s)?0:o)&&o!==a.retryLane&&(a.retryLane=o,Ao(e,o),il(r,e,o,-1))}return gl(),Bs(e,t,s,r=ds(Error(n(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=Rl.bind(null,e),o._reactRetry=t,null):(e=a.treeContext,ro=ur(o.nextSibling),io=t,oo=!0,ao=null,null!==e&&(Qr[Jr++]=Xr,Qr[Jr++]=Yr,Qr[Jr++]=$r,Xr=e.id,Yr=e.overflow,$r=t),t=Fs(t,r.children),t.flags|=4096,t)}(e,t,c,o,r,a,i);if(s){s=o.fallback,c=t.mode,r=(a=e.child).sibling;var l={mode:"hidden",children:o.children};return 1&c||t.child===a?(o=Dl(a,l)).subtreeFlags=14680064&a.subtreeFlags:((o=t.child).childLanes=0,o.pendingProps=l,t.deletions=null),null!==r?s=Dl(r,s):(s=Al(s,c,i,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,c=null===(c=e.child.memoizedState)?Us(i):{baseLanes:c.baseLanes|i,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~i,t.memoizedState=As,o}return e=(s=e.child).sibling,o=Dl(s,{mode:"visible",children:o.children}),!(1&t.mode)&&(o.lanes=i),o.return=t,o.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=o,t.memoizedState=null,o}function Fs(e,t){return(t=Ul({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,i){return null!==i&&go(i),So(t,e.child,null,n),(e=Fs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zs(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),_o(e.return,t,n)}function Vs(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function qs(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(ws(e,t,i.children,n),2&(i=ta.current))i=1&i|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zs(e,n,t);else if(19===e.tag)zs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(xr(ta,i),1&t.mode)switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===na(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Vs(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===na(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Vs(t,!0,n,null,o);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Ws(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Uc|=t.lanes,!(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(n(153));if(null!==t.child){for(i=Dl(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Dl(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function Ks(e,t){if(!oo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Gs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Qs(e,t,i){var o=t.pendingProps;switch(no(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(t),null;case 1:case 17:return Mr(t.type)&&Dr(),Gs(t),null;case 3:return o=t.stateNode,Yo(),Pr(_r),Pr(Or),ra(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),null!==e&&null!==e.child||(po(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==ao&&(sl(ao),ao=null))),Ms(e,t),Gs(t),null;case 5:ea(t);var a=$o(Jo.current);if(i=t.type,null!==e&&null!=t.stateNode)Ds(e,t,i,o,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!o){if(null===t.stateNode)throw Error(n(166));return Gs(t),null}if(e=$o(Go.current),po(t)){o=t.stateNode,i=t.type;var s=t.memoizedProps;switch(o[pr]=t,o[fr]=s,e=!!(1&t.mode),i){case"dialog":Bi("cancel",o),Bi("close",o);break;case"iframe":case"object":case"embed":Bi("load",o);break;case"video":case"audio":for(a=0;a<Ai.length;a++)Bi(Ai[a],o);break;case"source":Bi("error",o);break;case"img":case"image":case"link":Bi("error",o),Bi("load",o);break;case"details":Bi("toggle",o);break;case"input":X(o,s),Bi("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!s.multiple},Bi("invalid",o);break;case"textarea":oe(o,s),Bi("invalid",o)}for(var c in ye(i,s),a=null,s)if(s.hasOwnProperty(c)){var l=s[c];"children"===c?"string"==typeof l?o.textContent!==l&&(!0!==s.suppressHydrationWarning&&Zi(o.textContent,l,e),a=["children",l]):"number"==typeof l&&o.textContent!==""+l&&(!0!==s.suppressHydrationWarning&&Zi(o.textContent,l,e),a=["children",""+l]):r.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Bi("scroll",o)}switch(i){case"input":G(o),ee(o,s,!0);break;case"textarea":G(o),se(o);break;case"select":case"option":break;default:"function"==typeof s.onClick&&(o.onclick=er)}o=a,t.updateQueue=o,null!==o&&(t.flags|=4)}else{c=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ce(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof o.is?e=c.createElement(i,{is:o.is}):(e=c.createElement(i),"select"===i&&(c=e,o.multiple?c.multiple=!0:o.size&&(c.size=o.size))):e=c.createElementNS(e,i),e[pr]=t,e[fr]=o,Ns(e,t,!1,!1),t.stateNode=e;e:{switch(c=ke(i,o),i){case"dialog":Bi("cancel",e),Bi("close",e),a=o;break;case"iframe":case"object":case"embed":Bi("load",e),a=o;break;case"video":case"audio":for(a=0;a<Ai.length;a++)Bi(Ai[a],e);a=o;break;case"source":Bi("error",e),a=o;break;case"img":case"image":case"link":Bi("error",e),Bi("load",e),a=o;break;case"details":Bi("toggle",e),a=o;break;case"input":X(e,o),a=$(e,o),Bi("invalid",e);break;case"option":default:a=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},a=j({},o,{value:void 0}),Bi("invalid",e);break;case"textarea":oe(e,o),a=re(e,o),Bi("invalid",e)}for(s in ye(i,a),l=a)if(l.hasOwnProperty(s)){var u=l[s];"style"===s?ve(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"==typeof u?("textarea"!==i||""!==u)&&pe(e,u):"number"==typeof u&&pe(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(r.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Bi("scroll",e):null!=u&&b(e,s,u,c))}switch(i){case"input":G(e),ee(e,o,!1);break;case"textarea":G(e),se(e);break;case"option":null!=o.value&&e.setAttribute("value",""+H(o.value));break;case"select":e.multiple=!!o.multiple,null!=(s=o.value)?ie(e,!!o.multiple,s,!1):null!=o.defaultValue&&ie(e,!!o.multiple,o.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=er)}switch(i){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gs(t),null;case 6:if(e&&null!=t.stateNode)Ls(e,t,e.memoizedProps,o);else{if("string"!=typeof o&&null===t.stateNode)throw Error(n(166));if(i=$o(Jo.current),$o(Go.current),po(t)){if(o=t.stateNode,i=t.memoizedProps,o[pr]=t,(s=o.nodeValue!==i)&&null!==(e=io))switch(e.tag){case 3:Zi(o.nodeValue,i,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zi(o.nodeValue,i,!!(1&e.mode))}s&&(t.flags|=4)}else(o=(9===i.nodeType?i:i.ownerDocument).createTextNode(o))[pr]=t,t.stateNode=o}return Gs(t),null;case 13:if(Pr(ta),o=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(oo&&null!==ro&&1&t.mode&&!(128&t.flags))fo(),mo(),t.flags|=98560,s=!1;else if(s=po(t),null!==o&&null!==o.dehydrated){if(null===e){if(!s)throw Error(n(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(n(317));s[pr]=t}else mo(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gs(t),s=!1}else null!==ao&&(sl(ao),ao=null),s=!0;if(!s)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=i,t):((o=null!==o)!==(null!==e&&null!==e.memoizedState)&&o&&(t.child.flags|=8192,1&t.mode&&(null===e||1&ta.current?0===Lc&&(Lc=3):gl())),null!==t.updateQueue&&(t.flags|=4),Gs(t),null);case 4:return Yo(),Ms(e,t),null===e&&qi(t.stateNode.containerInfo),Gs(t),null;case 10:return Oo(t.type._context),Gs(t),null;case 19:if(Pr(ta),null===(s=t.memoizedState))return Gs(t),null;if(o=!!(128&t.flags),null===(c=s.rendering))if(o)Ks(s,!1);else{if(0!==Lc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(c=na(e))){for(t.flags|=128,Ks(s,!1),null!==(o=c.updateQueue)&&(t.updateQueue=o,t.flags|=4),t.subtreeFlags=0,o=i,i=t.child;null!==i;)e=o,(s=i).flags&=14680066,null===(c=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return xr(ta,1&ta.current|2),t.child}e=e.sibling}null!==s.tail&&Ye()>qc&&(t.flags|=128,o=!0,Ks(s,!1),t.lanes=4194304)}else{if(!o)if(null!==(e=na(c))){if(t.flags|=128,o=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),Ks(s,!0),null===s.tail&&"hidden"===s.tailMode&&!c.alternate&&!oo)return Gs(t),null}else 2*Ye()-s.renderingStartTime>qc&&1073741824!==i&&(t.flags|=128,o=!0,Ks(s,!1),t.lanes=4194304);s.isBackwards?(c.sibling=t.child,t.child=c):(null!==(i=s.last)?i.sibling=c:t.child=c,s.last=c)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ye(),t.sibling=null,i=ta.current,xr(ta,o?1&i|2:1&i),t):(Gs(t),null);case 22:case 23:return hl(),o=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==o&&(t.flags|=8192),o&&1&t.mode?!!(1073741824&Mc)&&(Gs(t),6&t.subtreeFlags&&(t.flags|=8192)):Gs(t),null;case 24:case 25:return null}throw Error(n(156,t.tag))}function Js(e,t){switch(no(t),t.tag){case 1:return Mr(t.type)&&Dr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Yo(),Pr(_r),Pr(Or),ra(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return ea(t),null;case 13:if(Pr(ta),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(n(340));mo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Pr(ta),null;case 4:return Yo(),null;case 10:return Oo(t.type._context),null;case 22:case 23:return hl(),null;default:return null}}Ns=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ms=function(){},Ds=function(e,t,n,i){var o=e.memoizedProps;if(o!==i){e=t.stateNode,$o(Go.current);var a,s=null;switch(n){case"input":o=$(e,o),i=$(e,i),s=[];break;case"select":o=j({},o,{value:void 0}),i=j({},i,{value:void 0}),s=[];break;case"textarea":o=re(e,o),i=re(e,i),s=[];break;default:"function"!=typeof o.onClick&&"function"==typeof i.onClick&&(e.onclick=er)}for(u in ye(n,i),n=null,o)if(!i.hasOwnProperty(u)&&o.hasOwnProperty(u)&&null!=o[u])if("style"===u){var c=o[u];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(r.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var l=i[u];if(c=null!=o?o[u]:void 0,i.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(a in c)!c.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&c[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(s||(s=[]),s.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(s=s||[]).push(u,l)):"children"===u?"string"!=typeof l&&"number"!=typeof l||(s=s||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(r.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Bi("scroll",e),s||c===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Ls=function(e,t,n,i){n!==i&&(t.flags|=4)};var $s=!1,Xs=!1,Ys="function"==typeof WeakSet?WeakSet:Set,Zs=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){El(e,t,n)}else n.current=null}function tc(e,t,n){try{n()}catch(n){El(e,t,n)}}var nc=!1;function ic(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tc(t,n,o)}r=r.next}while(r!==i)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function oc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function ac(e){var t=e.alternate;null!==t&&(e.alternate=null,ac(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[pr],delete t[fr],delete t[gr],delete t[vr],delete t[br])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sc(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=er));else if(4!==i&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}function uc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}var dc=null,hc=!1;function pc(e,t,n){for(n=n.child;null!==n;)fc(e,t,n),n=n.sibling}function fc(e,t,n){if(at&&"function"==typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(ot,n)}catch(e){}switch(n.tag){case 5:Xs||ec(n,t);case 6:var i=dc,r=hc;dc=null,pc(e,t,n),hc=r,null!==(dc=i)&&(hc?(e=dc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dc.removeChild(n.stateNode));break;case 18:null!==dc&&(hc?(e=dc,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),qt(e)):lr(dc,n.stateNode));break;case 4:i=dc,r=hc,dc=n.stateNode.containerInfo,hc=!0,pc(e,t,n),dc=i,hc=r;break;case 0:case 11:case 14:case 15:if(!Xs&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,a=o.destroy;o=o.tag,void 0!==a&&(2&o||4&o)&&tc(n,t,a),r=r.next}while(r!==i)}pc(e,t,n);break;case 1:if(!Xs&&(ec(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(e){El(n,t,e)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?(Xs=(i=Xs)||null!==n.memoizedState,pc(e,t,n),Xs=i):pc(e,t,n);break;default:pc(e,t,n)}}function mc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ys),t.forEach((function(t){var i=Ol.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function gc(e,t){var i=t.deletions;if(null!==i)for(var r=0;r<i.length;r++){var o=i[r];try{var a=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:dc=c.stateNode,hc=!1;break e;case 3:case 4:dc=c.stateNode.containerInfo,hc=!0;break e}c=c.return}if(null===dc)throw Error(n(160));fc(a,s,o),dc=null,hc=!1;var l=o.alternate;null!==l&&(l.return=null),o.return=null}catch(e){El(o,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vc(t,e),t=t.sibling}function vc(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gc(t,e),bc(e),4&r){try{ic(3,e,e.return),rc(3,e)}catch(t){El(e,e.return,t)}try{ic(5,e,e.return)}catch(t){El(e,e.return,t)}}break;case 1:gc(t,e),bc(e),512&r&&null!==i&&ec(i,i.return);break;case 5:if(gc(t,e),bc(e),512&r&&null!==i&&ec(i,i.return),32&e.flags){var o=e.stateNode;try{pe(o,"")}catch(t){El(e,e.return,t)}}if(4&r&&null!=(o=e.stateNode)){var a=e.memoizedProps,s=null!==i?i.memoizedProps:a,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===a.type&&null!=a.name&&Y(o,a),ke(c,s);var u=ke(c,a);for(s=0;s<l.length;s+=2){var d=l[s],h=l[s+1];"style"===d?ve(o,h):"dangerouslySetInnerHTML"===d?he(o,h):"children"===d?pe(o,h):b(o,d,h,u)}switch(c){case"input":Z(o,a);break;case"textarea":ae(o,a);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ie(o,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ie(o,!!a.multiple,a.defaultValue,!0):ie(o,!!a.multiple,a.multiple?[]:"",!1))}o[fr]=a}catch(t){El(e,e.return,t)}}break;case 6:if(gc(t,e),bc(e),4&r){if(null===e.stateNode)throw Error(n(162));o=e.stateNode,a=e.memoizedProps;try{o.nodeValue=a}catch(t){El(e,e.return,t)}}break;case 3:if(gc(t,e),bc(e),4&r&&null!==i&&i.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(t){El(e,e.return,t)}break;case 4:default:gc(t,e),bc(e);break;case 13:gc(t,e),bc(e),8192&(o=e.child).flags&&(a=null!==o.memoizedState,o.stateNode.isHidden=a,!a||null!==o.alternate&&null!==o.alternate.memoizedState||(Vc=Ye())),4&r&&mc(e);break;case 22:if(d=null!==i&&null!==i.memoizedState,1&e.mode?(Xs=(u=Xs)||d,gc(t,e),Xs=u):gc(t,e),bc(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Zs=e,d=e.child;null!==d;){for(h=Zs=d;null!==Zs;){switch(f=(p=Zs).child,p.tag){case 0:case 11:case 14:case 15:ic(4,p,p.return);break;case 1:ec(p,p.return);var m=p.stateNode;if("function"==typeof m.componentWillUnmount){r=p,i=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(e){El(r,i,e)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){Sc(h);continue}}null!==f?(f.return=p,Zs=f):Sc(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{o=h.stateNode,u?"function"==typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=h.stateNode,s=null!=(l=h.memoizedProps.style)&&l.hasOwnProperty("display")?l.display:null,c.style.display=ge("display",s))}catch(t){El(e,e.return,t)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(t){El(e,e.return,t)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gc(t,e),bc(e),4&r&&mc(e);case 21:}}function bc(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(sc(i)){var r=i;break e}i=i.return}throw Error(n(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(pe(o,""),r.flags&=-33),uc(e,cc(e),o);break;case 3:case 4:var a=r.stateNode.containerInfo;lc(e,cc(e),a);break;default:throw Error(n(161))}}catch(t){El(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yc(e,t,n){Zs=e,kc(e)}function kc(e,t,n){for(var i=!!(1&e.mode);null!==Zs;){var r=Zs,o=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||$s;if(!a){var s=r.alternate,c=null!==s&&null!==s.memoizedState||Xs;s=$s;var l=Xs;if($s=a,(Xs=c)&&!l)for(Zs=r;null!==Zs;)c=(a=Zs).child,22===a.tag&&null!==a.memoizedState?Tc(r):null!==c?(c.return=a,Zs=c):Tc(r);for(;null!==o;)Zs=o,kc(o),o=o.sibling;Zs=r,$s=s,Xs=l}wc(e)}else 8772&r.subtreeFlags&&null!==o?(o.return=r,Zs=o):wc(e)}}function wc(e){for(;null!==Zs;){var t=Zs;if(8772&t.flags){var i=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Xs||rc(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xs)if(null===i)r.componentDidMount();else{var o=t.elementType===t.type?i.memoizedProps:is(t.type,i.memoizedProps);r.componentDidUpdate(o,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Ho(t,a,r);break;case 3:var s=t.updateQueue;if(null!==s){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}Ho(t,s,i)}break;case 5:var c=t.stateNode;if(null===i&&4&t.flags){i=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&qt(h)}}}break;default:throw Error(n(163))}Xs||512&t.flags&&oc(t)}catch(e){El(t,t.return,e)}}if(t===e){Zs=null;break}if(null!==(i=t.sibling)){i.return=t.return,Zs=i;break}Zs=t.return}}function Sc(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function Tc(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(e){El(t,n,e)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(e){El(t,r,e)}}var o=t.return;try{oc(t)}catch(e){El(t,o,e)}break;case 5:var a=t.return;try{oc(t)}catch(e){El(t,a,e)}}}catch(e){El(t,t.return,e)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var Cc,Ec=Math.ceil,Pc=y.ReactCurrentDispatcher,xc=y.ReactCurrentOwner,Rc=y.ReactCurrentBatchConfig,Oc=0,_c=null,Ic=null,Nc=0,Mc=0,Dc=Er(0),Lc=0,Ac=null,Uc=0,jc=0,Fc=0,Bc=null,zc=null,Vc=0,qc=1/0,Wc=null,Hc=!1,Kc=null,Gc=null,Qc=!1,Jc=null,$c=0,Xc=0,Yc=null,Zc=-1,el=0;function tl(){return 6&Oc?Ye():-1!==Zc?Zc:Zc=Ye()}function nl(e){return 1&e.mode?2&Oc&&0!==Nc?Nc&-Nc:null!==vo.transition?(0===el&&(el=gt()),el):0!==(e=kt)?e:e=void 0===(e=window.event)?16:Xt(e.type):1}function il(e,t,i,r){if(50<Xc)throw Xc=0,Yc=null,Error(n(185));bt(e,i,r),2&Oc&&e===_c||(e===_c&&(!(2&Oc)&&(jc|=i),4===Lc&&cl(e,Nc)),rl(e,r),1===i&&0===Oc&&!(1&t.mode)&&(qc=Ye()+500,Br&&qr()))}function rl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-st(o),s=1<<a,c=r[a];-1===c?s&n&&!(s&i)||(r[a]=ft(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var i=pt(e,e===_c?Nc:0);if(0===i)null!==n&&Je(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Je(n),1===t)0===e.tag?function(e){Br=!0,Vr(e)}(ll.bind(null,e)):Vr(ll.bind(null,e)),sr((function(){!(6&Oc)&&qr()})),n=null;else{switch(wt(i)){case 1:n=et;break;case 4:n=tt;break;case 16:default:n=nt;break;case 536870912:n=rt}n=_l(n,ol.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ol(e,t){if(Zc=-1,el=0,6&Oc)throw Error(n(327));var i=e.callbackNode;if(Tl()&&e.callbackNode!==i)return null;var r=pt(e,e===_c?Nc:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=vl(e,r);else{t=r;var o=Oc;Oc|=2;var a=ml();for(_c===e&&Nc===t||(Wc=null,qc=Ye()+500,pl(e,t));;)try{yl();break}catch(t){fl(e,t)}Ro(),Pc.current=a,Oc=o,null!==Ic?t=0:(_c=null,Nc=0,t=Lc)}if(0!==t){if(2===t&&(0!==(o=mt(e))&&(r=o,t=al(e,o))),1===t)throw i=Ac,pl(e,0),cl(e,r),rl(e,Ye()),i;if(6===t)cl(e,r);else{if(o=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!ci(o(),r))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)||(t=vl(e,r),2===t&&(a=mt(e),0!==a&&(r=a,t=al(e,a))),1!==t)))throw i=Ac,pl(e,0),cl(e,r),rl(e,Ye()),i;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(n(345));case 2:case 5:Sl(e,zc,Wc);break;case 3:if(cl(e,r),(130023424&r)===r&&10<(t=Vc+500-Ye())){if(0!==pt(e,0))break;if(((o=e.suspendedLanes)&r)!==r){tl(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=rr(Sl.bind(null,e,zc,Wc),t);break}Sl(e,zc,Wc);break;case 4:if(cl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var s=31-st(r);a=1<<s,(s=t[s])>o&&(o=s),r&=~a}if(r=o,10<(r=(120>(r=Ye()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ec(r/1960))-r)){e.timeoutHandle=rr(Sl.bind(null,e,zc,Wc),r);break}Sl(e,zc,Wc);break;default:throw Error(n(329))}}}return rl(e,Ye()),e.callbackNode===i?ol.bind(null,e):null}function al(e,t){var n=Bc;return e.current.memoizedState.isDehydrated&&(pl(e,t).flags|=256),2!==(e=vl(e,t))&&(t=zc,zc=n,null!==t&&sl(t)),e}function sl(e){null===zc?zc=e:zc.push.apply(zc,e)}function cl(e,t){for(t&=~Fc,t&=~jc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),i=1<<n;e[n]=-1,t&=~i}}function ll(e){if(6&Oc)throw Error(n(327));Tl();var t=pt(e,0);if(!(1&t))return rl(e,Ye()),null;var i=vl(e,t);if(0!==e.tag&&2===i){var r=mt(e);0!==r&&(t=r,i=al(e,r))}if(1===i)throw i=Ac,pl(e,0),cl(e,t),rl(e,Ye()),i;if(6===i)throw Error(n(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sl(e,zc,Wc),rl(e,Ye()),null}function ul(e,t){var n=Oc;Oc|=1;try{return e(t)}finally{0===(Oc=n)&&(qc=Ye()+500,Br&&qr())}}function dl(e){null!==Jc&&0===Jc.tag&&!(6&Oc)&&Tl();var t=Oc;Oc|=1;var n=Rc.transition,i=kt;try{if(Rc.transition=null,kt=1,e)return e()}finally{kt=i,Rc.transition=n,!(6&(Oc=t))&&qr()}}function hl(){Mc=Dc.current,Pr(Dc)}function pl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,or(n)),null!==Ic)for(n=Ic.return;null!==n;){var i=n;switch(no(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Dr();break;case 3:Yo(),Pr(_r),Pr(Or),ra();break;case 5:ea(i);break;case 4:Yo();break;case 13:case 19:Pr(ta);break;case 10:Oo(i.type._context);break;case 22:case 23:hl()}n=n.return}if(_c=e,Ic=e=Dl(e.current,null),Nc=Mc=t,Lc=0,Ac=null,Fc=jc=Uc=0,zc=Bc=null,null!==Mo){for(t=0;t<Mo.length;t++)if(null!==(i=(n=Mo[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var a=o.next;o.next=r,i.next=a}n.pending=i}Mo=null}return e}function fl(e,t){for(;;){var i=Ic;try{if(Ro(),oa.current=Za,da){for(var r=ca.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}da=!1}if(sa=0,ua=la=ca=null,ha=!1,pa=0,xc.current=null,null===i||null===i.return){Lc=1,Ac=t,Ic=null;break}e:{var a=e,s=i.return,c=i,l=t;if(t=Nc,c.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var u=l,d=c,h=d.tag;if(!(1&d.mode||0!==h&&11!==h&&15!==h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=vs(s);if(null!==f){f.flags&=-257,bs(f,s,c,0,t),1&f.mode&&gs(a,u,t),l=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break e}if(!(1&t)){gs(a,u,t),gl();break e}l=Error(n(426))}else if(oo&&1&c.mode){var v=vs(s);if(null!==v){!(65536&v.flags)&&(v.flags|=256),bs(v,s,c,0,t),go(us(l,c));break e}}a=l=us(l,c),4!==Lc&&(Lc=2),null===Bc?Bc=[a]:Bc.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,qo(a,fs(0,l,t));break e;case 1:c=l;var b=a.type,y=a.stateNode;if(!(128&a.flags||"function"!=typeof b.getDerivedStateFromError&&(null===y||"function"!=typeof y.componentDidCatch||null!==Gc&&Gc.has(y)))){a.flags|=65536,t&=-t,a.lanes|=t,qo(a,ms(a,c,t));break e}}a=a.return}while(null!==a)}wl(i)}catch(e){t=e,Ic===i&&null!==i&&(Ic=i=i.return);continue}break}}function ml(){var e=Pc.current;return Pc.current=Za,null===e?Za:e}function gl(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===_c||!(268435455&Uc)&&!(268435455&jc)||cl(_c,Nc)}function vl(e,t){var i=Oc;Oc|=2;var r=ml();for(_c===e&&Nc===t||(Wc=null,pl(e,t));;)try{bl();break}catch(t){fl(e,t)}if(Ro(),Oc=i,Pc.current=r,null!==Ic)throw Error(n(261));return _c=null,Nc=0,Lc}function bl(){for(;null!==Ic;)kl(Ic)}function yl(){for(;null!==Ic&&!$e();)kl(Ic)}function kl(e){var t=Cc(e.alternate,e,Mc);e.memoizedProps=e.pendingProps,null===t?wl(e):Ic=t,xc.current=null}function wl(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=Js(n,t)))return n.flags&=32767,void(Ic=n);if(null===e)return Lc=6,void(Ic=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Qs(n,t,Mc)))return void(Ic=n);if(null!==(t=t.sibling))return void(Ic=t);Ic=t=e}while(null!==t);0===Lc&&(Lc=5)}function Sl(e,t,i){var r=kt,o=Rc.transition;try{Rc.transition=null,kt=1,function(e,t,i,r){do{Tl()}while(null!==Jc);if(6&Oc)throw Error(n(327));i=e.finishedWork;var o=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(n(177));e.callbackNode=null,e.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-st(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,a),e===_c&&(Ic=_c=null,Nc=0),!(2064&i.subtreeFlags)&&!(2064&i.flags)||Qc||(Qc=!0,_l(nt,(function(){return Tl(),null}))),a=!!(15990&i.flags),!!(15990&i.subtreeFlags)||a){a=Rc.transition,Rc.transition=null;var s=kt;kt=1;var c=Oc;Oc|=4,xc.current=null,function(e,t){if(tr=Ht,fi(e=pi())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(r&&0!==r.rangeCount){i=r.anchorNode;var o=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{i.nodeType,a.nodeType}catch(e){i=null;break e}var s=0,c=-1,l=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==i||0!==o&&3!==h.nodeType||(c=s+o),h!==a||0!==r&&3!==h.nodeType||(l=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===i&&++u===o&&(c=s),p===a&&++d===r&&(l=s),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}i=-1===c||-1===l?null:{start:c,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(nr={focusedElem:e,selectionRange:i},Ht=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,1028&t.subtreeFlags&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,b=t.stateNode,y=b.getSnapshotBeforeUpdate(t.elementType===t.type?g:is(t.type,g),v);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var k=t.stateNode.containerInfo;1===k.nodeType?k.textContent="":9===k.nodeType&&k.documentElement&&k.removeChild(k.documentElement);break;default:throw Error(n(163))}}catch(e){El(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}m=nc,nc=!1}(e,i),vc(i,e),mi(nr),Ht=!!tr,nr=tr=null,e.current=i,yc(i),Xe(),Oc=c,kt=s,Rc.transition=a}else e.current=i;if(Qc&&(Qc=!1,Jc=e,$c=o),a=e.pendingLanes,0===a&&(Gc=null),function(e){if(at&&"function"==typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(ot,e,void 0,!(128&~e.current.flags))}catch(e){}}(i.stateNode),rl(e,Ye()),null!==t)for(r=e.onRecoverableError,i=0;i<t.length;i++)o=t[i],r(o.value,{componentStack:o.stack,digest:o.digest});if(Hc)throw Hc=!1,e=Kc,Kc=null,e;!!(1&$c)&&0!==e.tag&&Tl(),a=e.pendingLanes,1&a?e===Yc?Xc++:(Xc=0,Yc=e):Xc=0,qr()}(e,t,i,r)}finally{Rc.transition=o,kt=r}return null}function Tl(){if(null!==Jc){var e=wt($c),t=Rc.transition,i=kt;try{if(Rc.transition=null,kt=16>e?16:e,null===Jc)var r=!1;else{if(e=Jc,Jc=null,$c=0,6&Oc)throw Error(n(331));var o=Oc;for(Oc|=4,Zs=e.current;null!==Zs;){var a=Zs,s=a.child;if(16&Zs.flags){var c=a.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for(Zs=u;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:ic(8,d,a)}var h=d.child;if(null!==h)h.return=d,Zs=h;else for(;null!==Zs;){var p=(d=Zs).sibling,f=d.return;if(ac(d),d===u){Zs=null;break}if(null!==p){p.return=f,Zs=p;break}Zs=f}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Zs=a}}if(2064&a.subtreeFlags&&null!==s)s.return=a,Zs=s;else e:for(;null!==Zs;){if(2048&(a=Zs).flags)switch(a.tag){case 0:case 11:case 15:ic(9,a,a.return)}var b=a.sibling;if(null!==b){b.return=a.return,Zs=b;break e}Zs=a.return}}var y=e.current;for(Zs=y;null!==Zs;){var k=(s=Zs).child;if(2064&s.subtreeFlags&&null!==k)k.return=s,Zs=k;else e:for(s=y;null!==Zs;){if(2048&(c=Zs).flags)try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(e){El(c,c.return,e)}if(c===s){Zs=null;break e}var w=c.sibling;if(null!==w){w.return=c.return,Zs=w;break e}Zs=c.return}}if(Oc=o,qr(),at&&"function"==typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(ot,e)}catch(e){}r=!0}return r}finally{kt=i,Rc.transition=t}}return!1}function Cl(e,t,n){e=zo(e,t=fs(0,t=us(n,t),1),1),t=tl(),null!==e&&(bt(e,1,t),rl(e,t))}function El(e,t,n){if(3===e.tag)Cl(e,e,n);else for(;null!==t;){if(3===t.tag){Cl(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Gc||!Gc.has(i))){t=zo(t,e=ms(t,e=us(n,e),1),1),e=tl(),null!==t&&(bt(t,1,e),rl(t,e));break}}t=t.return}}function Pl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&n,_c===e&&(Nc&n)===n&&(4===Lc||3===Lc&&(130023424&Nc)===Nc&&500>Ye()-Vc?pl(e,0):Fc|=n),rl(e,t)}function xl(e,t){0===t&&(1&e.mode?(t=dt,!(130023424&(dt<<=1))&&(dt=4194304)):t=1);var n=tl();null!==(e=Ao(e,t))&&(bt(e,t,n),rl(e,n))}function Rl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),xl(e,n)}function Ol(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(i=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(n(314))}null!==r&&r.delete(t),xl(e,i)}function _l(e,t){return Qe(e,t)}function Il(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nl(e,t,n,i){return new Il(e,t,n,i)}function Ml(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dl(e,t){var n=e.alternate;return null===n?((n=Nl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ll(e,t,i,r,o,a){var s=2;if(r=e,"function"==typeof e)Ml(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case T:return Al(i.children,o,a,t);case C:s=8,o|=8;break;case P:return(e=Nl(12,i,t,2|o)).elementType=P,e.lanes=a,e;case _:return(e=Nl(13,i,t,o)).elementType=_,e.lanes=a,e;case I:return(e=Nl(19,i,t,o)).elementType=I,e.lanes=a,e;case D:return Ul(i,o,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case x:s=10;break e;case R:s=9;break e;case O:s=11;break e;case N:s=14;break e;case M:s=16,r=null;break e}throw Error(n(130,null==e?e:typeof e,""))}return(t=Nl(s,i,t,o)).elementType=e,t.type=r,t.lanes=a,t}function Al(e,t,n,i){return(e=Nl(7,e,i,t)).lanes=n,e}function Ul(e,t,n,i){return(e=Nl(22,e,i,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function jl(e,t,n){return(e=Nl(6,e,null,t)).lanes=n,e}function Fl(e,t,n){return(t=Nl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bl(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function zl(e,t,n,i,r,o,a,s,c){return e=new Bl(e,t,n,s,c),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Nl(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},jo(o),e}function Vl(e){if(!e)return Rr;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(n(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Mr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(n(171))}if(1===e.tag){var i=e.type;if(Mr(i))return Ar(e,i,t)}return t}function ql(e,t,n,i,r,o,a,s,c){return(e=zl(n,i,!0,e,0,o,0,s,c)).context=Vl(null),n=e.current,(o=Bo(i=tl(),r=nl(n))).callback=null!=t?t:null,zo(n,o,r),e.current.lanes=r,bt(e,r,i),rl(e,i),e}function Wl(e,t,n,i){var r=t.current,o=tl(),a=nl(r);return n=Vl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Bo(o,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=zo(r,t,a))&&(il(e,r,a,o),Vo(e,r,a)),a}function Hl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Kl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gl(e,t){Kl(e,t),(e=e.alternate)&&Kl(e,t)}Cc=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||_r.current)ks=!0;else{if(!(e.lanes&i||128&t.flags))return ks=!1,function(e,t,n){switch(t.tag){case 3:_s(t),mo();break;case 5:Zo(t);break;case 1:Mr(t.type)&&Ur(t);break;case 4:Xo(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;xr(Co,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(xr(ta,1&ta.current),t.flags|=128,null):n&t.child.childLanes?js(e,t,n):(xr(ta,1&ta.current),null!==(e=Hs(e,t,n))?e.sibling:null);xr(ta,1&ta.current);break;case 19:if(i=!!(n&t.childLanes),128&e.flags){if(i)return qs(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),xr(ta,ta.current),i)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,n)}return Hs(e,t,n)}(e,t,i);ks=!!(131072&e.flags)}else ks=!1,oo&&1048576&t.flags&&eo(t,Gr,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ws(e,t),e=t.pendingProps;var o=Nr(t,Or.current);Io(t,i),o=va(null,t,r,e,o,i);var a=ba();return t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Mr(r)?(a=!0,Ur(t)):a=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,jo(t),o.updater=os,t.stateNode=o,o._reactInternals=t,ls(t,r,e,i),t=Os(null,t,r,!0,a,i)):(t.tag=0,oo&&a&&to(t),ws(null,t,o,i),t=t.child),t;case 16:r=t.elementType;e:{switch(Ws(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"==typeof e)return Ml(e)?1:0;if(null!=e){if((e=e.$$typeof)===O)return 11;if(e===N)return 14}return 2}(r),e=is(r,e),o){case 0:t=xs(null,t,r,e,i);break e;case 1:t=Rs(null,t,r,e,i);break e;case 11:t=Ss(null,t,r,e,i);break e;case 14:t=Ts(null,t,r,is(r.type,e),i);break e}throw Error(n(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,xs(e,t,r,o=t.elementType===r?o:is(r,o),i);case 1:return r=t.type,o=t.pendingProps,Rs(e,t,r,o=t.elementType===r?o:is(r,o),i);case 3:e:{if(_s(t),null===e)throw Error(n(387));r=t.pendingProps,o=(a=t.memoizedState).element,Fo(e,t),Wo(t,r,null,i);var s=t.memoizedState;if(r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Is(e,t,r,i,o=us(Error(n(423)),t));break e}if(r!==o){t=Is(e,t,r,i,o=us(Error(n(424)),t));break e}for(ro=ur(t.stateNode.containerInfo.firstChild),io=t,oo=!0,ao=null,i=To(t,null,r,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(mo(),r===o){t=Hs(e,t,i);break e}ws(e,t,r,i)}t=t.child}return t;case 5:return Zo(t),null===e&&uo(t),r=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,s=o.children,ir(r,o)?s=null:null!==a&&ir(r,a)&&(t.flags|=32),Ps(e,t),ws(e,t,s,i),t.child;case 6:return null===e&&uo(t),null;case 13:return js(e,t,i);case 4:return Xo(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=So(t,null,r,i):ws(e,t,r,i),t.child;case 11:return r=t.type,o=t.pendingProps,Ss(e,t,r,o=t.elementType===r?o:is(r,o),i);case 7:return ws(e,t,t.pendingProps,i),t.child;case 8:case 12:return ws(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,a=t.memoizedProps,s=o.value,xr(Co,r._currentValue),r._currentValue=s,null!==a)if(ci(a.value,s)){if(a.children===o.children&&!_r.current){t=Hs(e,t,i);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){s=a.child;for(var l=c.firstContext;null!==l;){if(l.context===r){if(1===a.tag){(l=Bo(-1,i&-i)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}a.lanes|=i,null!==(l=a.alternate)&&(l.lanes|=i),_o(a.return,i,t),c.lanes|=i;break}l=l.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(n(341));s.lanes|=i,null!==(c=s.alternate)&&(c.lanes|=i),_o(s,i,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}ws(e,t,o.children,i),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Io(t,i),r=r(o=No(o)),t.flags|=1,ws(e,t,r,i),t.child;case 14:return o=is(r=t.type,t.pendingProps),Ts(e,t,r,o=is(r.type,o),i);case 15:return Cs(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:is(r,o),Ws(e,t),t.tag=1,Mr(r)?(e=!0,Ur(t)):e=!1,Io(t,i),ss(t,r,o),ls(t,r,o,i),Os(null,t,r,!0,e,i);case 19:return qs(e,t,i);case 22:return Es(e,t,i)}throw Error(n(156,t.tag))};var Ql="function"==typeof reportError?reportError:function(e){console.error(e)};function Jl(e){this._internalRoot=e}function $l(e){this._internalRoot=e}function Xl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Yl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zl(){}function eu(e,t,n,i,r){var o=n._reactRootContainer;if(o){var a=o;if("function"==typeof r){var s=r;r=function(){var e=Hl(a);s.call(e)}}Wl(t,a,e,r)}else a=function(e,t,n,i,r){if(r){if("function"==typeof i){var o=i;i=function(){var e=Hl(a);o.call(e)}}var a=ql(t,i,e,0,null,!1,0,"",Zl);return e._reactRootContainer=a,e[mr]=a.current,qi(8===e.nodeType?e.parentNode:e),dl(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof i){var s=i;i=function(){var e=Hl(c);s.call(e)}}var c=zl(e,0,!1,null,0,!1,0,"",Zl);return e._reactRootContainer=c,e[mr]=c.current,qi(8===e.nodeType?e.parentNode:e),dl((function(){Wl(t,c,n,i)})),c}(n,t,e,r,i);return Hl(a)}$l.prototype.render=Jl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(n(409));Wl(e,t,null,null)},$l.prototype.unmount=Jl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dl((function(){Wl(null,e,null,null)})),t[mr]=null}},$l.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&jt(e)}},St=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),rl(t,Ye()),!(6&Oc)&&(qc=Ye()+500,qr()))}break;case 13:dl((function(){var t=Ao(e,1);if(null!==t){var n=tl();il(t,e,1,n)}})),Gl(e,1)}},Tt=function(e){if(13===e.tag){var t=Ao(e,134217728);if(null!==t)il(t,e,134217728,tl());Gl(e,134217728)}},Ct=function(e){if(13===e.tag){var t=nl(e),n=Ao(e,t);if(null!==n)il(n,e,t,tl());Gl(e,t)}},Et=function(){return kt},Pt=function(e,t){var n=kt;try{return kt=e,t()}finally{kt=n}},Te=function(e,t,i){switch(t){case"input":if(Z(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var o=Sr(r);if(!o)throw Error(n(90));Q(r),Z(r,o)}}}break;case"textarea":ae(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Oe=ul,_e=dl;var tu={usingClientEntryPoint:!1,Events:[kr,wr,Sr,xe,Re,ul]},nu={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ke(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{ot=ru.inject(iu),at=ru}catch(de){}}return S.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,S.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xl(t))throw Error(n(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,i)},S.createRoot=function(e,t){if(!Xl(e))throw Error(n(299));var i=!1,r="",o=Ql;return null!=t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=zl(e,1,!1,null,0,i,0,r,o),e[mr]=t.current,qi(8===e.nodeType?e.parentNode:e),new Jl(t)},S.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(n(188));throw e=Object.keys(e).join(","),Error(n(268,e))}return e=null===(e=Ke(t))?null:e.stateNode},S.flushSync=function(e){return dl(e)},S.hydrate=function(e,t,i){if(!Yl(t))throw Error(n(200));return eu(null,e,t,!0,i)},S.hydrateRoot=function(e,t,i){if(!Xl(e))throw Error(n(405));var r=null!=i&&i.hydratedSources||null,o=!1,a="",s=Ql;if(null!=i&&(!0===i.unstable_strictMode&&(o=!0),void 0!==i.identifierPrefix&&(a=i.identifierPrefix),void 0!==i.onRecoverableError&&(s=i.onRecoverableError)),t=ql(t,null,e,1,null!=i?i:null,o,0,a,s),e[mr]=t.current,qi(e),r)for(e=0;e<r.length;e++)o=(o=(i=r[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,o]:t.mutableSourceEagerHydrationData.push(i,o);return new $l(t)},S.render=function(e,t,i){if(!Yl(t))throw Error(n(200));return eu(null,e,t,!1,i)},S.unmountComponentAtNode=function(e){if(!Yl(e))throw Error(n(40));return!!e._reactRootContainer&&(dl((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[mr]=null}))})),!0)},S.unstable_batchedUpdates=ul,S.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!Yl(i))throw Error(n(200));if(null==e||void 0===e._reactInternals)throw Error(n(38));return eu(e,t,i,!1,r)},S.version="18.3.1-next-f1338f8080-20240426",S}var x=function(){if(g)return k;g=1;var e=(m||(m=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),w.exports=P()),w.exports);return k.createRoot=e.createRoot,k.hydrateRoot=e.hydrateRoot,k}();function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function O(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,r)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){O(o,i,r,a,s,"next",e)}function s(e){O(o,i,r,a,s,"throw",e)}a(void 0)}))}}function I(e,t,n){return t=D(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,L()?Reflect.construct(t,n||[],D(e).constructor):t.apply(e,n))}function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,V(i.key),i)}}function M(e,t,n){return(t=V(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}function L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(L=function(){return!!e})()}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){M(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function F(){F=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new _(i||[]);return r(a,"_invoke",{value:P(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",p="suspendedYield",f="executing",m="completed",g={};function v(){}function b(){}function y(){}var k={};l(k,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==n&&i.call(S,a)&&(k=S);var T=y.prototype=v.prototype=Object.create(k);function C(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return o=o?o.then(r,r):r()}})}function P(t,n,i){var r=h;return function(o,a){if(r===f)throw Error("Generator is already running");if(r===m){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var c=x(s,i);if(c){if(c===g)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===h)throw r=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=f;var l=d(t,n,i);if("normal"===l.type){if(r=i.done?m:p,l.arg===g)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=m,i.method="throw",i.arg=l.arg)}}}function x(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,x(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var o=d(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return b.prototype=y,r(T,"constructor",{value:y,configurable:!0}),r(y,"constructor",{value:b,configurable:!0}),b.displayName=l(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,c,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},C(E.prototype),l(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new E(u(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(T),l(T,c,"Generator"),l(T,a,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=I,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;O(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:I(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),g}},t}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},B(e,t)}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,a,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(c=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return R(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function q(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}var W="flowon-widget-1F-crxJj",H="flowon-widget-gzXuziNT",K="flowon-widget-J3--qQuU",G="flowon-widget-HTq8dwtY",Q="flowon-widget-52lhK7uF",J="flowon-widget-jr7AB6GX",$="flowon-widget-xPyPksws",X="flowon-widget-mQJKDImn",Y="flowon-widget-OvLraJrd",Z="flowon-widget-0T9RsMuQ",ee="flowon-widget-7CPUG9cU",te="flowon-widget-mcXQ8nOK",ne="flowon-widget-YtNnuVDm",ie="flowon-widget-tMolStMF",re="flowon-widget-cxdY70Ks",oe="flowon-widget-MW3vfq75";function ae(...e){return t=>e.forEach((e=>function(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}(e,t)))}q('@import url("https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;1,700&display=swap");.flowon-widget-1F-crxJj{backdrop-filter:blur(16px) saturate(180%);-webkit-backdrop-filter:blur(16px) saturate(180%);background:hsla(0,0%,100%,.2);border:1px solid hsla(0,0%,100%,.3);border-radius:var(--flowon-border-radius-md);bottom:var(--flowon-spacing-md);box-shadow:0 8px 32px 0 var(--flowon-colors-shadow);display:flex;flex-direction:column;isolation:isolate;opacity:1;overflow:hidden;pointer-events:auto;position:fixed;right:var(--flowon-spacing-md);transition:opacity var(--flowon-transition-duration) ease-in-out;z-index:var(--flowon-z-index-base)}.flowon-widget-gzXuziNT{background:var(--flowon-colors-background);border-radius:calc(var(--flowon-chat-min-size)/2);box-shadow:0 4px 12px var(--flowon-colors-shadow);height:var(--flowon-chat-min-size);width:var(--flowon-chat-min-size)}.flowon-widget-gzXuziNT:hover{box-shadow:0 6px 16px rgba(0,0,0,.15)}.flowon-widget-gzXuziNT .flowon-widget-J3--qQuU{padding:10px}.flowon-widget-gzXuziNT .flowon-widget-52lhK7uF,.flowon-widget-gzXuziNT .flowon-widget-HTq8dwtY,.flowon-widget-gzXuziNT .flowon-widget-jr7AB6GX{display:none}.flowon-widget-xPyPksws{height:var(--flowon-chat-expanded-height);max-height:90vh;max-width:90vw;opacity:1;width:var(--flowon-chat-expanded-width)}.flowon-widget-gzXuziNT .flowon-widget-J3--qQuU h2{font-size:1.2rem}.flowon-widget-1F-crxJj *{box-sizing:border-box}.flowon-widget-J3--qQuU{backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);background:linear-gradient(135deg,var(--flowon-gradient-start),var(--flowon-gradient-end));border-bottom:1px solid hsla(0,0%,100%,.1);border-radius:20px 20px 0 0;box-shadow:0 2px 10px rgba(0,0,0,.1);padding:20px 0;position:relative;text-align:center}.flowon-widget-J3--qQuU h2{color:hsla(0,0%,41%,.9);font-size:1.6rem;font-weight:600;text-shadow:1px 1px 2px rgba(0,0,0,.1)}.flowon-widget-HTq8dwtY{backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);background:hsla(0,0%,100%,.1);flex-grow:1;overflow-y:auto;padding:20px 15px}.flowon-widget-DovW70ws{display:flex;list-style:none}.flowon-widget-kWR69TDu{justify-content:flex-end;margin:20px 0}.flowon-widget-0FU-KH0E{margin:20px 0}.flowon-widget-DovW70ws p{backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);background:linear-gradient(135deg,hsla(0,0%,39%,.9),rgba(80,80,80,.9));border-radius:10px 10px 0 10px;color:#fff;font-size:.95rem;max-width:75%;padding:12px 16px;white-space:pre-wrap}.flowon-widget-0FU-KH0E p{background:#f0f0f0;border-radius:10px 10px 10px 0;color:#000}.flowon-widget-DovW70ws p.flowon-widget-pFBmc-r6{background:var(--flowon-colors-error-bg);color:var(--flowon-colors-error)}.flowon-widget-0FU-KH0E span{align-self:flex-end;background:#0baadf;border-radius:4px;color:#fff;cursor:default;height:32px;line-height:32px;margin:0 10px 7px 0;text-align:center;width:32px}.flowon-widget-52lhK7uF{backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);background:hsla(0,0%,100%,.1);border-top:1px solid hsla(0,0%,100%,.18);display:flex;gap:5px;padding:10px 20px}.flowon-widget-52lhK7uF textarea{border:none;font-size:.95rem;height:55px;max-height:180px;outline:none;padding:15px 15px 15px 0;resize:none;width:100%}.flowon-widget-52lhK7uF span{align-items:center;align-self:flex-end;color:#0baadf;cursor:pointer;display:flex;font-size:1.35rem;height:55px;visibility:hidden}.flowon-widget-52lhK7uF textarea:valid~span{visibility:visible}.flowon-widget-mQJKDImn{backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);background:linear-gradient(135deg,rgba(45,45,45,.95),rgba(75,75,75,.95));border:none;border:1px solid hsla(0,0%,100%,.1);border-radius:5px;box-shadow:0 2px 8px rgba(0,0,0,.2);color:#fff;cursor:pointer;display:inline-block;font-size:16px;font-weight:700;padding:10px 20px;text-align:center;text-decoration:none;transition:all .3s ease}.flowon-widget-mQJKDImn:hover{background:linear-gradient(135deg,rgba(55,55,55,.95),rgba(85,85,85,.95));box-shadow:0 4px 12px rgba(0,0,0,.25)}.flowon-widget-mQJKDImn:active{background-color:#fff}.flowon-widget-jr7AB6GX{align-items:center;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);background:hsla(0,0%,94%,.5);border-radius:0 0 20px 20px;border-top:1px solid hsla(0,0%,100%,.18);display:flex;justify-content:center;padding:10px}.flowon-widget-OvLraJrd{height:24px;margin-right:8px;width:24px}.flowon-widget-0T9RsMuQ{color:#666;font-size:12px}@media (max-width:767px){.flowon-widget-1F-crxJj{border-radius:0;height:100%;width:100%}.flowon-widget-J3--qQuU,.flowon-widget-jr7AB6GX{border-radius:0}}.flowon-widget-7CPUG9cU{border-radius:20px;font-weight:500;margin-top:10px;padding:8px 16px;transition:all .3s ease}.flowon-widget-7CPUG9cU:not(.flowon-widget-mcXQ8nOK){backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);background:hsla(0,0%,100%,.9);border:1px solid hsla(0,0%,78%,.3);box-shadow:0 2px 8px rgba(0,0,0,.1);color:#666}.flowon-widget-7CPUG9cU.flowon-widget-mcXQ8nOK{background-color:#f44;color:#fff}.flowon-widget-7CPUG9cU:hover:not(.flowon-widget-mcXQ8nOK){background:hsla(0,0%,96%,.95);box-shadow:0 4px 12px rgba(0,0,0,.15)}.flowon-widget-7CPUG9cU.flowon-widget-mcXQ8nOK:hover{background-color:#f22}.flowon-widget-X25-3Hm- *,.flowon-widget-X25-3Hm- :after,.flowon-widget-X25-3Hm- :before{box-sizing:inherit}@media (max-width:768px){.flowon-widget-1F-crxJj{border-radius:0;bottom:10vh;height:80vh;right:5vw;width:90vw}.flowon-widget-J3--qQuU,.flowon-widget-jr7AB6GX{border-radius:0}}.flowon-widget-YtNnuVDm{background:none;border:none;color:hsla(0,0%,41%,.9);cursor:pointer;font-size:24px;line-height:1;opacity:.8;padding:5px;position:absolute;right:10px;top:10px;transition:opacity .2s}.flowon-widget-YtNnuVDm:hover{opacity:1}.flowon-widget-tMolStMF{align-items:center;display:flex;height:100%;justify-content:center;padding:8px;width:100%}.flowon-widget-tMolStMF .flowon-widget-cxdY70Ks{height:100%;-o-object-fit:contain;object-fit:contain;opacity:1;width:100%}.flowon-widget-MW3vfq75{opacity:0}.flowon-widget-gzXuziNT{background:#fff;border-radius:30px;box-shadow:0 4px 12px rgba(0,0,0,.1);cursor:pointer;height:60px;opacity:1;overflow:hidden;width:60px}.flowon-widget-tMolStMF{opacity:0;transition:opacity .3s ease-in-out}.flowon-widget-gzXuziNT .flowon-widget-tMolStMF{opacity:1}.flowon-widget-PoV19fwO{opacity:0}',{insertAt:"top"});var se=b.forwardRef(((e,t)=>{const{children:n,...i}=e,r=b.Children.toArray(n),o=r.find(ue);if(o){const e=o.props.children,n=r.map((t=>t===o?b.Children.count(e)>1?b.Children.only(null):b.isValidElement(e)?e.props.children:null:t));return v.jsx(ce,{...i,ref:t,children:b.isValidElement(e)?b.cloneElement(e,void 0,n):null})}return v.jsx(ce,{...i,ref:t,children:n})}));se.displayName="Slot";var ce=b.forwardRef(((e,t)=>{const{children:n,...i}=e;if(b.isValidElement(n)){const e=function(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;if(n)return e.ref;if(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n)return e.props.ref;return e.props.ref||e.ref}(n);return b.cloneElement(n,{...de(i,n.props),ref:t?ae(t,e):e})}return b.Children.count(n)>1?b.Children.only(null):null}));ce.displayName="SlotClone";var le=({children:e})=>v.jsx(v.Fragment,{children:e});function ue(e){return b.isValidElement(e)&&e.type===le}function de(e,t){const n={...t};for(const i in t){const r=e[i],o=t[i];/^on[A-Z]/.test(i)?r&&o?n[i]=(...e)=>{o(...e),r(...e)}:r&&(n[i]=r):"style"===i?n[i]={...r,...o}:"className"===i&&(n[i]=[r,o].filter(Boolean).join(" "))}return{...e,...n}}function he(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=he(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}const pe=e=>"boolean"==typeof e?"".concat(e):0===e?"0":e,fe=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=he(e))&&(i&&(i+=" "),i+=t);return i};function me(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=me(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function ge(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=me(e))&&(i&&(i+=" "),i+=t);return i}(t)}var ve,be,ye=["className","variant","size","asChild"],ke=(ve="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",be={variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}},e=>{var t;if(null==(null==be?void 0:be.variants))return fe(ve,null==e?void 0:e.class,null==e?void 0:e.className);const{variants:n,defaultVariants:i}=be,r=Object.keys(n).map((t=>{const r=null==e?void 0:e[t],o=null==i?void 0:i[t];if(null===r)return null;const a=pe(r)||pe(o);return n[t][a]})),o=e&&Object.entries(e).reduce(((e,t)=>{let[n,i]=t;return void 0===i||(e[n]=i),e}),{}),a=null==be||null===(t=be.compoundVariants)||void 0===t?void 0:t.reduce(((e,t)=>{let{class:n,className:r,...a}=t;return Object.entries(a).every((e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...i,...o}[t]):{...i,...o}[t]===n}))?[...e,n,r]:e}),[]);return fe(ve,r,a,null==e?void 0:e.class,null==e?void 0:e.className)}),we=b.forwardRef((function(e,t){var n=e.className,i=e.variant,r=e.size,o=e.asChild,a=void 0!==o&&o,s=j(e,ye),c=a?se:"button";return v.jsx(c,U({className:ge(ke({variant:i,size:r,className:n})),ref:t},s))}));we.displayName="Button";var Se=["className"],Te=["className"],Ce=["className"],Ee=["className"],Pe=["className"],xe=["className"],Re=b.forwardRef((function(e,t){var n=e.className,i=j(e,Se);return v.jsx("div",U({ref:t,className:ge("rounded-xl border bg-card text-card-foreground shadow",n)},i))}));Re.displayName="Card",b.forwardRef((function(e,t){var n=e.className,i=j(e,Te);return v.jsx("div",U({ref:t,className:ge("flex flex-col space-y-1.5 p-6",n)},i))})).displayName="CardHeader",b.forwardRef((function(e,t){var n=e.className,i=j(e,Ce);return v.jsx("h3",U({ref:t,className:ge("font-semibold leading-none tracking-tight",n)},i))})).displayName="CardTitle",b.forwardRef((function(e,t){var n=e.className,i=j(e,Ee);return v.jsx("p",U({ref:t,className:ge("text-sm text-muted-foreground",n)},i))})).displayName="CardDescription";var Oe=b.forwardRef((function(e,t){var n=e.className,i=j(e,Pe);return v.jsx("div",U({ref:t,className:ge("p-6 pt-0",n)},i))}));Oe.displayName="CardContent",b.forwardRef((function(e,t){var n=e.className,i=j(e,xe);return v.jsx("div",U({ref:t,className:ge("flex items-center p-6 pt-0",n)},i))})).displayName="CardFooter";var _e=function(e){var t=e.onStreamToggle,n=e.isConnecting;return v.jsx(Re,{className:"w-full max-w-[300px] bg-transparent border-none shadow-none",children:v.jsx(Oe,{className:"p-6 flex flex-col items-center",children:v.jsx(we,{className:"w-[120px] h-[120px] rounded-full bg-gradient-to-br from-gray-200 to-gray-400 text-gray-800 \n            hover:from-gray-300 hover:to-gray-500 focus:ring-2 focus:ring-gray-300 focus:outline-none\n            shadow-lg backdrop-blur-md border border-gray-300\n            transition-all duration-200 ease-in-out",onClick:function(){t()},disabled:n,children:"Start Chat"})})})};function Ie(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var Ne=Object.defineProperty,Me=(e,t,n)=>((e,t,n)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class De{constructor(){Me(this,"_locking"),Me(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise((t=>e=()=>{this._locks-=1,t()})),n=this._locking.then((()=>e));return this._locking=this._locking.then((()=>t)),n}}function Le(e,t){if(!e)throw new Error(t)}function Ae(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function Ue(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function je(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}const Fe=Symbol("@bufbuild/protobuf/enum-type");function Be(e){const t=e[Fe];return Le(t,"missing enum type on enum object"),t}function ze(e,t,n,i){e[Fe]=Ve(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function Ve(e,t,n){const i=Object.create(null),r=Object.create(null),o=[];for(const e of t){const t=We(e);o.push(t),i[e.name]=t,r[e.no]=t}return{typeName:e,values:o,findName:e=>i[e],findNumber:e=>r[e]}}function qe(e,t,n){const i={};for(const e of t){const t=We(e);i[t.localName]=t.no,i[t.no]=t.localName}return ze(i,e,t),i}function We(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class He{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Ke(){let e=0,t=0;for(let n=0;n<28;n+=7){let i=this.buf[this.pos++];if(e|=(127&i)<<n,!(128&i))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,!(128&n))return this.assertBounds(),[e,t];for(let n=3;n<=31;n+=7){let i=this.buf[this.pos++];if(t|=(127&i)<<n,!(128&i))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function Ge(e,t,n){for(let i=0;i<28;i+=7){const r=e>>>i,o=!(r>>>7==0&&0==t),a=255&(o?128|r:r);if(n.push(a),!o)return}const i=e>>>28&15|(7&t)<<4,r=!!(t>>3);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),o=255&(r?128|i:i);if(n.push(o),!r)return}n.push(t>>>31&1)}}const Qe=4294967296;function Je(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function o(t,o){const a=Number(e.slice(t,o));r*=n,i=i*n+a,i>=Qe&&(r+=i/Qe|0,i%=Qe)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),t?Ye(i,r):Xe(i,r)}function $e(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(Qe*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,o=n+8147497*i,a=2*i;const s=1e7;return r>=s&&(o+=Math.floor(r/s),r%=s),o>=s&&(a+=Math.floor(o/s),o%=s),a.toString()+Ze(o)+Ze(r)}function Xe(e,t){return{lo:0|e,hi:0|t}}function Ye(e,t){return t=~t,e?e=1+~e:t+=1,Xe(e,t)}const Ze=e=>{const t=String(e);return"0000000".slice(t.length)+t};function et(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function tt(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;128&e&&t<10;t++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}const nt=function(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"object"!=typeof process.env||"1"!==process.env.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>Le(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>Le(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),Je(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),Je(e)),dec:(e,t)=>function(e,t){let n=Xe(e,t);const i=2147483648&n.hi;i&&(n=Ye(n.lo,n.hi));const r=$e(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>$e(e,t)}}();var it,rt,ot;function at(e,t,n){if(t===n)return!0;if(e==it.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case it.UINT64:case it.FIXED64:case it.INT64:case it.SFIXED64:case it.SINT64:return t==n}return!1}function st(e,t){switch(e){case it.BOOL:return!1;case it.UINT64:case it.FIXED64:case it.INT64:case it.SFIXED64:case it.SINT64:return 0==t?nt.zero:"0";case it.DOUBLE:case it.FLOAT:return 0;case it.BYTES:return new Uint8Array(0);case it.STRING:return"";default:return 0}}function ct(e,t){switch(e){case it.BOOL:return!1===t;case it.STRING:return""===t;case it.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(it||(it={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(rt||(rt={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(ot||(ot={}));class lt{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),n=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],n),n+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Ue(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return Ae(e),et(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){je(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Ue(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Ae(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Ae(e),et(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=nt.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=nt.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=nt.enc(e);return Ge(t.lo,t.hi,this.buf),this}sint64(e){let t=nt.enc(e),n=t.hi>>31;return Ge(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=nt.uEnc(e);return Ge(t.lo,t.hi,this.buf),this}}class ut{constructor(e,t){this.varint64=Ke,this.uint32=tt,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case ot.Varint:for(;128&this.buf[this.pos++];);break;case ot.Bit64:this.pos+=4;case ot.Bit32:this.pos+=4;break;case ot.LengthDelimited:let n=this.uint32();this.pos+=n;break;case ot.StartGroup:for(;;){const[e,n]=this.tag();if(n===ot.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return nt.dec(...this.varint64())}uint64(){return nt.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,nt.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return nt.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return nt.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function dt(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return st(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),pt=[];for(let e=0;e<ht.length;e++)pt[ht[e].charCodeAt(0)]=e;pt["-".charCodeAt(0)]=ht.indexOf("+"),pt["_".charCodeAt(0)]=ht.indexOf("/");const ft={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,o=0,a=0;for(let t=0;t<e.length;t++){if(n=pt[e.charCodeAt(t)],void 0===n)switch(e[t]){case"=":o=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:a=n,o=1;break;case 1:i[r++]=a<<2|(48&n)>>4,a=n,o=2;break;case 2:i[r++]=(15&a)<<4|(60&n)>>2,a=n,o=3;break;case 3:i[r++]=(3&a)<<6|n,o=0}}if(1==o)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let o=0;o<e.length;o++)switch(t=e[o],i){case 0:n+=ht[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=ht[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=ht[r|t>>6],n+=ht[63&t],i=0}return i&&(n+=ht[r],n+="=",1==i&&(n+="=")),n}};function mt(e,t,n){bt(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter((e=>e.no===t.no))}(e.getType().runtime.bin.listUnknownFields(e),t.field),[o,a]=dt(t);for(const e of r)t.runtime.bin.readField(o,i.readerFactory(e.data),t.field,e.wireType,i);return a()}function gt(e,t,n,i){bt(t,e);const r=t.runtime.bin.makeReadOptions(i),o=t.runtime.bin.makeWriteOptions(i);if(vt(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter((e=>e.no!=t.field.no));e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const a=o.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function vt(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find((e=>e.no==t.field.no))}function bt(e,t){Le(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function yt(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!ct(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function kt(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?st(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function wt(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(He.prototype).every((t=>t in e&&"function"==typeof e[t])))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function St(e,t){return wt(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}it.DOUBLE,it.FLOAT,it.INT64,it.UINT64,it.INT32,it.UINT32,it.BOOL,it.STRING,it.BYTES;const Tt={ignoreUnknownFields:!1},Ct={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Et(e){return e?Object.assign(Object.assign({},Tt),e):Tt}function Pt(e){return e?Object.assign(Object.assign({},Ct),e):Ct}const xt=Symbol(),Rt=Symbol();function Ot(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function _t(e,t,n,i,r){let o=n.localName;if(n.repeated){if(Le("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Ot(t)));const a=e[o];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Ot(e)));switch(n.kind){case"message":a.push(n.T.fromJson(e,i));break;case"enum":const t=Mt(n.T,e,i.ignoreUnknownFields,!0);t!==Rt&&a.push(t);break;case"scalar":try{a.push(Nt(n.T,e,n.L,!0))}catch(t){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Ot(e));throw t instanceof Error&&t.message.length>0&&(i+=": ".concat(t.message)),new Error(i)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Ot(t)));const a=e[o];for(const[e,o]of Object.entries(t)){if(null===o)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let s;try{s=It(n.K,e)}catch(e){let i="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Ot(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}switch(n.V.kind){case"message":a[s]=n.V.T.fromJson(o,i);break;case"enum":const e=Mt(n.V.T,o,i.ignoreUnknownFields,!0);e!==Rt&&(a[s]=e);break;case"scalar":try{a[s]=Nt(n.V.T,o,rt.BIGINT,!0)}catch(e){let i="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Ot(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(null===t&&"google.protobuf.Value"!=a.typeName)return;let s=e[o];wt(s)?s.fromJson(t,i):(e[o]=s=a.fromJson(t,i),a.fieldWrapper&&!n.oneof&&(e[o]=a.fieldWrapper.unwrapField(s)));break;case"enum":const c=Mt(n.T,t,i.ignoreUnknownFields,!1);switch(c){case xt:kt(n,e);break;case Rt:break;default:e[o]=c}break;case"scalar":try{const i=Nt(n.T,t,n.L,!1);if(i===xt)kt(n,e);else e[o]=i}catch(e){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Ot(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}}}function It(e,t){if(e===it.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return Nt(e,t,rt.BIGINT,!0).toString()}function Nt(e,t,n,i){if(null===t)return i?st(e,n):xt;switch(e){case it.DOUBLE:case it.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==it.FLOAT&&je(i),i;case it.INT32:case it.FIXED32:case it.SFIXED32:case it.SINT32:case it.UINT32:let r;if("number"==typeof t?r=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),void 0===r)break;return e==it.UINT32||e==it.FIXED32?Ue(r):Ae(r),r;case it.INT64:case it.SFIXED64:case it.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=nt.parse(t);return n?o.toString():o;case it.FIXED64:case it.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=nt.uParse(t);return n?a.toString():a;case it.BOOL:if("boolean"!=typeof t)break;return t;case it.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(e){throw new Error("invalid UTF8")}return t;case it.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return ft.dec(t)}throw new Error}function Mt(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:xt;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return Rt}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(Ot(t)))}function Dt(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function Lt(e,t,n){if("map"==e.kind){Le("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[t,n]of r)i[t.toString()]=Ut(e.V.T,n);break;case"message":for(const[e,t]of r)i[e.toString()]=t.toJson(n);break;case"enum":const t=e.V.T;for(const[e,o]of r)i[e.toString()]=At(t,o,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){Le(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(Ut(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(At(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return Ut(e.T,t);case"enum":return At(e.T,t,n.enumAsInteger);case"message":return St(e.T,t).toJson(n)}}function At(e,t,n){var i;if(Le("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null==r?void 0:r.name)&&void 0!==i?i:t}function Ut(e,t){switch(e){case it.INT32:case it.SFIXED32:case it.SINT32:case it.FIXED32:case it.UINT32:return Le("number"==typeof t),t;case it.FLOAT:case it.DOUBLE:return Le("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case it.STRING:return Le("string"==typeof t),t;case it.BOOL:return Le("boolean"==typeof t),t;case it.UINT64:case it.FIXED64:case it.INT64:case it.SFIXED64:case it.SINT64:return Le("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case it.BYTES:return Le(t instanceof Uint8Array),ft.enc(t)}}const jt=Symbol("@bufbuild/protobuf/unknown-fields"),Ft={readUnknownFields:!0,readerFactory:e=>new ut(e)},Bt={writeUnknownFields:!0,writerFactory:()=>new lt};function zt(e){return e?Object.assign(Object.assign({},Ft),e):Ft}function Vt(e){return e?Object.assign(Object.assign({},Bt),e):Bt}function qt(e,t,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=a&&delete e.value,e.case=a,a="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?it.INT32:n.T;let c=Kt;if("scalar"==n.kind&&n.L>0&&(c=Ht),o){let n=e[a];if(i==ot.LengthDelimited&&s!=it.STRING&&s!=it.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[a]=c(t,s);break;case"message":const l=n.T;o?e[a].push(Wt(t,new l,r,n)):wt(e[a])?Wt(t,e[a],r,n):(e[a]=Wt(t,new l,r,n),!l.fieldWrapper||n.oneof||n.repeated||(e[a]=l.fieldWrapper.unwrapField(e[a])));break;case"map":let[u,d]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let o,a;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:o=Kt(t,e.K);break;case 2:switch(e.V.kind){case"scalar":a=Kt(t,e.V.T);break;case"enum":a=t.int32();break;case"message":a=Wt(t,new e.V.T,n,void 0)}}}void 0===o&&(o=st(e.K,rt.BIGINT));"string"!=typeof o&&"number"!=typeof o&&(o=o.toString());if(void 0===a)switch(e.V.kind){case"scalar":a=st(e.V.T,rt.BIGINT);break;case"enum":a=e.V.T.values[0].no;break;case"message":a=new e.V.T}return[o,a]}(n,t,r);e[a][u]=d}}function Wt(e,t,n,i){const r=t.getType().runtime.bin,o=null==i?void 0:i.delimited;return r.readMessage(t,e,o?i.no:e.uint32(),n,o),t}function Ht(e,t){const n=Kt(e,t);return"bigint"==typeof n?n.toString():n}function Kt(e,t){switch(t){case it.STRING:return e.string();case it.BOOL:return e.bool();case it.DOUBLE:return e.double();case it.FLOAT:return e.float();case it.INT32:return e.int32();case it.INT64:return e.int64();case it.UINT64:return e.uint64();case it.FIXED64:return e.fixed64();case it.BYTES:return e.bytes();case it.FIXED32:return e.fixed32();case it.SFIXED32:return e.sfixed32();case it.SFIXED64:return e.sfixed64();case it.SINT64:return e.sint64();case it.UINT32:return e.uint32();case it.SINT32:return e.sint32()}}function Gt(e,t,n,i){Le(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let o="enum"==e.kind?it.INT32:e.T;if(r)if(Le(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,ot.LengthDelimited).fork();let[,r]=Xt(t);for(let t=0;t<i.length;t++)e[r](i[t]);e.join()}(n,o,e.no,t);else for(const i of t)$t(n,o,e.no,i);else $t(n,o,e.no,t);break;case"message":if(r){Le(Array.isArray(t));for(const r of t)Jt(n,i,e,r)}else Jt(n,i,e,t);break;case"map":Le("object"==typeof t&&null!=t);for(const[r,o]of Object.entries(t))Qt(n,i,e,r,o)}}function Qt(e,t,n,i,r){e.tag(n.no,ot.LengthDelimited),e.fork();let o=i;switch(n.K){case it.INT32:case it.FIXED32:case it.UINT32:case it.SFIXED32:case it.SINT32:o=Number.parseInt(i);break;case it.BOOL:Le("true"==i||"false"==i),o="true"==i}switch($t(e,n.K,1,o),n.V.kind){case"scalar":$t(e,n.V.T,2,r);break;case"enum":$t(e,it.INT32,2,r);break;case"message":Le(void 0!==r),e.tag(2,ot.LengthDelimited).bytes(r.toBinary(t))}e.join()}function Jt(e,t,n,i){const r=St(n.T,i);n.delimited?e.tag(n.no,ot.StartGroup).raw(r.toBinary(t)).tag(n.no,ot.EndGroup):e.tag(n.no,ot.LengthDelimited).bytes(r.toBinary(t))}function $t(e,t,n,i){Le(void 0!==i);let[r,o]=Xt(t);e.tag(n,r)[o](i)}function Xt(e){let t=ot.Varint;switch(e){case it.BYTES:case it.STRING:t=ot.LengthDelimited;break;case it.DOUBLE:case it.FIXED64:case it.SFIXED64:t=ot.Bit64;break;case it.FIXED32:case it.SFIXED32:case it.FLOAT:t=ot.Bit32}return[t,it[e].toLowerCase()]}function Yt(e){if(void 0===e)return e;if(wt(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Zt(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class en{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function tn(e,t){const n=rn(e);return t?n:ln(cn(n))}const nn=rn;function rn(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const on=new Set(["constructor","toString","toJSON","valueOf"]),an=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),sn=e=>"".concat(e,"$"),cn=e=>an.has(e)?sn(e):e,ln=e=>on.has(e)?sn(e):e;class un{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=tn(e,!1)}addField(e){Le(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const dn=(hn=e=>new en(e,(e=>function(e){var t,n,i,r,o,a;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=tn(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:nn(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:rt.BIGINT),e.delimited=null!==(r=l.delimited)&&void 0!==r&&r,e.req=null!==(o=l.req)&&void 0!==o&&o,e.opt=null!==(a=l.opt)&&void 0!==a&&a,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=it.BYTES&&l.T!=it.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;c&&c.name==t||(c=new un(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e))),pn=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=st(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:Et,makeWriteOptions:Pt,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(Ot(t)));i=null!=i?i:new e;const r=new Map,o=n.typeRegistry;for(const[a,s]of Object.entries(t)){const t=e.fields.findJsonName(a);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(a,'"'));r.set(t.oneof,a)}_t(i,s,t,n,e)}else{let t=!1;if((null==o?void 0:o.findExtension)&&a.startsWith("[")&&a.endsWith("]")){const r=o.findExtension(a.substring(1,a.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,o]=dt(r);_t(e,s,r.field,n,r),gt(i,r,o(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!yt(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!Dt(r))continue}const n=Lt(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const o=t.typeRegistry;if(null==o?void 0:o.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const a=o.findExtensionFor(n.typeName,r.no);if(a&&vt(e,a)){const n=mt(e,a,t),r=Lt(a.field,n,t);void 0!==r&&(i[a.field.jsonName]=r)}}}catch(e){const t=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),i=e instanceof Error?e.message:String(e);throw new Error(t+(i.length>0?": ".concat(i):""))}return i},readScalar:(e,t,n)=>Nt(e,t,null!=n?n:rt.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||ct(e,t)?Ut(e,t):void 0},debug:Ot},bin:{makeReadOptions:zt,makeWriteOptions:Vt,listUnknownFields(e){var t;return null!==(t=e[jt])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[jt]},writeUnknownFields(e,t){const n=e[jt];if(n)for(const e of n)t.tag(e.no,e.wireType).raw(e.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[jt])||(r[jt]=[]),r[jt].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const o=e.getType(),a=r?t.len:t.pos+n;let s,c;for(;t.pos<a&&([s,c]=t.tag(),!0!==r||c!=ot.EndGroup);){const n=o.fields.find(s);if(n)qt(e,t,n,c,i);else{const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n)}}if(r&&(c!=ot.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:qt,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(yt(r,e))Gt(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&Gt(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:ze,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,o=e;if(null!=o[n])switch(i.kind){case"oneof":const e=o[n].case;if(void 0===e)continue;const t=i.findField(e);let a=o[n].value;t&&"message"==t.kind&&!wt(a,t.T)?a=new t.T(a):t&&"scalar"===t.kind&&t.T===it.BYTES&&(a=Zt(a)),r[n]={case:e,value:a};break;case"scalar":case"enum":let s=o[n];i.T===it.BYTES&&(s=i.repeated?s.map(Zt):Zt(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===it.BYTES)for(const[e,t]of Object.entries(o[n]))r[n][e]=Zt(t);else Object.assign(r[n],o[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(o[n])){let i=o[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=o[n].map((e=>wt(e,c)?e:new c(e)));else{const e=o[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=Zt(e):r[n]=e:r[n]=wt(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every(((t,n)=>e.T.equals(t,r[n])));case"scalar":return i.every(((t,n)=>at(e.T,t,r[n])));case"enum":return i.every(((e,t)=>at(it.INT32,e,r[t])))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":return e.T.equals(i,r);case"enum":return at(it.INT32,i,r);case"scalar":return at(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const t=e.findField(i.case);if(void 0===t)return!0;switch(t.kind){case"message":return t.T.equals(i.value,r.value);case"enum":return at(it.INT32,i.value,r.value);case"scalar":return at(t.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(t.kind));case"map":const n=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return n.every((e=>t.equals(i[e],r[e])));case"enum":return n.every((e=>at(it.INT32,i[e],r[e])));case"scalar":const o=e.V.T;return n.every((e=>at(o,i[e],r[e])))}}})),clone(e){const t=e.getType(),n=new t,i=n;for(const n of t.fields.byMember()){const t=e[n.localName];let r;if(n.repeated)r=t.map(Yt);else if("map"==n.kind){r=i[n.localName];for(const[e,n]of Object.entries(t))r[e]=Yt(n)}else r="oneof"==n.kind?n.findField(t.case)?{case:t.case,value:Yt(t.value)}:{case:void 0}:Yt(t);i[n.localName]=r}for(const n of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,n.no,n.wireType,n.data);return n}}),{newFieldList:hn,initFields:pn}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const o=null!==(r=null==i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),a={[o]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[o];return Object.setPrototypeOf(a.prototype,new He),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new a).fromBinary(e,t),fromJson:(e,t)=>(new a).fromJson(e,t),fromJsonString:(e,t)=>(new a).fromJsonString(e,t),equals:(t,n)=>e.util.equals(a,t,n)}),a}(this,e,t,n)},makeEnum:qe,makeEnumType:Ve,getEnumType:Be,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var hn,pn;class fn extends He{constructor(e){super(),this.seconds=nt.zero,this.nanos=0,dn.util.initPartial(e,this)}fromJson(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(dn.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=nt.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return fn.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new fn({seconds:nt.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new fn).fromBinary(e,t)}static fromJson(e,t){return(new fn).fromJson(e,t)}static fromJsonString(e,t){return(new fn).fromJsonString(e,t)}static equals(e,t){return dn.util.equals(fn,e,t)}}fn.runtime=dn,fn.typeName="google.protobuf.Timestamp",fn.fields=dn.util.newFieldList((()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]));const mn=dn.makeMessageType("livekit.MetricsBatch",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:fn},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:gn,repeated:!0},{no:5,name:"events",kind:"message",T:bn,repeated:!0}])),gn=dn.makeMessageType("livekit.TimeSeriesMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:vn,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}])),vn=dn.makeMessageType("livekit.MetricSample",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:fn},{no:3,name:"value",kind:"scalar",T:2}])),bn=dn.makeMessageType("livekit.EventMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:fn},{no:7,name:"normalized_end_timestamp",kind:"message",T:fn,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}])),yn=dn.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),kn=dn.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),wn=dn.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Sn=dn.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Tn=dn.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Cn=dn.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"}]),En=dn.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Pn=dn.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),xn=dn.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Rn=dn.makeMessageType("livekit.Room",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:On,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:oi}])),On=dn.makeMessageType("livekit.Codec",(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}])),_n=dn.makeMessageType("livekit.ParticipantPermission",(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:dn.getEnumType(kn),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}])),In=dn.makeMessageType("livekit.ParticipantInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:dn.getEnumType(Nn)},{no:4,name:"tracks",kind:"message",T:An,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:_n},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:dn.getEnumType(Mn)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:dn.getEnumType(Cn)}])),Nn=dn.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Mn=dn.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Dn=dn.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Ln=dn.makeMessageType("livekit.SimulcastCodecInfo",(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Un,repeated:!0}])),An=dn.makeMessageType("livekit.TrackInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:dn.getEnumType(yn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:dn.getEnumType(kn)},{no:10,name:"layers",kind:"message",T:Un,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Ln,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:dn.getEnumType(Dn)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:oi},{no:19,name:"audio_features",kind:"enum",T:dn.getEnumType(xn),repeated:!0}])),Un=dn.makeMessageType("livekit.VideoLayer",(()=>[{no:1,name:"quality",kind:"enum",T:dn.getEnumType(wn)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}])),jn=dn.makeMessageType("livekit.DataPacket",(()=>[{no:1,name:"kind",kind:"enum",T:dn.getEnumType(Fn)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Vn,oneof:"value"},{no:3,name:"speaker",kind:"message",T:Bn,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:qn,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Wn,oneof:"value"},{no:8,name:"metrics",kind:"message",T:mn,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Kn,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Gn,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Qn,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Jn,oneof:"value"}])),Fn=dn.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Bn=dn.makeMessageType("livekit.ActiveSpeakerUpdate",(()=>[{no:1,name:"speakers",kind:"message",T:zn,repeated:!0}])),zn=dn.makeMessageType("livekit.SpeakerInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}])),Vn=dn.makeMessageType("livekit.UserPacket",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}])),qn=dn.makeMessageType("livekit.SipDTMF",(()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}])),Wn=dn.makeMessageType("livekit.Transcription",(()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Hn,repeated:!0}])),Hn=dn.makeMessageType("livekit.TranscriptionSegment",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}])),Kn=dn.makeMessageType("livekit.ChatMessage",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}])),Gn=dn.makeMessageType("livekit.RpcRequest",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}])),Qn=dn.makeMessageType("livekit.RpcAck",(()=>[{no:1,name:"request_id",kind:"scalar",T:9}])),Jn=dn.makeMessageType("livekit.RpcResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:$n,oneof:"value"}])),$n=dn.makeMessageType("livekit.RpcError",(()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}])),Xn=dn.makeMessageType("livekit.ParticipantTracks",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}])),Yn=dn.makeMessageType("livekit.ServerInfo",(()=>[{no:1,name:"edition",kind:"enum",T:dn.getEnumType(Zn)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}])),Zn=dn.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ei=dn.makeMessageType("livekit.ClientInfo",(()=>[{no:1,name:"sdk",kind:"enum",T:dn.getEnumType(ti)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}])),ti=dn.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),ni=dn.makeMessageType("livekit.ClientConfiguration",(()=>[{no:1,name:"video",kind:"message",T:ii},{no:2,name:"screen",kind:"message",T:ii},{no:3,name:"resume_connection",kind:"enum",T:dn.getEnumType(Tn)},{no:4,name:"disabled_codecs",kind:"message",T:ri},{no:5,name:"force_relay",kind:"enum",T:dn.getEnumType(Tn)}])),ii=dn.makeMessageType("livekit.VideoConfiguration",(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:dn.getEnumType(Tn)}])),ri=dn.makeMessageType("livekit.DisabledCodecs",(()=>[{no:1,name:"codecs",kind:"message",T:On,repeated:!0},{no:2,name:"publish",kind:"message",T:On,repeated:!0}])),oi=dn.makeMessageType("livekit.TimedVersion",(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}])),ai=dn.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),si=dn.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),ci=dn.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),li=dn.makeMessageType("livekit.SignalRequest",(()=>[{no:1,name:"offer",kind:"message",T:yi,oneof:"message"},{no:2,name:"answer",kind:"message",T:yi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:pi,oneof:"message"},{no:4,name:"add_track",kind:"message",T:hi,oneof:"message"},{no:5,name:"mute",kind:"message",T:fi,oneof:"message"},{no:6,name:"subscription",kind:"message",T:wi,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Si,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ei,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:xi,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Bi,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Vi,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Wi,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Ri,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Hi,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Ti,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Ci,oneof:"message"}])),ui=dn.makeMessageType("livekit.SignalResponse",(()=>[{no:1,name:"join",kind:"message",T:mi,oneof:"message"},{no:2,name:"answer",kind:"message",T:yi,oneof:"message"},{no:3,name:"offer",kind:"message",T:yi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:pi,oneof:"message"},{no:5,name:"update",kind:"message",T:ki,oneof:"message"},{no:6,name:"track_published",kind:"message",T:vi,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ei,oneof:"message"},{no:9,name:"mute",kind:"message",T:fi,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:_i,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Ii,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Mi,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Li,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:ji,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:zi,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:bi,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:gi,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Ki,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Ji,oneof:"message"},{no:22,name:"request_response",kind:"message",T:$i,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Yi,oneof:"message"}])),di=dn.makeMessageType("livekit.SimulcastCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}])),hi=dn.makeMessageType("livekit.AddTrackRequest",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:dn.getEnumType(yn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:dn.getEnumType(kn)},{no:9,name:"layers",kind:"message",T:Un,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:di,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:dn.getEnumType(Dn)},{no:15,name:"stream",kind:"scalar",T:9}])),pi=dn.makeMessageType("livekit.TrickleRequest",(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:dn.getEnumType(ai)},{no:3,name:"final",kind:"scalar",T:8}])),fi=dn.makeMessageType("livekit.MuteTrackRequest",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}])),mi=dn.makeMessageType("livekit.JoinResponse",(()=>[{no:1,name:"room",kind:"message",T:Rn},{no:2,name:"participant",kind:"message",T:In},{no:3,name:"other_participants",kind:"message",T:In,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Oi,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ni},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Yn},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:On,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}])),gi=dn.makeMessageType("livekit.ReconnectResponse",(()=>[{no:1,name:"ice_servers",kind:"message",T:Oi,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ni}])),vi=dn.makeMessageType("livekit.TrackPublishedResponse",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:An}])),bi=dn.makeMessageType("livekit.TrackUnpublishedResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}])),yi=dn.makeMessageType("livekit.SessionDescription",(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}])),ki=dn.makeMessageType("livekit.ParticipantUpdate",(()=>[{no:1,name:"participants",kind:"message",T:In,repeated:!0}])),wi=dn.makeMessageType("livekit.UpdateSubscription",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Xn,repeated:!0}])),Si=dn.makeMessageType("livekit.UpdateTrackSettings",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:dn.getEnumType(wn)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}])),Ti=dn.makeMessageType("livekit.UpdateLocalAudioTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:dn.getEnumType(xn),repeated:!0}])),Ci=dn.makeMessageType("livekit.UpdateLocalVideoTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}])),Ei=dn.makeMessageType("livekit.LeaveRequest",(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:dn.getEnumType(Cn)},{no:3,name:"action",kind:"enum",T:dn.getEnumType(Pi)},{no:4,name:"regions",kind:"message",T:Gi}])),Pi=dn.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),xi=dn.makeMessageType("livekit.UpdateVideoLayers",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Un,repeated:!0}])),Ri=dn.makeMessageType("livekit.UpdateParticipantMetadata",(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}])),Oi=dn.makeMessageType("livekit.ICEServer",(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}])),_i=dn.makeMessageType("livekit.SpeakersChanged",(()=>[{no:1,name:"speakers",kind:"message",T:zn,repeated:!0}])),Ii=dn.makeMessageType("livekit.RoomUpdate",(()=>[{no:1,name:"room",kind:"message",T:Rn}])),Ni=dn.makeMessageType("livekit.ConnectionQualityInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:dn.getEnumType(Sn)},{no:3,name:"score",kind:"scalar",T:2}])),Mi=dn.makeMessageType("livekit.ConnectionQualityUpdate",(()=>[{no:1,name:"updates",kind:"message",T:Ni,repeated:!0}])),Di=dn.makeMessageType("livekit.StreamStateInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:dn.getEnumType(si)}])),Li=dn.makeMessageType("livekit.StreamStateUpdate",(()=>[{no:1,name:"stream_states",kind:"message",T:Di,repeated:!0}])),Ai=dn.makeMessageType("livekit.SubscribedQuality",(()=>[{no:1,name:"quality",kind:"enum",T:dn.getEnumType(wn)},{no:2,name:"enabled",kind:"scalar",T:8}])),Ui=dn.makeMessageType("livekit.SubscribedCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Ai,repeated:!0}])),ji=dn.makeMessageType("livekit.SubscribedQualityUpdate",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Ai,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Ui,repeated:!0}])),Fi=dn.makeMessageType("livekit.TrackPermission",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}])),Bi=dn.makeMessageType("livekit.SubscriptionPermission",(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Fi,repeated:!0}])),zi=dn.makeMessageType("livekit.SubscriptionPermissionUpdate",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}])),Vi=dn.makeMessageType("livekit.SyncState",(()=>[{no:1,name:"answer",kind:"message",T:yi},{no:2,name:"subscription",kind:"message",T:wi},{no:3,name:"publish_tracks",kind:"message",T:vi,repeated:!0},{no:4,name:"data_channels",kind:"message",T:qi,repeated:!0},{no:5,name:"offer",kind:"message",T:yi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}])),qi=dn.makeMessageType("livekit.DataChannelInfo",(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:dn.getEnumType(ai)}])),Wi=dn.makeMessageType("livekit.SimulateScenario",(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:dn.getEnumType(ci),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}])),Hi=dn.makeMessageType("livekit.Ping",(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}])),Ki=dn.makeMessageType("livekit.Pong",(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}])),Gi=dn.makeMessageType("livekit.RegionSettings",(()=>[{no:1,name:"regions",kind:"message",T:Qi,repeated:!0}])),Qi=dn.makeMessageType("livekit.RegionInfo",(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}])),Ji=dn.makeMessageType("livekit.SubscriptionResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:dn.getEnumType(Pn)}])),$i=dn.makeMessageType("livekit.RequestResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:dn.getEnumType(Xi)},{no:3,name:"message",kind:"scalar",T:9}])),Xi=dn.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Yi=dn.makeMessageType("livekit.TrackSubscribed",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]));function Zi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var er,tr={exports:{}};var nr,ir,rr,or,ar,sr=(er||(er=1,ir=tr.exports,rr=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments]))}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function u(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function d(e,n){var a,s,l,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(e){}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return null!=l?l:null!=s?s:a},d.setLevel=function(e,n){return l=f(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(e){}}}(l),c.call(d)},d.setDefaultLevel=function(e){s=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(a=f(o.getLevel())),c.call(d),o===d)for(var e in r)r[e].rebuild()},a=f(o?o.getLevel():"WARN");var m=p();null!=m&&(l=f(m)),c.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o},(nr=tr).exports?nr.exports=rr():ir.log=rr()),tr.exports);!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(or||(or={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(ar||(ar={}));let cr=sr.getLogger("livekit");function lr(e){const t=sr.getLogger(e);return t.setDefaultLevel(cr.getLevel()),t}Object.values(ar).map((e=>sr.getLogger(e))),cr.setDefaultLevel(or.info);const ur=sr.getLogger("lk-e2ee"),dr=7e3,hr=[0,300,1200,2700,4800,dr,dr,dr,dr,dr];function pr(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))}function fr(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function mr(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=fr(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,r,(t=e[n](t)).done,t.value)}))}}}"function"==typeof SuppressedError&&SuppressedError;var gr,vr={exports:{}};var br=function(){if(gr)return vr.exports;gr=1;var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}vr.exports=r,vr.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}f(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&f(e,"error",t,n)}(e,r,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),c=o[t]),void 0===c)c=o[t]=n,++e._eventsCount;else if("function"==typeof c?c=o[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(r=s(e))>0&&c.length>r&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=c.length}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function d(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function f(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}return Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return s(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,u=p(c,l);for(i=0;i<l;++i)n(u[i],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return d(this,e,!0)},r.prototype.rawListeners=function(e){return d(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},vr.exports}();let yr=!0;function kr(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function wr(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Sr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(yr=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Tr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):"adapter.js deprecation warnings "+(e?"disabled":"enabled")}function Cr(){if("object"==typeof window){if(yr)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Er(e){return"[object Object]"===Object.prototype.toString.call(e)}function Pr(e){return Er(e)?Object.keys(e).reduce((function(t,n){const i=Er(e[n]),r=i?Pr(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})}),{}):e}function xr(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?xr(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{xr(e,e.get(t),n)}))})))}function Rr(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&xr(e,n,r)}))})),r}const Or=Cr;function _r(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),Or("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return Or("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function Ir(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Nr(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wr(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Mr(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Dr(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Rr(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),wr(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Rr(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Lr(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function Ar(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Lr(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ur(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function jr(e,t){wr(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Fr=Object.freeze({__proto__:null,fixNegotiationNeeded:jr,shimAddTrackRemoveTrack:Ar,shimAddTrackRemoveTrackWithNative:Lr,shimGetSendersWithDtmf:Mr,shimGetUserMedia:_r,shimMediaStream:Ir,shimOnTrack:Nr,shimPeerConnection:Ur,shimSenderReceiverGetStats:Dr});function Br(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function zr(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Vr(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,o)}}function qr(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Wr(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),wr(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Hr(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function Kr(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Gr(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function Qr(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Jr(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function $r(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Xr=Object.freeze({__proto__:null,shimAddTransceiver:Gr,shimCreateAnswer:$r,shimCreateOffer:Jr,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Qr,shimGetUserMedia:Br,shimOnTrack:zr,shimPeerConnection:Vr,shimRTCDataChannel:Kr,shimReceiverGetStats:Wr,shimRemoveStream:Hr,shimSenderGetStats:qr});function Yr(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Zr(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function eo(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function to(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(no(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function no(e){return e&&void 0!==e.video?Object.assign({},e,{video:Pr(e.video)}):e}function io(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ro(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function oo(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function ao(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var so,co=Object.freeze({__proto__:null,shimAudioContext:ao,shimCallbacksAPI:eo,shimConstraints:no,shimCreateOfferLegacy:oo,shimGetUserMedia:to,shimLocalStreamsAPI:Yr,shimRTCIceServerUrls:io,shimRemoteStreamsAPI:Zr,shimTrackEventTransceiver:ro}),lo={exports:{}};var uo=(so||(so=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n=i[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let r=3;r<i.length;r++){const o=i[r],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const i=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{r.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const o=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}(lo)),lo.exports),ho=Zi(uo),po=Ie({__proto__:null,default:ho},[uo]);function fo(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=ho.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,wr(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function mo(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||wr(e,"icecandidate",(e=>{if(e.candidate){const t=ho.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function go(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=ho.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=ho.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=ho.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>r}),this._sctp=o}return n.apply(this,arguments)}}function vo(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},wr(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function bo(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function yo(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function ko(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function wo(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var So=Object.freeze({__proto__:null,removeExtmapAllowMixed:yo,shimAddIceCandidateNullOrEmpty:ko,shimConnectionState:bo,shimMaxMessageSize:go,shimParameterlessSetLocalDescription:wo,shimRTCIceCandidate:fo,shimRTCIceCandidateRelayProtocol:mo,shimSendThrowTypeError:vo});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Cr,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find((e=>"Chromium"===e.brand));if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=kr(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=kr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=kr(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:i,commonShim:So,extractVersion:kr,disableLog:Sr,disableWarnings:Tr,sdp:po};switch(i.browser){case"chrome":if(!Fr||!Ur||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Fr,ko(e,i),wo(e),_r(e,i),Ir(e),Ur(e,i),Nr(e),Ar(e,i),Mr(e),Dr(e),jr(e,i),fo(e),mo(e),bo(e),go(e,i),vo(e),yo(e,i);break;case"firefox":if(!Xr||!Vr||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Xr,ko(e,i),wo(e),Br(e,i),Vr(e,i),zr(e),Hr(e),qr(e),Wr(e),Kr(e),Gr(e),Qr(e),Jr(e),$r(e),fo(e),bo(e),go(e,i),vo(e);break;case"safari":if(!co||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=co,ko(e,i),wo(e),io(e),oo(e),eo(e),Yr(e),Zr(e),ro(e),to(e),ao(e),fo(e),mo(e),go(e,i),vo(e),yo(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});const To="lk_e2ee";var Co,Eo,Po,xo,Ro,Oo,_o,Io,No,Mo,Do;function Lo(){return void 0!==window.RTCRtpSender&&void 0!==window.RTCRtpSender.prototype.createEncodedStreams||Ao()}function Ao(){return void 0!==window.RTCRtpScriptTransform}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(Co||(Co={})),function(e){e.KeyRatcheted="keyRatcheted"}(Eo||(Eo={})),function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(Po||(Po={})),function(e){e.Error="cryptorError"}(xo||(xo={}));br.EventEmitter;class Uo extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest"}(Ro||(Ro={}));class jo extends Uo{constructor(e,t,n){super(1,e),this.status=n,this.reason=t}}class Fo extends Uo{constructor(e){super(21,null!=e?e:"device is unsupported")}}class Bo extends Uo{constructor(e){super(20,null!=e?e:"track is invalid")}}class zo extends Uo{constructor(e){super(10,null!=e?e:"unsupported server")}}class Vo extends Uo{constructor(e){super(12,null!=e?e:"unexpected connection state")}}class qo extends Uo{constructor(e){super(13,null!=e?e:"unable to negotiate")}}class Wo extends Uo{constructor(e,t){super(15,e),this.reason=t}}function Ho(e,t,n){var i,r,o;void 0===t&&(t=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise((function(i,r){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout((function(){if(o=void 0,l=Date.now(),!a){var i=e.apply(n,t);s&&s(i),u.forEach((function(e){return(0,e.resolve)(i)})),u=[]}}),d()),c){var h=e.apply(n,t);return s&&s(h),i(h)}u.push({resolve:i,reject:r})}))};return h.cancel=function(e){void 0!==o&&clearTimeout(o),u.forEach((function(t){return(0,t.reject)(e)})),u=[]},h}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(Oo||(Oo={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(Oo||(Oo={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(_o||(_o={})),function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(Io||(Io={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage"}(No||(No={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse"}(Mo||(Mo={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate"}(Do||(Do={}));const Ko=/version\/(\d+(\.?_?\d+)+)/i;let Go;function Qo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("undefined"==typeof navigator)return;const n=navigator.userAgent.toLowerCase();if(void 0===Go||t){const e=Jo.find((e=>{let{test:t}=e;return t.test(n)}));Go=null==e?void 0:e.describe(n)}return Go}const Jo=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:$o(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Xo(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:$o(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Xo(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:$o(Ko,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:Xo(e)})}];function $o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function Xo(e){return e.includes("mac os")?$o(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}class Yo{}Yo.setTimeout=function(){return setTimeout(...arguments)},Yo.setInterval=function(){return setInterval(...arguments)},Yo.clearTimeout=function(){return clearTimeout(...arguments)},Yo.clearInterval=function(){return clearInterval(...arguments)};class Zo{constructor(e,t,n,i,r){if("object"==typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const ea=["vp8","h264"],ta=["vp8","h264","vp9","av1"];function na(e){return!!ea.find((t=>t===e))}var ia;!function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}(ia||(ia={}));const ra={h90:new Zo(160,90,9e4,20),h180:new Zo(320,180,16e4,20),h216:new Zo(384,216,18e4,20),h360:new Zo(640,360,45e4,20),h540:new Zo(960,540,8e5,25),h720:new Zo(1280,720,17e5,30),h1080:new Zo(1920,1080,3e6,30),h1440:new Zo(2560,1440,5e6,30),h2160:new Zo(3840,2160,8e6,30)},oa={h120:new Zo(160,120,7e4,20),h180:new Zo(240,180,125e3,20),h240:new Zo(320,240,14e4,20),h360:new Zo(480,360,33e4,20),h480:new Zo(640,480,5e5,20),h540:new Zo(720,540,6e5,25),h720:new Zo(960,720,13e5,30),h1080:new Zo(1440,1080,23e5,30),h1440:new Zo(1920,1440,38e5,30)},aa={h360fps3:new Zo(640,360,2e5,3,"medium"),h360fps15:new Zo(640,360,4e5,15,"medium"),h720fps5:new Zo(1280,720,8e5,5,"medium"),h720fps15:new Zo(1280,720,15e5,15,"medium"),h720fps30:new Zo(1280,720,2e6,30,"medium"),h1080fps15:new Zo(1920,1080,25e5,15,"medium"),h1080fps30:new Zo(1920,1080,5e6,30,"medium"),original:new Zo(0,0,7e6,30,"medium")};const sa=[];var ca;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(ca||(ca={}));class la extends br.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=la.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=cr,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout((()=>this.handleAppVisibilityChanged()),5e3):this.handleAppVisibilityChanged()},this.log=lr(null!==(i=n.loggerName)&&void 0!==i?i:ar.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=la.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),ya(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===la.Kind.Video&&(t="video"),0===this.attachedElements.length&&this.kind===la.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(sa.forEach((t=>{null!==t.parentElement||e||(e=t)})),e&&sa.splice(sa.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),ua(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some((e=>"audio"===e.kind));return e.play().then((()=>{this.emit(i?Do.AudioPlaybackStarted:Do.VideoPlaybackStarted)})).catch((t=>{"NotAllowedError"===t.name?this.emit(i?Do.AudioPlaybackFailed:Do.VideoPlaybackFailed,t):"AbortError"===t.name?cr.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):cr.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some((e=>"video"===e.kind))&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch((()=>{})))})),this.emit(Do.ElementAttached,e),e}detach(e){try{if(e){da(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(Do.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach((e=>{da(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(Do.ElementDetached,e)})),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=lr(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),sa.forEach((e=>{e.parentElement||(t=!1)})),t&&sa.push(e)}}handleAppVisibilityChanged(){return pr(this,void 0,void 0,(function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==la.Kind.Video||setTimeout((()=>this.attachedElements.forEach((e=>e.play().catch((()=>{}))))),0)}))}addAppVisibilityListener(){Oa()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Oa()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function ua(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach((e=>{n.removeTrack(e)})),n.addTrack(e)),xa()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(xa()||Pa())&&t instanceof HTMLVideoElement&&setTimeout((()=>{t.srcObject=n,t.play().catch((()=>{}))}),0))}function da(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}function ha(e,t,n){var i;const r=null!==(i=function(e){if(void 0!==e)return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(e))&&void 0!==i?i:{};return!0===r.audio&&(r.audio={}),!0===r.video&&(r.video={}),r.audio&&pa(r.audio,t),r.video&&pa(r.video,n),r}function pa(e,t){return Object.keys(t).forEach((n=>{void 0===e[n]&&(e[n]=t[n])})),e}function fa(e){const t={};if(e.video)if("object"==typeof e.video){const n={},i=n,r=e.video;Object.keys(r).forEach((e=>{if("resolution"===e)pa(i,r.resolution);else i[e]=r[e]})),t.video=n}else t.video=e.video;else t.video=!1;return e.audio?"object"==typeof e.audio?t.audio=e.audio:t.audio=!0:t.audio=!1,t}function ma(){const e="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);if(e)return new e({latencyHint:"interactive"})}function ga(e){return e===la.Source.Microphone?"audioinput":e===la.Source.Camera?"videoinput":void 0}function va(e){const t=e.split("/")[1].toLowerCase();if(!ta.includes(t))throw Error("Video codec not supported: ".concat(t));return t}function ba(e){const t=[];return e.forEach((e=>{void 0!==e.track&&t.push(new vi({cid:e.track.mediaStreamID,track:e.trackInfo}))})),t}function ya(e){return e instanceof la?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?ya(e.track):{})}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return yn.AUDIO;case t.Video:return yn.VIDEO;default:return yn.DATA}},e.kindFromProto=function(e){switch(e){case yn.AUDIO:return t.Audio;case yn.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return kn.CAMERA;case n.Microphone:return kn.MICROPHONE;case n.ScreenShare:return kn.SCREEN_SHARE;case n.ScreenShareAudio:return kn.SCREEN_SHARE_AUDIO;default:return kn.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case kn.CAMERA:return n.Camera;case kn.MICROPHONE:return n.Microphone;case kn.SCREEN_SHARE:return n.ScreenShare;case kn.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case si.ACTIVE:return i.Active;case si.PAUSED:return i.Paused;default:return i.Unknown}}}(la||(la={}));const ka="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function wa(e){return pr(this,void 0,void 0,(function*(){return new Promise((t=>Yo.setTimeout(t,e)))}))}function Sa(){return"addTransceiver"in RTCPeerConnection.prototype}function Ta(){return"addTrack"in RTCPeerConnection.prototype}function Ca(e){return"av1"===e||"vp9"===e}function Ea(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function Pa(){var e;return"Firefox"===(null===(e=Qo())||void 0===e?void 0:e.name)}function xa(){var e;return"Safari"===(null===(e=Qo())||void 0===e?void 0:e.name)}function Ra(){var e,t;return!!Oa()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function Oa(){return"undefined"!=typeof document}function _a(){return"ReactNative"==navigator.product}function Ia(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function Na(){if(e&&e.LiveKitReactNativeGlobal)return e.LiveKitReactNativeGlobal}function Ma(){if(!_a())return;let e=Na();return e?e.platform:void 0}function Da(){if(Oa())return window.devicePixelRatio;if(_a()){let e=Na();if(e)return e.devicePixelRatio}return 1}function La(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let e=0;e<r;++e){const t=parseInt(n[e],10),o=parseInt(i[e],10);if(t>o)return 1;if(t<o)return-1;if(e===r-1&&t===o)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function Aa(e){for(const t of e)t.target.handleResize(t)}function Ua(e){for(const t of e)t.target.handleVisibilityChanged(t)}let ja=null;const Fa=()=>(ja||(ja=new ResizeObserver(Aa)),ja);let Ba=null;const za=()=>(Ba||(Ba=new IntersectionObserver(Ua,{root:null,rootMargin:"0px"})),Ba);function Va(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const o=r.getContext("2d");null==o||o.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,2*Math.PI,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[s]=a.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}let qa;function Wa(){if(!qa){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[qa]=i.stream.getAudioTracks(),!qa)throw Error("Could not get empty media stream audio track");qa.enabled=!1}return qa.clone()}class Ha{constructor(e,t){this.onFinally=t,this.promise=new Promise(((t,n)=>pr(this,void 0,void 0,(function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})))).finally((()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)}))}}function Ka(e){if("string"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function Ga(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}const Qa="default";class Ja{static getInstance(){return void 0===this.instance&&(this.instance=new Ja),this.instance}getDevices(e){return pr(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=Ja.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){cr.debug("awaiting getUserMedia promise");try{e?yield Ja.userMediaPromiseMap.get(e):yield Promise.all(Ja.userMediaPromiseMap.values())}catch(e){cr.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(n&&(!xa()||!t.hasDeviceInUse(e))){if(0===r.filter((t=>t.kind===e)).length||r.some((t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i}))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e},n=yield navigator.mediaDevices.getUserMedia(t);r=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach((e=>{e.stop()}))}}return e&&(r=r.filter((t=>t.kind===e))),r}()}))}normalizeDeviceId(e,t,n){return pr(this,void 0,void 0,(function*(){if(t!==Qa)return t;const i=yield this.getDevices(e),r=i.find((e=>e.deviceId===Qa));if(!r)return void cr.warn("could not reliably determine default device");const o=i.find((e=>e.deviceId!==Qa&&e.groupId===(null!=n?n:r.groupId)));if(o)return null==o?void 0:o.deviceId;cr.warn("could not reliably determine default device")}))}hasDeviceInUse(e){return e?Ja.userMediaPromiseMap.has(e):Ja.userMediaPromiseMap.size>0}}Ja.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Ja.userMediaPromiseMap=new Map;class $a extends la{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch((()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext))),this.debouncedTrackMuteHandler=Ho((()=>pr(this,void 0,void 0,(function*(){yield this.pauseUpstream()}))),5e3),this.handleTrackUnmuteEvent=()=>pr(this,void 0,void 0,(function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()})),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Do.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new De,this.pauseUpstreamLock=new De,this.processorLock=new De,this.restartLock=new De,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==la.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}setMediaStreamTrack(e,t){return pr(this,void 0,void 0,(function*(){if(e===this._mediaStreamTrack&&!t)return;let n;if(this._mediaStreamTrack&&(this.attachedElements.forEach((e=>{da(this._mediaStreamTrack,e)})),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){const t=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(ua(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),n=this.processor.processedTrack}finally{t()}}this.sender&&(yield this.sender.replaceTrack(null!=n?n:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach((t=>{ua(null!=n?n:e,t)})))}))}waitForDimensions(){return pr(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===la.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=Qo())||void 0===n?void 0:n.os)&&(yield wa(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield wa(50)}throw new Bo("unable to get track dimensions after timeout")}()}))}getDeviceId(){return pr(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===la.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),r=e.kind===la.Kind.Audio?"audioinput":"videoinput";return t?Ja.getInstance().normalizeDeviceId(r,n,i):n}()}))}mute(){return pr(this,void 0,void 0,(function*(){return this.setTrackMuted(!0),this}))}unmute(){return pr(this,void 0,void 0,(function*(){return this.setTrackMuted(!1),this}))}replaceTrack(e,t){return pr(this,void 0,void 0,(function*(){if(!this.sender)throw new Bo("unable to replace an unpublished track");let n,i;return"boolean"==typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=null==n||n,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this}))}restart(e){return pr(this,void 0,void 0,(function*(){this.manuallyStopped=!1;const t=yield this.restartLock.lock();try{e||(e=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const t={audio:!1,video:!1};this.kind===la.Kind.Video?t.video=e:t.audio=e,this.attachedElements.forEach((e=>{da(this.mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const n=(yield navigator.mediaDevices.getUserMedia(t)).getTracks()[0];return n.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(n),this._constraints=e,this.emit(Do.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}}))}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),this.isMuted===e&&this._mediaStreamTrack.enabled!==e||(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Do.Muted:Do.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return pr(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),Ra()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))}))}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return pr(this,void 0,void 0,(function*(){const e=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(Do.UpstreamPaused,this);const e=Qo();if("Safari"===(null==e?void 0:e.name)&&La(e.version,"12.0")<0)throw new Fo("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{e()}}))}resumeUpstream(){return pr(this,void 0,void 0,(function*(){const e=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(Do.UpstreamResumed,this),yield this.sender.replaceTrack(this.mediaStreamTrack)}finally{e()}}))}getRTCStatsReport(){return pr(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;return yield this.sender.getStats()}))}setProcessor(e){return pr(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;const r=yield t.processorLock.lock();try{t.log.debug("setting up processor",t.logContext);const r=document.createElement(t.kind),o={kind:t.kind,track:t._mediaStreamTrack,element:r,audioContext:t.audioContext};if(yield e.init(o),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.stopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(ua(t._mediaStreamTrack,r),r.muted=!0,r.play().catch((e=>t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e})))),t.processor=e,t.processorElement=r,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(da(t._mediaStreamTrack,e),ua(t.processor.processedTrack,e));yield null===(i=t.sender)||void 0===i?void 0:i.replaceTrack(t.processor.processedTrack)}t.emit(Do.TrackProcessorUpdate,t.processor)}finally{r()}}()}))}getProcessor(){return this.processor}stopProcessor(){return pr(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(i=e.processorElement)||void 0===i||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Do.TrackProcessorUpdate))}()}))}}class Xa extends br.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:i,data:r}=e.data;switch(i){case"error":cr.error(r.error.message),this.emit(Po.EncryptionError,r.error);break;case"initAck":r.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"enable":if(r.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)})),this.encryptionEnabled!==r.enabled&&r.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(Po.ParticipantEncryptionStatusChanged,r.enabled,this.room.localParticipant),this.encryptionEnabled=r.enabled;else if(r.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(r.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(r.participantIdentity));this.emit(Po.ParticipantEncryptionStatusChanged,r.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(Co.KeyRatcheted,r.material,r.keyIndex)}},this.onWorkerError=e=>{cr.error("e2ee worker encountered an error:",{error:e.error}),this.emit(Po.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!Lo())throw new Fo("tried to setup end-to-end encryption on an unsupported browser");if(cr.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:ur.getLevel()}};this.worker&&(cr.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){cr.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):cr.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(Mo.RTPVideoMapUpdate,(e=>{this.postRTPMap(e)}))}setupEventListeners(e,t){e.on(Io.TrackPublished,((e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==Dn.NONE,t.identity))),e.on(Io.ConnectionStateChanged,(t=>{t===dc.Connected&&e.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==Dn.NONE,e.identity)}))}))})).on(Io.TrackUnsubscribed,((e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)})).on(Io.TrackSubscribed,((e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)})).on(Io.SignalConnected,(()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach((e=>{this.postKey(e)})),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)})),e.localParticipant.on(No.LocalTrackPublished,(e=>pr(this,void 0,void 0,(function*(){this.setupE2EESender(e.track,e.track.sender)})))),t.on(Co.SetKey,(e=>this.postKey(e))).on(Co.RatchetRequest,((e,t)=>this.postRatchetRequest(e,t)))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null==n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?va(n.mimeType):void 0)}}setupE2EESender(e,t){e instanceof $a&&t?this.handleSender(t,e.mediaStreamID,void 0):t||cr.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return pr(this,void 0,void 0,(function*(){if(this.worker){if(Ao()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(To in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,o=e.readableStream;if(!r||!o){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,o=t.readable}const a={kind:"decode",data:{readableStream:o,writableStream:r,trackId:t,codec:i,participantIdentity:n}};this.worker.postMessage(a,[o,r])}e[To]=!0}}))}handleSender(e,t,n){var i;if(!(To in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Ao()){cr.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{cr.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r,[i.readable,i.writable])}e[To]=!0}}}var Ya;!function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Ya||(Ya={}));class Za{constructor(){this.pendingTasks=new Map,this.taskMutex=new De,this.nextTaskIndex=0}run(e){return pr(this,void 0,void 0,(function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ya.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Ya.RUNNING,yield e()}finally{t.status=Ya.COMPLETED,this.pendingTasks.delete(t.id),n()}}))}flush(){return pr(this,void 0,void 0,(function*(){return this.run((()=>pr(this,void 0,void 0,(function*(){}))))}))}snapshot(){return Array.from(this.pendingTasks.values())}}const es=["syncState","trickle","offer","answer","simulate","leave"];var ts;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(ts||(ts={}));class ns{get currentState(){return this.state}get isDisconnected(){return this.state===ts.DISCONNECTING||this.state===ts.DISCONNECTED}get isEstablishingConnection(){return this.state===ts.CONNECTING||this.state===ts.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=ts.DISCONNECTED,this.log=cr,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=lr(null!==(n=t.loggerName)&&void 0!==n?n:ar.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new Za,this.queuedRequests=[],this.closingLock=new De,this.connectionLock=new De,this.state=ts.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return pr(this,void 0,void 0,(function*(){this.state=ts.CONNECTING,this.options=n;return yield this.connect(e,t,n,i)}))}reconnect(e,t,n,i){return pr(this,void 0,void 0,(function*(){if(!this.options)return void this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);this.state=ts.RECONNECTING,this.clearPingInterval();return yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}))}))}connect(e,t,n,i){this.connectOptions=n,e=(e=function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e)).replace(/\/$/,""),e+="/rtc";const r=function(e,t,n){var i;const r=new URLSearchParams;r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid));r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",_a()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel);t.os&&r.set("os",t.os);t.osVersion&&r.set("os_version",t.osVersion);t.browser&&r.set("browser",t.browser);t.browserVersion&&r.set("browser_version",t.browserVersion);n.adaptiveStream&&r.set("adaptive_stream","1");n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString());(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type);return"?".concat(r.toString())}(t,function(){var e;const t=new ei({sdk:ti.JS,protocol:15,version:"2.5.10"});return _a()&&(t.os=null!==(e=Ma())&&void 0!==e?e:""),t}(),n);return new Promise(((t,o)=>pr(this,void 0,void 0,(function*(){const a=yield this.connectionLock.lock();try{const a=()=>pr(this,void 0,void 0,(function*(){this.close(),clearTimeout(s),o(new jo("room connection has been cancelled (signal)"))})),s=setTimeout((()=>{this.close(),o(new jo("room connection has timed out (signal)"))}),n.websocketTimeout);(null==i?void 0:i.aborted)&&a(),null==i||i.addEventListener("abort",a),this.log.debug("connecting to ".concat(e+r),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(e+r),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(s)},this.ws.onerror=t=>pr(this,void 0,void 0,(function*(){if(this.state===ts.CONNECTED)this.handleWSError(t);else{this.state=ts.DISCONNECTED,clearTimeout(s);try{const t=yield fetch("http".concat(e.substring(2),"/validate").concat(r));if(t.status.toFixed(0).startsWith("4")){const e=yield t.text();o(new jo(e,Ro.NotAllowed,t.status))}else o(new jo("Internal error",Ro.InternalError,t.status))}catch(e){o(new jo("server was not reachable",Ro.ServerUnreachable))}}})),this.ws.onmessage=e=>pr(this,void 0,void 0,(function*(){var r,s,c;let l;if("string"==typeof e.data){const t=JSON.parse(e.data);l=ui.fromJson(t,{ignoreUnknownFields:!0})}else{if(!(e.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof e.data),this.logContext);l=ui.fromBinary(new Uint8Array(e.data))}if(this.state!==ts.CONNECTED){let e=!1;if("join"===(null===(r=l.message)||void 0===r?void 0:r.case)?(this.state=ts.CONNECTED,null==i||i.removeEventListener("abort",a),this.pingTimeoutDuration=l.message.value.pingTimeout,this.pingIntervalDuration=l.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),t(l.message.value)):this.state===ts.RECONNECTING&&"leave"!==l.message.case?(this.state=ts.CONNECTED,null==i||i.removeEventListener("abort",a),this.startPingInterval(),"reconnect"===(null===(s=l.message)||void 0===s?void 0:s.case)?t(l.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),t(void 0),e=!0)):this.isEstablishingConnection&&"leave"===l.message.case?o(new jo("Received leave request while trying to (re)connect",Ro.LeaveRequest)):n.reconnect||o(new jo("did not receive join response, got ".concat(null===(c=l.message)||void 0===c?void 0:c.case," instead"))),!e)return}this.signalLatency&&(yield wa(this.signalLatency)),this.handleSignalResponse(l)})),this.ws.onclose=e=>{this.isEstablishingConnection&&o(new jo("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:this.state})),this.handleOnClose(e.reason)}}finally{a()}}))))}close(){return pr(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=ts.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise((t=>{e.ws?e.ws.onclose=()=>{t()}:t()}));e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,wa(250)])),e.ws=void 0}}finally{t&&(e.state=ts.DISCONNECTED),n()}}()}))}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:rs(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:rs(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new pi({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new fi({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return pr(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const r=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new Ri({requestId:r,metadata:e,name:t,attributes:i})}),r}()}))}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new xi({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new Bi({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:nt.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Hi({timestamp:nt.parse(Date.now()),rtt:nt.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new Ti({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new Ei({reason:Cn.CLIENT_INITIATED,action:Pi.DISCONNECT})})}sendRequest(e){return pr(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){const i=!n&&!function(e){const t=es.indexOf(e.case)>=0;return cr.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(i&&t.state===ts.RECONNECTING)return void t.queuedRequests.push((()=>pr(t,void 0,void 0,(function*(){yield this.sendRequest(e,!0)}))));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield wa(t.signalLatency)),!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.case),t.logContext);const r=new li({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(e){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:e}))}}()}))}handleSignalResponse(e){var t,n;const i=e.message;if(null==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=is(i.value);this.onAnswer&&this.onAnswer(e)}else if("offer"===i.case){const e=is(i.value);this.onOffer&&this.onOffer(e)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return pr(this,void 0,void 0,(function*(){if(this.state===ts.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)}))}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Yo.setTimeout((()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")}),1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Yo.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Yo.setInterval((()=>{this.sendPing()}),1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Yo.clearInterval(this.pingInterval)}}function is(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function rs(e){return new yi({sdp:e.sdp,type:e.type})}var os,as,ss,cs,ls,us={},ds={},hs={exports:{}};function ps(){if(os)return hs.exports;os=1;var e=hs.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach((function(t){e[t].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),hs.exports}function fs(){return as||(as=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))}(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=ps(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,a,r)}})),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(ds)),ds}function ms(){if(cs)return ss;cs=1;var e=ps(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,r=i.length;return e.replace(t,(function(e){if(n>=r)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}}))},i=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(i[t.name][a]):r.push(i[t.names[o]])}else r.push(i[t.name]);return n.apply(null,r)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return ss=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var a=n.outerOrder||r,s=n.innerOrder||o,c=[];return a.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){c.push(i(n,e,t))}))}))})),t.media.forEach((function(t){c.push(i("m",e.m[0],t)),s.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){c.push(i(n,e,t))}))}))}))})),c.join("\r\n")+"\r\n"},ss}var gs=function(){if(ls)return us;ls=1;var e=fs(),t=ms();return us.write=t,us.parse=e.parse,us.parseParams=e.parseParams,us.parseFmtpConfig=e.parseFmtpConfig,us.parsePayloads=e.parsePayloads,us.parseRemoteCandidates=e.parseRemoteCandidates,us.parseImageAttributes=e.parseImageAttributes,us.parseSimulcastStreamList=e.parseSimulcastStreamList,us}();const vs="negotiationStarted",bs="negotiationComplete",ys="rtpVideoPayloadTypes";class ks extends br.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=cr,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Ho((e=>pr(this,void 0,void 0,(function*(){this.emit(vs);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}))),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=lr(null!==(n=t.loggerName)&&void 0!==n?n:ar.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return pr(this,void 0,void 0,(function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)}))}setRemoteDescription(e){return pr(this,void 0,void 0,(function*(){var t;let n;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=gs.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let o=0;return r.media.forEach((e=>{var t;"audio"===e.type&&(e.rtp.some((e=>"opus"===e.codec&&(o=e.payload,!0))),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some((e=>e.payload===o&&"nack"===e.type)))&&i.push(e.mid),e.fmtp.some((t=>t.payload===o&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0))))})),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const i=gs.parse(null!==(t=e.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type&&this.trackBitrates.some((t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter((e=>!e.includes("maxaveragebitrate"))).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0}))})),n=gs.write(i)}if(yield this.setMungedSDP(e,n,!0),this.pendingCandidates.forEach((e=>{this.pc.addIceCandidate(e)})),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate)this.renegotiate=!1,yield this.createAndSendOffer();else if("answer"===e.type&&(this.emit(bs),e.sdp)){gs.parse(e.sdp).media.forEach((e=>{"video"===e.type&&this.emit(ys,e.rtp)}))}}))}createAndSendOffer(e){return pr(this,void 0,void 0,(function*(){var t;if(void 0===this.onOffer)return;if((null==e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null==e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:n.sdp},this.logContext));const i=gs.parse(null!==(t=n.sdp)&&void 0!==t?t:"");i.media.forEach((e=>{"audio"===e.type?ws(e,[],[]):"video"===e.type&&this.trackBitrates.some((t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;if(Ca(t.codec)&&function(e){var t,n;let i=0;const r=null===(t=e.ext)||void 0===t?void 0:t.some((e=>e.uri===ka||(e.value>i&&(i=e.value),!1)));r||null===(n=e.ext)||void 0===n||n.push({value:i+1,uri:ka})}(e),"av1"!==t.codec)return!0;const i=Math.round(.7*t.maxbr);for(const t of e.fmtp)if(t.payload===n){t.config.includes("x-google-start-bitrate")||(t.config+=";x-google-start-bitrate=".concat(i));break}return!0}))})),yield this.setMungedSDP(n,gs.write(i)),this.onOffer(n)}))}createAndSetAnswer(){return pr(this,void 0,void 0,(function*(){var e;const t=yield this.pc.createAnswer(),n=gs.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach((e=>{"audio"===e.type&&ws(e,this.remoteStereoMids,this.remoteNackMids)})),yield this.setMungedSDP(t,gs.write(n)),t}))}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new Vo("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new Vo("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return pr(this,void 0,void 0,(function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach((e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}})),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0}))}setMungedSDP(e,t,n){return pr(this,void 0,void 0,(function*(){if(t){const i=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(n){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:n,sdp:t})),e.sdp=i}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(t){let i="unknown error";t instanceof Error?i=t.message:"string"==typeof t&&(i=t);const r={error:i,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(r.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:r})),new qo(i)}}))}}function ws(e,t,n){let i=0;e.rtp.some((e=>"opus"===e.codec&&(i=e.payload,!0))),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some((e=>e.payload===i&&"nack"===e.type))&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some((e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0))))}const Ss="vp8",Ts={audioPreset:ia.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:aa.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Ss,backupCodec:!0},Cs={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},Es={resolution:ra.h720.resolution},Ps={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new class{constructor(e){this._retryDelays=void 0!==e?[...e]:hr}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}},disconnectOnPageLeave:!0,webAudioMix:!1},xs={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Rs;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Rs||(Rs={}));class Os{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=xs.peerConnectionTimeout,this.log=cr,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map((e=>e.getConnectionState()));n.every((e=>"connected"===e))?this.state=Rs.CONNECTED:n.some((e=>"failed"===e))?this.state=Rs.FAILED:n.some((e=>"connecting"===e))?this.state=Rs.CONNECTING:n.every((e=>"closed"===e))?this.state=Rs.CLOSED:n.some((e=>"closed"===e))?this.state=Rs.CLOSING:n.every((e=>"new"===e))&&(this.state=Rs.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Rs[t]," to ").concat(Rs[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=lr(null!==(i=n.loggerName)&&void 0!==i?i:ar.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new ks(e,n),this.subscriber=new ks(e,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,ai.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,ai.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=e=>{var t;null===(t=this.onPublisherOffer)||void 0===t||t.call(this,e)},this.state=Rs.NEW,this.connectionLock=new De,this.remoteOfferLock=new De}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return pr(this,void 0,void 0,(function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()}))}triggerIceRestart(){return pr(this,void 0,void 0,(function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))}))}addIceCandidate(e,t){return pr(this,void 0,void 0,(function*(){t===ai.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)}))}createSubscriberAnswerFromOffer(e){return pr(this,void 0,void 0,(function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const t=yield this.remoteOfferLock.lock();try{yield this.subscriber.setRemoteDescription(e);return yield this.subscriber.createAndSetAnswer()}finally{t()}}))}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return pr(this,void 0,void 0,(function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map((n=>this.ensureTransportConnected(n,e,t))))}finally{i()}}))}negotiate(e){return pr(this,void 0,void 0,(function*(){return new Promise(((t,n)=>pr(this,void 0,void 0,(function*(){const i=setTimeout((()=>{n("negotiation timed out")}),this.peerConnectionTimeout);e.signal.addEventListener("abort",(()=>{clearTimeout(i),n("negotiation aborted")})),this.publisher.once(vs,(()=>{e.signal.aborted||this.publisher.once(bs,(()=>{clearTimeout(i),t()}))})),yield this.publisher.negotiate((e=>{clearTimeout(i),n(e)}))}))))}))}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===ai.PUBLISHER||e===ai.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return pr(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise(((e,r)=>pr(n,void 0,void 0,(function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),Yo.clearTimeout(o),r(new jo("room connection has been cancelled",Ro.Cancelled))};(null==t?void 0:t.signal.aborted)&&n(),null==t||t.signal.addEventListener("abort",n);const o=Yo.setTimeout((()=>{null==t||t.signal.removeEventListener("abort",n),r(new jo("could not establish pc connection"))}),i);for(;this.state!==Rs.CONNECTED;)if(yield wa(50),null==t?void 0:t.signal.aborted)return void r(new jo("room connection has been cancelled",Ro.Cancelled));Yo.clearTimeout(o),null==t||t.signal.removeEventListener("abort",n),e()}))))}()}))}}const _s=2e3;function Is(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}class Ns extends $a{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,la.Kind.Audio,t,n,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>pr(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}e&&this.prevStats&&(this._currentBitrate=Is(e,this.prevStats)),this.prevStats=e})),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Do.AudioTrackFeatureUpdate,this,xn.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Do.AudioTrackFeatureUpdate,this,xn.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}setDeviceId(e){return pr(this,void 0,void 0,(function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Ka(e)||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||Ka(e)===this._mediaStreamTrack.getSettings().deviceId)}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return pr(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===la.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return pr(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Ka(this._constraints.deviceId);return this.source!==la.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}restartTrack(e){return pr(this,void 0,void 0,(function*(){let t;if(e){const n=fa({audio:e});"boolean"!=typeof n.audio&&(t=n.audio)}yield this.restart(t)}))}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return pr(this,void 0,void 0,(function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n}))}startMonitor(){Oa()&&(this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),_s)))}setProcessor(e){return pr(this,void 0,void 0,(function*(){var t;const n=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Do.TrackProcessorUpdate,this.processor)}finally{n()}}))}setAudioContext(e){this.audioContext=e}getSenderStats(){return pr(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach((e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})})),t}))}checkForSilence(){return pr(this,void 0,void 0,(function*(){const e=yield function(e){return pr(this,arguments,void 0,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=ma();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,o=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield wa(t),i.getByteTimeDomainData(o);const a=o.some((e=>128!==e&&0!==e));return n.close(),!a}return!1}()}))}(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Do.AudioSilenceDetected)),e}))}}function Ms(e,t,n){switch(e.kind){case"audio":return new Ns(e,t,!1,void 0,n);case"video":return new Hs(e,t,!1,n);default:throw new Bo("unsupported track type: ".concat(e.kind))}}const Ds=Object.values(ra),Ls=Object.values(oa),As=Object.values(aa),Us=[ra.h180,ra.h360],js=[oa.h180,oa.h360],Fs=["q","h","f"];function Bs(e,t,n,i){var r,o;let a=null==i?void 0:i.videoEncoding;e&&(a=null==i?void 0:i.screenShareEncoding);const s=null==i?void 0:i.simulcast,c=null==i?void 0:i.scalabilityMode,l=null==i?void 0:i.videoCodec;if(!a&&!s&&!c||!t||!n)return[{}];a||(a=function(e,t,n,i){const r=function(e,t,n){if(e)return As;const i=t>n?t/n:n/t;if(Math.abs(i-16/9)<Math.abs(i-4/3))return Ds;return Ls}(e,t,n);let{encoding:o}=r[0];const a=Math.max(t,n);for(let e=0;e<r.length;e+=1){const t=r[e];if(o=t.encoding,t.width>=a)break}if(i)switch(i){case"av1":o=Object.assign({},o),o.maxBitrate=.7*o.maxBitrate;break;case"vp9":o=Object.assign({},o),o.maxBitrate=.85*o.maxBitrate}return o}(e,t,n,l),cr.debug("using video encoding",a));const u=new Zo(t,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&Ca(l)){const e=new Ws(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=Qo();if(xa()||_a()||"Chrome"===(null==n?void 0:n.name)&&La(null==n?void 0:n.version,"113")<0){const n="h"==e.suffix?2:3;for(let i=0;i<e.spatial;i+=1)t.push({rid:Fs[2-i],maxBitrate:a.maxBitrate/Math.pow(n,i),maxFramerate:u.encoding.maxFramerate});t[0].scalabilityMode=c}else t.push({maxBitrate:a.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(t[0].priority=u.encoding.priority,t[0].networkPriority=u.encoding.priority),cr.debug("using svc encoding",{encodings:t}),t}if(!s)return[a];let d,h=[];if(h=e?null!==(r=qs(null==i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:zs(e,u):null!==(o=qs(null==i?void 0:i.videoSimulcastLayers))&&void 0!==o?o:zs(e,u),h.length>0){const e=h[0];h.length>1&&([,d]=h);const i=Math.max(t,n);if(i>=960&&d)return Vs(t,n,[e,d,u]);if(i>=480)return Vs(t,n,[e,u])}return Vs(t,n,[u])}function zs(e,t){if(e)return[{scaleResolutionDownBy:2,fps:(n=t).encoding.maxFramerate}].map((e=>{var t,i;return new Zo(Math.floor(n.width/e.scaleResolutionDownBy),Math.floor(n.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*((null!==(t=n.encoding.maxFramerate)&&void 0!==t?t:30)/(null!==(i=e.fps)&&void 0!==i?i:30))))),e.fps,n.encoding.priority)}));var n;const{width:i,height:r}=t,o=i>r?i/r:r/i;return Math.abs(o-16/9)<Math.abs(o-4/3)?Us:js}function Vs(e,t,n){const i=[];if(n.forEach(((n,r)=>{if(r>=Fs.length)return;const o=Math.min(e,t),a={rid:Fs[r],scaleResolutionDownBy:Math.max(1,o/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(a.maxFramerate=n.encoding.maxFramerate);const s=Pa()||0===r;n.encoding.priority&&s&&(a.priority=n.encoding.priority,a.networkPriority=n.encoding.priority),i.push(a)})),_a()&&"ios"===Ma()){let e;i.forEach((t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate}));let t=!0;i.forEach((n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,cr.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),cr.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)}))}return i}function qs(e){if(e)return e.sort(((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0}))}class Ws{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class Hs extends $a{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,la.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>pr(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}const t=new Map(e.map((e=>[e.rid,e])));if(this.prevStats){let e=0;t.forEach(((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=Is(t,r)})),this._currentBitrate=e}this.prevStats=t})),this.senderLock=new De}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Oa())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),_s))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach((e=>{e.mediaStreamTrack.stop()})),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return pr(this,void 0,void 0,(function*(){var t,n,i,r,o;yield e.pauseUpstream.call(this);try{for(var a,s=!0,c=mr(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(null)}}catch(e){n={error:e}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return pr(this,void 0,void 0,(function*(){var t,n,i,r,o;yield e.resumeUpstream.call(this);try{for(var a,s=!0,c=mr(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(e.mediaStreamTrack)}}catch(e){n={error:e}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return pr(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source!==la.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return pr(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source!==la.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}}))}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return pr(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach((e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},o=n.get(e.remoteId);o&&(r.jitter=o.jitter,r.packetsLost=o.packetsLost,r.roundTripTime=o.roundTripTime),t.push(r)}})),t.sort(((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)})),t}))}setPublishingQuality(e){const t=[];for(let n=ca.LOW;n<=ca.HIGH;n+=1)t.push(new Ai({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(t)}setDeviceId(e){return pr(this,void 0,void 0,(function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Ka(e)||(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||Ka(e)===this._mediaStreamTrack.getSettings().deviceId)}))}restartTrack(e){return pr(this,void 0,void 0,(function*(){var t,n,i,r;let o;if(e){const t=fa({video:e});"boolean"!=typeof t.video&&(o=t.video)}yield this.restart(o);try{for(var a,s=!0,c=mr(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;e.sender&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(e){n={error:e}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}}))}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return pr(this,arguments,void 0,(function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r,o,a,s,c,l;if(yield t.setProcessor.call(n,e,i),null===(c=n.processor)||void 0===c?void 0:c.processedTrack)try{for(var u,d=!0,h=mr(n.simulcastCodecs.values());!(r=(u=yield h.next()).done);d=!0){s=u.value,d=!1;const e=s;yield null===(l=e.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}}catch(e){o={error:e}}finally{try{d||r||!(a=h.return)||(yield a.call(h))}finally{if(o)throw o.error}}}()}))}setDegradationPreference(e){return pr(this,void 0,void 0,(function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(e){this.log.warn("failed to set degradationPreference",Object.assign({error:e},this.logContext))}}))}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout((()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)}),5e3))}setPublishingCodecs(e){return pr(this,void 0,void 0,(function*(){var t,n,i,r,o,a,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=mr(e);!(r=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield Ks(t.sender,t.encodings,e.qualities,this.senderLock,this.log,this.logContext));else for(const t of e.qualities)if(t.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(e.qualities)}}catch(e){o={error:e}}finally{try{t||r||!(a=n.return)||(yield a.call(n))}finally{if(o)throw o.error}}return c}))}setPublishingLayers(e){return pr(this,void 0,void 0,(function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),this.sender&&this.encodings&&(yield Ks(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))}))}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return pr(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),Ra()&&this.isInBackground&&this.source===la.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}))}}function Ks(e,t,n,i,r,o){return pr(this,void 0,void 0,(function*(){const a=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:a}=i;if(!a)return;if(a.length!==t.length)return void r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:a,senderEncodings:t}));let s=!1;!1&&a[0].scalabilityMode||a.forEach(((e,i)=>{var a;let c=null!==(a=e.rid)&&void 0!==a?a:"";""===c&&(c="q");const l=Gs(c),u=n.find((e=>e.quality===l));u&&e.active!==u.enabled&&(s=!0,e.active=u.enabled,r.debug("setting layer ".concat(u.quality," to ").concat(e.active?"enabled":"disabled"),o),Pa()&&(u.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})),s&&(i.encodings=a,r.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:i.encodings})),yield e.setParameters(i))}finally{a()}}))}function Gs(e){switch(e){case"f":default:return ca.HIGH;case"h":return ca.MEDIUM;case"q":return ca.LOW}}function Qs(e,t,n,i){if(!n)return[new Un({quality:ca.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const i=n[0].scalabilityMode,r=new Ws(i),o=[],a="h"==r.suffix?1.5:2,s="h"==r.suffix?2:3;for(let i=0;i<r.spatial;i+=1)o.push(new Un({quality:Math.min(ca.HIGH,r.spatial-1)-i,width:Math.ceil(e/Math.pow(a,i)),height:Math.ceil(t/Math.pow(a,i)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(s,i)):0,ssrc:0}));return o}return n.map((n=>{var i,r,o;const a=null!==(i=n.scaleResolutionDownBy)&&void 0!==i?i:1;let s=Gs(null!==(r=n.rid)&&void 0!==r?r:"");return new Un({quality:s,width:Math.ceil(e/a),height:Math.ceil(t/a),bitrate:null!==(o=n.maxBitrate)&&void 0!==o?o:0,ssrc:0})}))}const Js="_lossy",$s="_reliable",Xs="leave-reconnect";var Ys;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Ys||(Ys={}));class Zs extends br.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=xs.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=Ys.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=cr,this.handleDataChannel=e=>pr(this,[e],void 0,(function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===$s)t.reliableDCSub=n;else{if(n.label!==Js)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()})),this.handleDataMessage=e=>pr(this,void 0,void 0,(function*(){var t,n;const i=yield this.dataProcessLock.lock();try{let i;if(e.data instanceof ArrayBuffer)i=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));i=yield e.data.arrayBuffer()}const r=jn.fromBinary(new Uint8Array(i));"speaker"===(null===(t=r.value)||void 0===t?void 0:t.case)?this.emit(Mo.ActiveSpeakersUpdate,r.value.value.speakers):("user"===(null===(n=r.value)||void 0===n?void 0:n.case)&&function(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}(r,r.value.value),this.emit(Mo.DataPacketReceived,r))}finally{i()}})),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?Fn.LOSSY:Fn.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(Mo.Disconnected),this.close()},i=Date.now()-this.reconnectStart;let r=this.getNextRetryDelay({elapsedMs:i,retryCount:this.reconnectAttempts});null!==r?(e===Xs&&(r=0),this.log.debug("reconnecting in ".concat(r,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Yo.setTimeout((()=>this.attemptReconnect(t).finally((()=>this.reconnectTimeout=void 0))),r)):n(i)},this.waitForRestarted=()=>new Promise(((e,t)=>{this.pcState===Ys.Connected&&e();const n=()=>{this.off(Mo.Disconnected,i),e()},i=()=>{this.off(Mo.Restarted,n),t()};this.once(Mo.Restarted,n),this.once(Mo.Disconnected,i)})),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);void 0!==t&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(Mo.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===ts.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(En.RR_SIGNAL_DISCONNECTED))},this.log=lr(null!==(t=e.loggerName)&&void 0!==t?t:ar.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new ns(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new De,this.dataProcessLock=new De,this.dcBufferStatus=new Map([[Fn.LOSSY,!0],[Fn.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(Mo.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(Mo.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(Mo.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(Mo.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(Mo.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(Mo.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(Mo.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(Mo.SignalRequestResponse,e)}get logContext(){var e,t,n,i,r,o,a,s;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(o=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===o?void 0:o.identity,pID:null===(s=null===(a=this.latestJoinResponse)||void 0===a?void 0:a.participant)||void 0===s?void 0:s.sid}}join(e,t,n,i){return pr(this,void 0,void 0,(function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),this.subscriberPrimary&&!r.fastPublish||this.negotiate(),this.clientConfiguration=r.clientConfiguration,r}catch(r){if(r instanceof jo&&r.reason===Ro.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw r}}))}close(){return pr(this,void 0,void 0,(function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(Mo.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}}))}cleanupPeerConnections(){return pr(this,void 0,void 0,(function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0}))}cleanupClient(){return pr(this,void 0,void 0,(function*(){yield this.client.close(),this.client.resetCallbacks()}))}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Bo("a track with the same ID has already been published");return new Promise(((t,n)=>{const i=setTimeout((()=>{delete this.pendingTrackResolvers[e.cid],n(new jo("publication of local track timed out, no response from server"))}),1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)}))}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(e){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:e}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return pr(this,void 0,void 0,(function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()}))}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return pr(this,void 0,void 0,(function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==Rs.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const i=this.makeRTCConfiguration(e);var r;this.pcManager=new Os(i,e.subscriberPrimary,this.loggerOptions),this.emit(Mo.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=e=>{this.client.sendOffer(e)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,i)=>pr(this,void 0,void 0,(function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===Rs.CONNECTED){const t=this.pcState===Ys.New;this.pcState=Ys.Connected,t&&this.emit(Mo.Connected,e)}else t===Rs.FAILED&&this.pcState===Ys.Connected&&(this.pcState=Ys.Disconnected,this.handleDisconnect("peerconnection failed","failed"===i?En.RR_SUBSCRIBER_FAILED:En.RR_PUBLISHER_FAILED));const r=this.client.isDisconnected||this.client.currentState===ts.RECONNECTING,o=[Rs.FAILED,Rs.CLOSING,Rs.CLOSED].includes(t);r&&o&&!this._isClosed&&this.emit(Mo.Offline)})),this.pcManager.onTrack=e=>{this.emit(Mo.MediaTrackAdded,e.track,e.streams[0],e.receiver)},void 0!==(r=null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)&&r>13||this.createDataChannels()}))}setupSignalClientCallbacks(){this.client.onAnswer=e=>pr(this,void 0,void 0,(function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))})),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>pr(this,void 0,void 0,(function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)})),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(Mo.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(Mo.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(Mo.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(Mo.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",En.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null==e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Pi.DISCONNECT:this.emit(Mo.Disconnected,null==e?void 0:e.reason),this.close();break;case Pi.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Xs);break;case Pi.RESUME:this.handleDisconnect(Xs)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach((e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)})),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Tn.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Js,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel($s,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return pr(this,void 0,void 0,(function*(){if(Sa()){return yield this.createTransceiverRTCRtpSender(e,t,n)}if(Ta()){this.log.warn("using add-track fallback",this.logContext);return yield this.createRTCRtpSender(e.mediaStreamTrack)}throw new Vo("Required webRTC APIs not supported on this device")}))}createSimulcastSender(e,t,n,i){return pr(this,void 0,void 0,(function*(){if(Sa())return this.createSimulcastTransceiverSender(e,t,n,i);if(Ta())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Vo("Cannot stream on this device")}))}createTransceiverRTCRtpSender(e,t,n){return pr(this,void 0,void 0,(function*(){if(!this.pcManager)throw new Vo("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),e instanceof Hs&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:i};n&&(r.sendEncodings=n);return(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender}))}createSimulcastTransceiverSender(e,t,n,i){return pr(this,void 0,void 0,(function*(){if(!this.pcManager)throw new Vo("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender}))}createRTCRtpSender(e){return pr(this,void 0,void 0,(function*(){if(!this.pcManager)throw new Vo("publisher is closed");return this.pcManager.addPublisherTrack(e)}))}attemptReconnect(e){return pr(this,void 0,void 0,(function*(){var t,n,i;if(!this._isClosed)if(this.attemptingReconnect)cr.warn("already attempting reconnect, returning early",this.logContext);else{(null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)!==Tn.DISABLED&&(null!==(i=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==i?i:Rs.NEW)!==Rs.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(e){this.reconnectAttempts+=1;let t=!0;e instanceof Vo?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:e})),t=!1):e instanceof ec||(this.fullReconnectOnNext=!0),t?this.handleDisconnect("reconnect",En.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Mo.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}}))}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:e}))}return null}restartConnection(e){return pr(this,void 0,void 0,(function*(){var t,n,i;try{if(!this.url||!this.token)throw new Vo("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Mo.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ec;n=yield this.join(null!=e?e:this.url,this.token,this.signalOpts)}catch(e){if(e instanceof jo&&e.reason===Ro.NotAllowed)throw new Vo("could not reconnect, token might be expired");throw new ec}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Mo.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==ts.CONNECTED)throw new ec("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(Mo.Restarted)}catch(e){const t=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(t)return void(yield this.restartConnection(t));throw null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),e}}))}resumeConnection(e){return pr(this,void 0,void 0,(function*(){var t;if(!this.url||!this.token)throw new Vo("could not reconnect, url or token not saved");if(!this.pcManager)throw new Vo("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Mo.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(e){let t="";if(e instanceof Error&&(t=e.message,this.log.error(e.message,Object.assign(Object.assign({},this.logContext),{error:e}))),e instanceof jo&&e.reason===Ro.NotAllowed)throw new Vo("could not reconnect, token might be expired");if(e instanceof jo&&e.reason===Ro.LeaveRequest)throw e;throw new ec(t)}if(this.emit(Mo.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==ts.CONNECTED)throw new ec("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),this.emit(Mo.Resumed)}))}waitForPCInitialConnection(e,t){return pr(this,void 0,void 0,(function*(){if(!this.pcManager)throw new Vo("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)}))}waitForPCReconnected(){return pr(this,void 0,void 0,(function*(){this.pcState=Ys.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield wa(2e3),!this.pcManager)throw new Vo("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ys.Connected}catch(e){throw this.pcState=Ys.Disconnected,new jo("could not establish PC connection, ".concat(e.message))}}))}sendDataPacket(e,t){return pr(this,void 0,void 0,(function*(){const n=e.toBinary();yield this.ensurePublisherConnected(t);const i=this.dataChannelForKind(t);i&&i.send(n),this.updateAndEmitDCBufferStatus(t)}))}ensureDataTransportConnected(e){return pr(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var i;if(!t.pcManager)throw new Vo("PC manager is closed");const r=n?t.pcManager.subscriber:t.pcManager.publisher,o=n?"Subscriber":"Publisher";if(!r)throw new jo("".concat(o," connection not set"));let a=!1;n||t.dataChannelForKind(e,n)||(t.createDataChannels(),a=!0),a||n||t.pcManager.publisher.isICEConnected||"checking"===t.pcManager.publisher.getICEConnectionState()||(a=!0),a&&t.negotiate();const s=t.dataChannelForKind(e,n);if("open"===(null==s?void 0:s.readyState))return;const c=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<c;){if(r.isICEConnected&&"open"===(null===(i=t.dataChannelForKind(e,n))||void 0===i?void 0:i.readyState))return;yield wa(50)}throw new jo("could not establish ".concat(o," connection, state: ").concat(r.getICEConnectionState()))}()}))}ensurePublisherConnected(e){return pr(this,void 0,void 0,(function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise}))}verifyTransport(){return!!this.pcManager&&(this.pcManager.currentState===Rs.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED))}negotiate(){return pr(this,void 0,void 0,(function*(){return new Promise(((e,t)=>pr(this,void 0,void 0,(function*(){if(!this.pcManager)return void t(new qo("PC manager is closed"));this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels();const n=new AbortController,i=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(Mo.Closing,i),this.pcManager.publisher.once(ys,(e=>{const t=new Map;e.forEach((e=>{const n=e.codec.toLowerCase();var i;i=n,ta.includes(i)&&t.set(e.payload,n)})),this.emit(Mo.RTPVideoMapUpdate,t)}));try{yield this.pcManager.negotiate(n),e()}catch(e){e instanceof qo&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",En.RR_UNKNOWN),t(e)}finally{this.off(Mo.Closing,i)}}))))}))}dataChannelForKind(e,t){if(t){if(e===Fn.LOSSY)return this.lossyDCSub;if(e===Fn.RELIABLE)return this.reliableDCSub}else{if(e===Fn.LOSSY)return this.lossyDC;if(e===Fn.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,s=new Array,c=new Array;e.forEach((e=>{e.isDesired!==a&&s.push(e.trackSid),e.isEnabled||c.push(e.trackSid)})),this.client.sendSyncState(new Vi({answer:r?rs({sdp:r.sdp,type:r.type}):void 0,offer:o?rs({sdp:o.sdp,type:o.type}):void 0,subscription:new wi({trackSids:s,subscribe:!a,participantTracks:[]}),publishTracks:ba(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null==t?void 0:t.id)&&null!==t.id&&e.push(new qi({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(Fn.LOSSY),ai.PUBLISHER),t(this.dataChannelForKind(Fn.RELIABLE),ai.PUBLISHER),t(this.dataChannelForKind(Fn.LOSSY,!0),ai.SUBSCRIBER),t(this.dataChannelForKind(Fn.RELIABLE,!0),ai.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Yo.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Oa()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Oa()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class ec extends Error{}class tc{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Ia(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return pr(this,void 0,void 0,(function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter((e=>!this.attemptedRegions.find((t=>t.url===e.url))));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),cr.debug("next region: ".concat(e.region)),e.url}return null}))}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return pr(this,void 0,void 0,(function*(){const t=yield fetch("".concat((n=this.serverUrl,"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});var n;if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new jo("Could not fetch region settings: ".concat(t.statusText),401===t.status?Ro.NotAllowed:void 0,t.status)}))}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class nc extends la{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Do.Muted:Do.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Do.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return pr(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.receiver)||void 0===e?void 0:e.getStats))return;return yield this.receiver.getStats()}))}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval((()=>this.monitorReceiver()),_s)),"undefined"!=typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame((()=>e()));const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(Do.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class ic extends nc{constructor(e,t,n,i,r,o){super(e,t,la.Kind.Audio,n,o),this.monitorReceiver=()=>pr(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Is(e,this.prevStats)),this.prevStats=e})),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;_a()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(_a())return 1;let e=0;return this.attachedElements.forEach((t=>{t.volume>e&&(e=t.volume)})),e}setSinkId(e){return pr(this,void 0,void 0,(function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map((t=>{if(Ea(t))return t.setSinkId(e)})))}))}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&Ea(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach((e=>{n.connect(e),n=e})),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then((()=>{"running"!==e.state&&this.emit(Do.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))})).catch((e=>{this.emit(Do.AudioPlaybackFailed,e)}))}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return pr(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach((t=>{"inbound-rtp"===t.type&&(e={type:"audio",timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})})),e}))}}class rc extends nc{constructor(e,t,n,i,r){super(e,t,la.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>pr(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Is(e,this.prevStats)),this.prevStats=e})),this.debouncedHandleResize=Ho((()=>{this.updateDimensions()}),100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach((t=>{e?da(this._mediaStreamTrack,t):ua(this._mediaStreamTrack,t)}))}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t.element===e))){const t=new oc(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t===e))?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter((t=>t===e));for(const e of t)e.stopObserving();this.elementInfos=this.elementInfos.filter((t=>t!==e)),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const e of t)this.stopObservingElement(e);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return pr(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach((e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)})),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t}))}stopObservingElement(e){const t=this.elementInfos.filter((t=>t.element===e));for(const e of t)this.stopObservingElementInfo(e)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return pr(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()}))}updateVisibility(){var e,t;const n=this.elementInfos.reduce(((e,t)=>Math.max(e,t.visibilityChangedAt||0)),0),i=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,r=this.elementInfos.some((e=>e.pictureInPicture)),o=this.elementInfos.some((e=>e.visible))&&!i||r;this.lastVisible!==o&&(!o&&Date.now()-n<100?Yo.setTimeout((()=>{this.updateVisibility()}),100):(this.lastVisible=o,this.emit(Do.VisibilityChanged,o,this)))}updateDimensions(){var e,t;let n=0,i=0;const r=this.getPixelDensity();for(const e of this.elementInfos){const t=e.width()*r,o=e.height()*r;t+o>n+i&&(n=t,i=o)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===i||(this.lastDimensions={width:n,height:i},this.emit(Do.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;if("screen"===t)return Da();if(!t){return Da()>2?2:1}return t}}class oc{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e;this.isPiP=!0,null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=!1,null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!=t?t:ac(e),this.isPiP=Oa()&&document.pictureInPictureElement===e,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=ac(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,za().observe(this.element),Fa().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var e,t;null===(e=za())||void 0===e||e.unobserve(this.element),null===(t=Fa())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function ac(e){let t=e.offsetTop,n=e.offsetLeft;const i=e.offsetWidth,r=e.offsetHeight,{hidden:o}=e,{opacity:a,display:s}=getComputedStyle(e);for(;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,n+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&n<window.pageXOffset+window.innerWidth&&t+r>window.pageYOffset&&n+i>window.pageXOffset&&!o&&(""===a||parseFloat(a)>0)&&"none"!==s}class sc extends br.EventEmitter{constructor(e,t,n,i){var r;super(),this.metadataMuted=!1,this.encryption=Dn.NONE,this.log=cr,this.handleMuted=()=>{this.emit(Do.Muted)},this.handleUnmuted=()=>{this.emit(Do.Unmuted)},this.log=lr(null!==(r=null==i?void 0:i.loggerName)&&void 0!==r?r:ar.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=la.Source.Unknown}setTrack(e){this.track&&(this.track.off(Do.Muted,this.handleMuted),this.track.off(Do.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Do.Muted,this.handleMuted),e.on(Do.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),ya(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==Dn.NONE}get audioTrack(){if(this.track instanceof Ns||this.track instanceof ic)return this.track}get videoTrack(){if(this.track instanceof Hs||this.track instanceof rc)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=la.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===la.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(sc||(sc={}));class cc extends sc{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Do.Ended)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&this.track.off(Do.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(Do.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){return pr(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()}))}unmute(){return pr(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()}))}pauseUpstream(){return pr(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()}))}resumeUpstream(){return pr(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()}))}getTrackFeatures(){var e;if(this.track instanceof Ns){const t=this.track.mediaStreamTrack.getSettings(),n=new Set;return t.autoGainControl&&n.add(xn.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(xn.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(xn.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(xn.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(xn.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(xn.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function lc(e){let t,n;return"object"==typeof e.audio&&e.audio.processor&&(t=e.audio.processor),"object"==typeof e.video&&e.video.processor&&(n=e.video.processor),{audioProcessor:t,videoProcessor:n}}var uc,dc;!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(uc||(uc={}));class hc extends br.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every((e=>e.isEncrypted))}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===Mn.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Mn.STANDARD;var a;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=uc.Unknown,this.log=cr,this.log=lr(null!==(a=null==r?void 0:r.loggerName)&&void 0!==a?a:ar.Participant),this.loggerOptions=r,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes={}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(la.Source.Camera);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(la.Source.Microphone);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(la.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(No.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(No.ParticipantNameChanged,e)}_setAttributes(e){const t=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],r={};for(const o of i)e[o]!==t[o]&&(r[o]=null!==(n=t[o])&&void 0!==n?n:"");return r}(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(No.AttributesChanged,t)}setPermissions(e){var t,n,i,r,o,a;const s=this.permissions,c=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(i=this.permissions)||void 0===i?void 0:i.canPublishData)||e.hidden!==(null===(r=this.permissions)||void 0===r?void 0:r.hidden)||e.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some(((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])}))||e.canSubscribeMetrics!==(null===(a=this.permissions)||void 0===a?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(No.ParticipantPermissionsChanged,s),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(No.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=function(e){switch(e){case Sn.EXCELLENT:return uc.Excellent;case Sn.GOOD:return uc.Good;case Sn.POOR:return uc.Poor;case Sn.LOST:return uc.Lost;default:return uc.Unknown}}(e),t!==this._connectionQuality&&this.emit(No.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach((t=>(t.track instanceof ic||t.track instanceof Ns)&&t.track.setAudioContext(e)))}addTrackPublication(e){e.on(Do.Muted,(()=>{this.emit(No.TrackMuted,e)})),e.on(Do.Unmuted,(()=>{this.emit(No.TrackUnmuted,e)}));const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case la.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case la.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}class pc extends hc{constructor(e,t,n,i){super(e,t,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Dn.NONE,this.enabledPublishVideoCodecs=[],this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Ha)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t;this.reconnectFuture&&(this.reconnectFuture.promise.catch((e=>this.log.warn(e.message,this.logContext))),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,r=this.pendingSignalRequests.get(t);r&&(n!==Xi.OK&&r.reject(new Wo(i,n)),this.pendingSignalRequests.delete(t))},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map((e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Fi({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e))))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),ya(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),ya(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),ya(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.handleSubscribedQualityUpdate=e=>pr(this,void 0,void 0,(function*(){var t,n,i,r,o,a;if(!(null===(o=this.roomOptions)||void 0===o?void 0:o.dynacast))return;const s=this.videoTrackPublications.get(e.trackSid);if(s)if(e.subscribedCodecs.length>0){if(!s.videoTrack)return;const o=yield s.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,u=mr(o);!(t=(c=yield u.next()).done);l=!0){r=c.value,l=!1;const e=r;na(e)&&(this.log.debug("publish ".concat(e," for ").concat(s.videoTrack.sid),Object.assign(Object.assign({},this.logContext),ya(s))),yield this.publishAdditionalCodecForTrack(s.videoTrack,e,s.options))}}catch(e){n={error:e}}finally{try{l||t||!(i=u.return)||(yield i.call(u))}finally{if(n)throw n.error}}}else e.subscribedQualities.length>0&&(yield null===(a=s.videoTrack)||void 0===a?void 0:a.setPublishingLayers(e.subscribedQualities));else this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))})),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>pr(this,void 0,void 0,(function*(){if(e.source===la.Source.ScreenShare||e.source===la.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),ya(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(e instanceof Ns||e instanceof Hs)try{if(Oa())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===la.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),ya(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(e){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),ya(e))),e instanceof Ns?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(t){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),ya(e))),yield e.mute()}})),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map,this.pendingSignalRequests=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Dn.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(Mo.RemoteMute,((e,t)=>{const n=this.trackPublications.get(e);n&&n.track&&(t?n.mute():n.unmute())})),this.engine.on(Mo.Connected,this.handleReconnected).on(Mo.SignalRestarted,this.handleReconnected).on(Mo.SignalResumed,this.handleReconnected).on(Mo.Restarting,this.handleReconnecting).on(Mo.Resuming,this.handleReconnecting).on(Mo.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Mo.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Mo.Disconnected,this.handleDisconnected).on(Mo.SignalRequestResponse,this.handleSignalRequestResponse)}setMetadata(e){return pr(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({metadata:e})}))}setName(e){return pr(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({name:e})}))}setAttributes(e){return pr(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({attributes:e})}))}requestMetadataUpdate(e){return pr(this,arguments,void 0,(function(e){var t=this;let{metadata:n,name:i,attributes:r}=e;return function*(){return new Promise(((e,o)=>pr(t,void 0,void 0,(function*(){var t,a;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!=n?n:this.metadata)&&void 0!==t?t:"",null!==(a=null!=i?i:this.name)&&void 0!==a?a:"",r),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{o(e),s=!0},values:{name:i,metadata:n,attributes:r}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!r||Object.entries(r).every((e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]}))))return this.pendingSignalRequests.delete(c),void e();yield wa(50)}o(new Wo("Request to update local metadata timed out","TimeoutError"))}catch(e){e instanceof Error&&o(e)}}))))}()}))}setCameraEnabled(e,t,n){return this.setTrackEnabled(la.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(la.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(la.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(No.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return pr(this,void 0,void 0,(function*(){this.encryptionType=e?Dn.GCM:Dn.NONE,yield this.republishAllTracks(void 0,!1)}))}setTrackEnabled(e,t,n,i){return pr(this,void 0,void 0,(function*(){var r,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(t)if(a)yield a.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:e})),yield null==t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case la.Source.Camera:t=yield this.createTracks({video:null===(r=n)||void 0===r||r});break;case la.Source.Microphone:t=yield this.createTracks({audio:null===(o=n)||void 0===o||o});break;case la.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new Bo(e)}const s=[];for(const e of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),ya(e))),s.push(this.publishTrack(e,i));const c=yield Promise.all(s);[a]=c}catch(e){throw null==t||t.forEach((e=>{e.stop()})),e instanceof Error&&!(e instanceof Bo)&&this.emit(No.MediaDevicesError,e),e}finally{this.pendingPublishing.delete(e)}}else if((null==a?void 0:a.track)||(a=yield this.waitForPendingPublicationOfSource(e)),a&&a.track)if(e===la.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const e=this.getTrackPublication(la.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield a.mute();return a}))}enableCameraAndMicrophone(){return pr(this,void 0,void 0,(function*(){if(!this.pendingPublishing.has(la.Source.Camera)&&!this.pendingPublishing.has(la.Source.Microphone)){this.pendingPublishing.add(la.Source.Camera),this.pendingPublishing.add(la.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map((e=>this.publishTrack(e))))}finally{this.pendingPublishing.delete(la.Source.Camera),this.pendingPublishing.delete(la.Source.Microphone)}}}))}createTracks(e){return pr(this,void 0,void 0,(function*(){var t,n;null!=e||(e={});const{audioProcessor:i,videoProcessor:r}=lc(e),o=ha(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults),a=fa(o);let s;try{s=yield navigator.mediaDevices.getUserMedia(a)}catch(e){throw e instanceof Error&&(a.audio&&(this.microphoneError=e),a.video&&(this.cameraError=e)),e}return a.audio&&(this.microphoneError=void 0,this.emit(No.AudioStreamAcquired)),a.video&&(this.cameraError=void 0),Promise.all(s.getTracks().map((e=>pr(this,void 0,void 0,(function*(){const t="audio"===e.kind;let n;t?o.audio:o.video;const c=t?a.audio:a.video;"boolean"!=typeof c&&(n=c);const l=Ms(e,n,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return l.kind===la.Kind.Video?l.source=la.Source.Camera:l.kind===la.Kind.Audio&&(l.source=la.Source.Microphone,l.setAudioContext(this.audioContext)),l.mediaStream=s,l instanceof Ns&&i?yield l.setProcessor(i):l instanceof Hs&&r&&(yield l.setProcessor(r)),l})))))}))}createScreenTracks(e){return pr(this,void 0,void 0,(function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new Fo("getDisplayMedia not supported");void 0!==e.resolution||function(){const e=Qo();return"Safari"===(null==e?void 0:e.name)&&e.version.startsWith("17.")}()||(e.resolution=aa.h1080fps30.resolution);const t=function(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"==typeof i?{}:i,i=xa()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new Bo("no video track found");const r=new Hs(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=la.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const o=[r];if(n.getAudioTracks().length>0){this.emit(No.AudioStreamAcquired);const e=new Ns(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=la.Source.ScreenShareAudio,o.push(e)}return o}))}publishTrack(e,t){return pr(this,void 0,void 0,(function*(){return this.publishOrRepublishTrack(e,t)}))}publishOrRepublishTrack(e,t){return pr(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,o,a,s;let c,l;if(e instanceof Ns&&e.setAudioContext(n.audioContext),yield null===(r=n.reconnectFuture)||void 0===r?void 0:r.promise,n.republishPromise&&!i&&(yield n.republishPromise),e instanceof $a&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case la.Source.Microphone:t="audioinput";break;case la.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new Ns(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new Hs(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new Bo("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach((t=>{t.track&&t.track===e&&(l=t)})),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),ya(l))),l;const u="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,d=null!==(o=null==t?void 0:t.forceStereo)&&void 0!==o?o:u;d&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),ya(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(a=t.dtx)&&void 0!==a||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!function(){const e=Qo(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||!!("iOS"===e.os&&e.osVersion&&La(t,e.osVersion)>=0)||"Safari"===e.name&&La(t,e.version)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=n.publish(e,h,d);n.pendingPublishPromises.set(e,p);try{return yield p}catch(e){throw e}finally{n.pendingPublishPromises.delete(e)}}()}))}publish(e,t,n){return pr(this,void 0,void 0,(function*(){var i,r,o,a,s,c,l,u,d,h;Array.from(this.trackPublications.values()).find((t=>e instanceof $a&&t.source===e.source))&&e.source!==la.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),ya(e))),t.stopMicTrackOnMute&&e instanceof Ns&&(e.stopOnMute=!0),e.source===la.Source.ScreenShare&&Pa()&&(t.simulcast=!1),"av1"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(xa())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),"vp9"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(Pa())return!1;if(xa()){const e=Qo();if((null==e?void 0:e.version)&&La(e.version,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=Ss),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some((e=>t.videoCodec===va(e.mime)))||(t.videoCodec=va(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(Do.Muted,this.onTrackMuted),e.on(Do.Unmuted,this.onTrackUnmuted),e.on(Do.Ended,this.handleTrackEnded),e.on(Do.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Do.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Do.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const f=new hi({cid:e.mediaStreamTrack.id,name:t.name,type:la.kindToProto(e.kind),muted:e.isMuted,source:la.sourceToProto(e.source),disableDtx:!(null===(i=t.dtx)||void 0===i||i),encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(r=t.red)||void 0===r||r),stream:null==t?void 0:t.stream});let m;if(e.kind===la.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch(t){const i=null!==(a=null===(o=this.roomOptions.videoCaptureDefaults)||void 0===o?void 0:o.resolution)&&void 0!==a?a:ra.h720.resolution;n={width:i.width,height:i.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),ya(e)),{dims:n}))}f.width=n.width,f.height=n.height,e instanceof Hs&&(Ca(p)&&(e.source===la.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),ya(e))))),t.scalabilityMode=null!==(s=t.scalabilityMode)&&void 0!==s?s:"L3T3_KEY"),f.simulcastCodecs=[new di({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:Ss}),t.backupCodec&&p!==t.backupCodec.codec&&f.encryption===Dn.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),f.simulcastCodecs.push(new di({codec:t.backupCodec.codec,cid:""})))),m=Bs(e.source===la.Source.ScreenShare,f.width,f.height,t),f.layers=Qs(f.width,f.height,m,Ca(t.videoCodec))}else e.kind===la.Kind.Audio&&(m=[{maxBitrate:null===(c=t.audioPreset)||void 0===c?void 0:c.maxBitrate,priority:null!==(u=null===(l=t.audioPreset)||void 0===l?void 0:l.priority)&&void 0!==u?u:"high",networkPriority:null!==(h=null===(d=t.audioPreset)||void 0===d?void 0:d.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new Vo("cannot publish track when not connected");const g=()=>pr(this,void 0,void 0,(function*(){var n,i,r;if(!this.engine.pcManager)throw new Vo("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,m),e instanceof Hs&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=function(e){return e.source===la.Source.ScreenShare||e.constraints.height&&Ka(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(e)),e.setDegradationPreference(t.degradationPreference)),m)if(Pa()&&e.kind===la.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:(null===(i=m[0])||void 0===i?void 0:i.maxBitrate)?m[0].maxBitrate/1e3:0})}else e.codec&&Ca(e.codec)&&(null===(r=m[0])||void 0===r?void 0:r.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:f.cid,codec:e.codec,maxbr:m[0].maxBitrate/1e3});yield this.engine.negotiate()}));let v;if(this.enabledPublishVideoCodecs.length>0){v=(yield Promise.all([this.engine.addTrack(f),g()]))[0]}else{let n;if(v=yield this.engine.addTrack(f),v.codecs.forEach((e=>{void 0===n&&(n=e.mimeType)})),n&&e.kind===la.Kind.Video){const i=va(n);i!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),ya(e)),{codec:i})),t.videoCodec=i,m=Bs(e.source===la.Source.ScreenShare,f.width,f.height,t))}yield g()}const b=new cc(e.kind,v,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return b.options=t,e.sid=v.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:m,trackInfo:v})),e instanceof Hs?e.startMonitor(this.engine.client):e instanceof Ns&&e.startMonitor(),this.addTrackPublication(b),this.emit(No.LocalTrackPublished,b),b}))}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return pr(this,void 0,void 0,(function*(){var i;if(this.encryptionType!==Dn.NONE)return;let r;if(this.trackPublications.forEach((t=>{t.track&&t.track===e&&(r=t)})),!r)throw new Bo("track is not published");if(!(e instanceof Hs))throw new Bo("track is not a video track");const o=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),a=function(e,t,n){var i,r,o,a;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&cr.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(o=s.height)&&void 0!==o?o:null===(a=e.dimensions)||void 0===a?void 0:a.height;return Bs(e.source===la.Source.ScreenShare,c,l,n)}(e,t,o);if(!a)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),ya(e)));const s=e.addSimulcastTrack(t,a);if(!s)return;const c=new hi({cid:s.mediaStreamTrack.id,type:la.kindToProto(e.kind),muted:e.isMuted,source:la.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=Qs(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new Vo("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>pr(this,void 0,void 0,(function*(){yield this.engine.createSimulcastSender(e,s,o,a),yield this.engine.negotiate()})))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:l}))}))}unpublishTrack(e,t){return pr(this,void 0,void 0,(function*(){var n,i;if(e instanceof $a){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),ya(e))),yield t)}const r=this.getPublicationForTrack(e),o=r?ya(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!r||!r.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));(e=r.track).off(Do.Muted,this.onTrackMuted),e.off(Do.Unmuted,this.onTrackUnmuted),e.off(Do.Ended,this.handleTrackEnded),e.off(Do.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Do.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Do.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(i=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===i||i),t&&e.stop();let a=!1;const s=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Rs.FAILED&&s)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===s&&(e.direction="inactive",a=!0);if(this.engine.removeTrack(s)&&(a=!0),e instanceof Hs){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(a=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(e){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:e}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case la.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case la.Kind.Video:this.videoTrackPublications.delete(r.trackSid)}return this.emit(No.LocalTrackUnpublished,r),r.setTrack(void 0),a&&(yield this.engine.negotiate()),r}))}unpublishTracks(e){return pr(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>this.unpublishTrack(e))))).filter((e=>e instanceof cc))}))}republishAllTracks(e){return pr(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise(((i,r)=>pr(t,void 0,void 0,(function*(){try{const t=[];this.trackPublications.forEach((n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))})),yield Promise.all(t.map((e=>pr(this,void 0,void 0,(function*(){const t=e.track;yield this.unpublishTrack(t,!1),n&&!t.isMuted&&t.source!==la.Source.ScreenShare&&t.source!==la.Source.ScreenShareAudio&&(t instanceof Ns||t instanceof Hs)&&!t.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))))),i()}catch(e){r(e)}finally{this.republishPromise=void 0}})))),yield t.republishPromise}()}))}publishData(e){return pr(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?Fn.RELIABLE:Fn.LOSSY,r=n.destinationIdentities,o=n.topic,a=new jn({kind:i,value:{case:"user",value:new Vn({participantIdentity:t.identity,payload:e,destinationIdentities:r,topic:o})}});yield t.engine.sendDataPacket(a,i)}()}))}publishDtmf(e,t){return pr(this,void 0,void 0,(function*(){const n=new jn({kind:Fn.RELIABLE,value:{case:"sipDtmf",value:new qn({code:e,digit:t})}});yield this.engine.sendDataPacket(n,Fn.RELIABLE)}))}sendChatMessage(e){return pr(this,void 0,void 0,(function*(){const t={id:crypto.randomUUID(),message:e,timestamp:Date.now()},n=new jn({value:{case:"chatMessage",value:new Kn(Object.assign(Object.assign({},t),{timestamp:nt.parse(t.timestamp)}))}});return yield this.engine.sendDataPacket(n,Fn.RELIABLE),this.emit(No.ChatMessage,t),t}))}editChatMessage(e,t){return pr(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new jn({value:{case:"chatMessage",value:new Kn(Object.assign(Object.assign({},n),{timestamp:nt.parse(n.timestamp),editTimestamp:nt.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,Fn.RELIABLE),this.emit(No.ChatMessage,n),n}))}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter((e=>"video"===e.mime.split("/")[0].toLowerCase()))}updateInfo(e){return e.sid===this.sid&&(!!super.updateInfo(e)&&(e.tracks.forEach((e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),ya(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}})),!0))}getPublicationForTrack(e){let t;return this.trackPublications.forEach((n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(i instanceof Ns||i instanceof Hs)&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))})),t}waitForPendingPublicationOfSource(e){return pr(this,void 0,void 0,(function*(){const t=Array.from(this.pendingPublishPromises.entries()).find((t=>{let[n]=t;return n.source===e}));if(t)return t[1]}))}}class fc extends sc{constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=ca.HIGH,this.handleEnded=e=>{this.setTrack(void 0),this.emit(Do.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.disabled=!e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensions=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new wi({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Xn({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Do.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?sc.SubscriptionStatus.Unsubscribed:super.isSubscribed?sc.SubscriptionStatus.Subscribed:sc.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?sc.PermissionStatus.Allowed:sc.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return!this.disabled}setEnabled(e){this.isManualOperationAllowed()&&this.disabled!==!e&&(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.currentVideoQuality!==e&&(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(this.track instanceof rc&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof rc&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Do.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Do.VisibilityChanged,this.handleVisibilityChange),i.off(Do.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Do.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Do.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Do.VisibilityChanged,this.handleVisibilityChange),e.on(Do.Ended,this.handleEnded),this.emit(Do.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Do.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Do.Muted:Do.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Do.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Do.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===la.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof rc&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Si({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):void 0!==this.currentVideoQuality?e.quality=this.currentVideoQuality:e.quality=ca.HIGH,this.emit(Do.UpdateSettings,e)}}class mc extends hc{static fromParticipantInfo(e,t,n){return new mc(e,t.sid,t.identity,t.name,t.metadata,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,r,o){super(t,n||"",i,r,o,arguments.length>6&&void 0!==arguments[6]?arguments[6]:Mn.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Do.UpdateSettings,(t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),ya(e))),this.signalClient.sendUpdateTrackSettings(t)})),e.on(Do.UpdateSubscription,(e=>{e.participantTracks.forEach((e=>{e.participantSid=this.sid})),this.signalClient.sendUpdateSubscription(e)})),e.on(Do.SubscriptionPermissionChanged,(t=>{this.emit(No.TrackSubscriptionPermissionChanged,e,t)})),e.on(Do.SubscriptionStatusChanged,(t=>{this.emit(No.TrackSubscriptionStatusChanged,e,t)})),e.on(Do.Subscribed,(t=>{this.emit(No.TrackSubscribed,t,e)})),e.on(Do.Unsubscribed,(t=>{this.emit(No.TrackUnsubscribed,t,e)})),e.on(Do.SubscriptionFailed,(t=>{this.emit(No.TrackSubscriptionFailed,e.trackSid,t)}))}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:la.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:la.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,i,r,o){let a=this.getTrackPublicationBySid(t);if(a||t.startsWith("TR")||this.trackPublications.forEach((t=>{a||e.kind!==t.kind.toString()||(a=t)})),!a)return 0===o?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(No.TrackSubscriptionFailed,t)):(void 0===o&&(o=20),void setTimeout((()=>{this.addSubscribedMediaTrack(e,t,n,i,r,o-1)}),150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),ya(a))),void this.emit(No.TrackSubscriptionFailed,t);let s;return s="video"===e.kind?new rc(e,t,i,r):new ic(e,t,i,this.audioContext,this.audioOutput),s.source=a.source,s.isMuted=a.isMuted,s.setMediaStream(n),s.start(),a.setTrack(s),this.volumeMap.has(a.source)&&s instanceof ic&&s.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach((e=>{var i,r;let o=this.getTrackPublicationBySid(e.sid);if(o)o.updateInfo(e);else{const t=la.kindFromProto(e.type);if(!t)return;o=new fc(t,e,null===(i=this.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),o.updateInfo(e),n.set(e.sid,o);const a=Array.from(this.trackPublications.values()).find((e=>e.source===(null==o?void 0:o.source)));a&&o.source!==la.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:ya(a),newTrack:ya(o)})),this.addTrackPublication(o)}t.set(e.sid,o)})),this.trackPublications.forEach((e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),ya(e))),this.unpublishTrack(e.trackSid,!0))})),n.forEach((e=>{this.emit(No.TrackPublished,e)})),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:i}=n;switch(i&&(i.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case la.Kind.Audio:this.audioTrackPublications.delete(e);break;case la.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(No.TrackUnpublished,n)}setAudioOutput(e){return pr(this,void 0,void 0,(function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach((n=>{var i;n.track instanceof ic&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))})),yield Promise.all(t)}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(dc||(dc={}));class gc extends br.EventEmitter{constructor(e){var t,n,i;super(),t=this,this.state=dc.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=cr,this.bufferedEvents=[],this.isResuming=!1,this.connect=(e,t,n)=>pr(this,void 0,void 0,(function*(){var i;if("undefined"==typeof RTCPeerConnection||!Sa()&&!Ta())throw _a()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const r=yield this.disconnectLock.lock();if(this.state===dc.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),r(),Promise.resolve();if(this.connectFuture)return r(),this.connectFuture.promise;this.setAndEmitConnectionState(dc.Connecting),(null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Ia(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new tc(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then((e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)})).catch((e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))})));const o=(i,a,s)=>pr(this,void 0,void 0,(function*(){var c,l;this.abortController&&this.abortController.abort();const u=new AbortController;this.abortController=u,null==r||r();try{yield this.attemptConnection(null!=s?s:e,t,n,u),this.abortController=void 0,i()}catch(e){if(this.regionUrlProvider&&e instanceof jo&&e.reason!==Ro.Cancelled&&e.reason!==Ro.NotAllowed){let t=null;try{t=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(e){if(e instanceof jo&&(401===e.status||e.reason===Ro.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void a(e)}t&&!(null===(l=this.abortController)||void 0===l?void 0:l.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(e.message,". Retrying with another region: ").concat(t),this.logContext),this.recreateEngine(),yield o(i,a,t)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),a(e))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),a(e)}})),a=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Ha(((e,t)=>{o(e,t,a)}),(()=>{this.clearConnectionFutures()})),this.connectFuture.promise})),this.connectSignal=(e,t,n,i,r,o)=>pr(this,void 0,void 0,(function*(){var a,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"==typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},o.signal);let u=l.serverInfo;if(u||(u={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=u,this.log.debug("connected to Livekit Server ".concat(Object.entries(u).map((e=>{let[t,n]=e;return"".concat(t,": ").concat(n)})).join(", ")),{room:null===(a=l.room)||void 0===a?void 0:a.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!u.version)throw new zo("unknown server version");return"0.15.1"===u.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l})),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(e){this.log.error(e instanceof Error?e.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:e}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,i)=>pr(this,void 0,void 0,(function*(){var r,o,a;this.state===dc.Reconnecting||this.isResuming||(null===(r=this.engine)||void 0===r?void 0:r.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(o=this.regionUrlProvider)||void 0===o?void 0:o.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},xs),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,i);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(Io.SignalConnected)}catch(e){yield this.engine.close(),this.recreateEngine();const t=new jo("could not establish signal connection");throw e instanceof Error&&(t.message="".concat(t.message,": ").concat(e.message)),e instanceof jo&&(t.reason=e.reason,t.status=e.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:e})),t}if(i.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new jo("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,i)}catch(e){throw yield this.engine.close(),this.recreateEngine(),e}Oa()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Oa()&&(document.addEventListener("freeze",this.onPageLeave),null===(a=navigator.mediaDevices)||void 0===a||a.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(dc.Connected),this.emit(Io.Connected),this.registerConnectionReconcile()})),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return pr(t,[...n],void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i,r,o;const a=yield e.disconnectLock.lock();try{if(e.state===dc.Disconnected)return void e.log.debug("already disconnected",e.logContext);e.log.info("disconnect from room",Object.assign({},e.logContext)),(e.state===dc.Connecting||e.state===dc.Reconnecting||e.isResuming)&&(e.log.warn("abort connection attempt",e.logContext),null===(n=e.abortController)||void 0===n||n.abort(),null===(r=null===(i=e.connectFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,new jo("Client initiated disconnect")),e.connectFuture=void 0),(null===(o=e.engine)||void 0===o?void 0:o.client.isDisconnected)||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,Cn.CLIENT_INITIATED),e.engine=void 0}finally{a()}}()}))},this.onPageLeave=()=>pr(this,void 0,void 0,(function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()})),this.startAudio=()=>pr(this,void 0,void 0,(function*(){const e=[],t=Qo();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=Wa();e.enabled=!0;const i=new MediaStream([e]);n.srcObject=i,document.addEventListener("visibilitychange",(()=>{n&&(n.srcObject=document.hidden?null:i,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))})),document.body.append(n),this.once(Io.Disconnected,(()=>{null==n||n.remove(),n=null}))}e.push(n)}this.remoteParticipants.forEach((t=>{t.audioTrackPublications.forEach((t=>{t.track&&t.track.attachedElements.forEach((t=>{e.push(t)}))}))}));try{yield Promise.all([this.acquireAudioContext(),...e.map((e=>(e.muted=!1,e.play())))]),this.handleAudioPlaybackStarted()}catch(e){throw this.handleAudioPlaybackFailed(e),e}})),this.startVideo=()=>pr(this,void 0,void 0,(function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach((t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach((t=>{e.includes(t)||e.push(t)}))}));yield Promise.all(e.map((e=>e.play()))).then((()=>{this.handleVideoPlaybackStarted()})).catch((e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)}))})),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(dc.Reconnecting)&&this.emit(Io.Reconnecting)},this.handleSignalRestarted=e=>pr(this,void 0,void 0,(function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(e){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:e}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch(e){return}this.setAndEmitConnectionState(dc.Connected),this.emit(Io.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()})),this.handleParticipantUpdates=e=>{e.forEach((e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===Nn.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)}))},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach((e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}})),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach((e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))})),this.activeSpeakers=t,this.emitWhenConnected(Io.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach((e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)})),e.forEach((e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))}));const n=Array.from(t.values());n.sort(((e,t)=>t.audioLevel-e.audioLevel)),this.activeSpeakers=n,this.emitWhenConnected(Io.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach((e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const i=la.streamStateFromProto(e.state);i!==n.track.streamState&&(n.track.streamState=i,t.emit(No.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(Io.TrackStreamStateChanged,n,n.track.streamState,t))}))},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find((t=>t.trackPublications.has(e.trackSid)));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);"user"===e.value.case?this.handleUserPacket(t,e.value.value,e.kind):"transcription"===e.value.case?this.handleTranscription(t,e.value.value):"sipDtmf"===e.value.case?this.handleSipDtmf(t,e.value.value):"chatMessage"===e.value.case?this.handleChatMessage(t,e.value.value):"metrics"===e.value.case&&this.handleMetrics(e.value.value,t)},this.handleUserPacket=(e,t,n)=>{this.emit(Io.DataReceived,t.payload,e,n,t.topic),null==e||e.emit(No.DataReceived,t.payload,n)},this.handleSipDtmf=(e,t)=>{this.emit(Io.SipDTMFReceived,t,e),null==e||e.emit(No.SipDTMFReceived,t)},this.bufferedSegments=new Map,this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),i=null==n?void 0:n.trackPublications.get(t.trackId),r=function(e,t){return e.segments.map((e=>{let{id:n,text:i,language:r,startTime:o,endTime:a,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),u=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:s,language:r,firstReceivedTime:l,lastReceivedTime:u}}))}(t,this.transcriptionReceivedTimes);null==i||i.emit(Do.TranscriptionReceived,r),null==n||n.emit(No.TranscriptionReceived,r,i),this.emit(Io.TranscriptionReceived,r,n,i)},this.handleChatMessage=(e,t)=>{const n=function(e){const{id:t,timestamp:n,message:i,editTimestamp:r}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(t);this.emit(Io.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(Io.MetricsReceived,e,t)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Io.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Io.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Io.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Io.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>pr(this,void 0,void 0,(function*(){const e=yield Ja.getInstance().getDevices(void 0,!1),t=["audiooutput"];for(let n of t){const t=e.filter((e=>e.kind===n));t.length>0&&!t.find((e=>e.deviceId===this.getActiveDevice(n)))&&(yield this.switchActiveDevice(n,t[0].deviceId))}this.emit(Io.MediaDevicesChanged)})),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(Io.RoomMetadataChanged,e.metadata),(null==t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(Io.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach((e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)}))},this.onLocalParticipantMetadataChanged=e=>{this.emit(Io.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(Io.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(Io.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(Io.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(Io.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null==e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>pr(this,void 0,void 0,(function*(){var t,n,i,r,o,a;if(null===(t=e.track)||void 0===t||t.on(Do.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(Do.Restarted,this.onLocalTrackRestarted),null===(o=null===(r=null===(i=e.track)||void 0===i?void 0:i.getProcessor())||void 0===r?void 0:r.onPublish)||void 0===o||o.call(r,this),this.emit(Io.LocalTrackPublished,e,this.localParticipant),e.track instanceof Ns){(yield e.track.checkForSilence())&&this.emit(Io.LocalAudioSilenceDetected,e)}const s=yield null===(a=e.track)||void 0===a?void 0:a.getDeviceId(),c=ga(e.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.localParticipant.activeDeviceMap.set(c,s),this.emit(Io.ActiveDeviceChanged,c,s))})),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(Do.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(Do.Restarted,this.onLocalTrackRestarted),this.emit(Io.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>pr(this,void 0,void 0,(function*(){const t=yield e.getDeviceId(!1),n=ga(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(Io.ActiveDeviceChanged,n,t))})),this.onLocalConnectionQualityChanged=e=>{this.emit(Io.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=e=>{this.emit(Io.MediaDevicesError,e)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(Io.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(Io.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},Ps),e),this.log=lr(null!==(n=this.options.loggerName)&&void 0!==n?n:ar.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Cs),null==e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Es),null==e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Ts),null==e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new De,this.localParticipant=new pc("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Ka(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Ka(this.options.audioCaptureDefaults.deviceId)),(null===(i=this.options.audioOutput)||void 0===i?void 0:i.deviceId)&&this.switchActiveDevice("audiooutput",Ka(this.options.audioOutput.deviceId)).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return pr(this,void 0,void 0,(function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)}))}setupE2EE(){var e;this.options.e2ee&&(this.e2eeManager=new Xa(this.options.e2ee),this.e2eeManager.on(Po.ParticipantEncryptionStatusChanged,((e,t)=>{t instanceof pc&&(this.isE2EEEnabled=e),this.emit(Io.ParticipantEncryptionStatusChanged,e,t)})),this.e2eeManager.on(Po.EncryptionError,(e=>this.emit(Io.EncryptionError,e))),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return pr(this,void 0,void 0,(function*(){return this.state===dc.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise(((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(Mo.RoomUpdate,n),e(t.sid))};this.engine.on(Mo.RoomUpdate,n),this.once(Io.Disconnected,(()=>{this.engine.off(Mo.RoomUpdate,n),t("Room disconnected before room server id was available")}))}))}))}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Zs(this.options),this.engine.on(Mo.ParticipantUpdate,this.handleParticipantUpdates).on(Mo.RoomUpdate,this.handleRoomUpdate).on(Mo.SpeakersChanged,this.handleSpeakersChanged).on(Mo.StreamStateChanged,this.handleStreamStateUpdate).on(Mo.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Mo.SubscriptionError,this.handleSubscriptionError).on(Mo.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Mo.MediaTrackAdded,((e,t,n)=>{this.onTrackAdded(e,t,n)})).on(Mo.Disconnected,(e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)})).on(Mo.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Mo.DataPacketReceived,this.handleDataPacket).on(Mo.Resuming,(()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(dc.SignalReconnecting)&&this.emit(Io.SignalReconnecting)})).on(Mo.Resumed,(()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(dc.Connected)&&this.emit(Io.Reconnected)})).on(Mo.SignalResumed,(()=>{this.bufferedEvents=[],(this.state===dc.Reconnecting||this.isResuming)&&this.sendSyncState()})).on(Mo.Restarting,this.handleRestarting).on(Mo.SignalRestarted,this.handleSignalRestarted).on(Mo.Offline,(()=>{this.setAndEmitConnectionState(dc.Reconnecting)&&this.emit(Io.Reconnecting)})).on(Mo.DCBufferStatusChanged,((e,t)=>{this.emit(Io.DCBufferStatusChanged,e,t)})).on(Mo.LocalTrackSubscribed,(e=>{const t=this.localParticipant.getTrackPublications().find((t=>{let{trackSid:n}=t;return n===e}));t?(this.localParticipant.emit(No.LocalTrackSubscribed,t),this.emitWhenConnected(Io.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)})),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ja.getInstance().getDevices(e,t)}prepareConnection(e,t){return pr(this,void 0,void 0,(function*(){if(this.state===dc.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Ia(new URL(e))&&t){this.regionUrlProvider=new tc(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===dc.Disconnected&&(this.regionUrl=n,yield fetch(Ga(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(Ga(e),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}}))}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return pr(this,void 0,void 0,(function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new Wi({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new Wi({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new Wi({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new Wi({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>pr(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new Wi({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>pr(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new Wi({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new Wi({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>pr(this,void 0,void 0,(function*(){const e=this.engine.client.onLeave;e&&e(new Ei({reason:Cn.CLIENT_INITIATED,action:Pi.RECONNECT}))}));break;case"subscriber-bandwidth":if(void 0===t||"number"!=typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new Wi({scenario:{case:"subscriberBandwidth",value:BigInt(t)}});break;case"leave-full-reconnect":n=new Wi({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())}))}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return pr(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,o,a,s,c,l,u;let d=!1,h=!0;const p=i?{exact:t}:t;if("audioinput"===e){const t=null!==(r=n.getActiveDevice(e))&&void 0!==r?r:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=p,d=t!==p;const i=Array.from(n.localParticipant.audioTrackPublications.values()).filter((e=>e.source===la.Source.Microphone));try{h=(yield Promise.all(i.map((e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(p)})))).every((e=>!0===e))}catch(e){throw n.options.audioCaptureDefaults.deviceId=t,e}}else if("videoinput"===e){const t=null!==(o=n.getActiveDevice(e))&&void 0!==o?o:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=p,d=t!==p;const i=Array.from(n.localParticipant.videoTrackPublications.values()).filter((e=>e.source===la.Source.Camera));try{h=(yield Promise.all(i.map((e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(p)})))).every((e=>!0===e))}catch(e){throw n.options.videoCaptureDefaults.deviceId=t,e}}else if("audiooutput"===e){if(!Ea()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");n.options.webAudioMix&&(t=null!==(a=yield Ja.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==a?a:""),null!==(s=(u=n.options).audioOutput)&&void 0!==s||(u.audioOutput={});const i=null!==(c=n.getActiveDevice(e))&&void 0!==c?c:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t,d=i!==p;try{n.options.webAudioMix&&(null===(l=n.audioContext)||void 0===l||l.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map((e=>e.setAudioOutput({deviceId:t}))))}catch(e){throw n.options.audioOutput.deviceId=i,e}}return d&&h&&(n.localParticipant.activeDeviceMap.set(e,t),n.emit(Io.ActiveDeviceChanged,e,t)),h}()}))}setupLocalParticipantEvents(){this.localParticipant.on(No.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(No.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(No.AttributesChanged,this.onLocalAttributesChanged).on(No.TrackMuted,this.onLocalTrackMuted).on(No.TrackUnmuted,this.onLocalTrackUnmuted).on(No.LocalTrackPublished,this.onLocalTrackPublished).on(No.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(No.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(No.MediaDevicesError,this.onMediaDevicesError).on(No.AudioStreamAcquired,this.startAudio).on(No.ChatMessage,this.onLocalChatMessageSent).on(No.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===dc.Connecting||this.state===dc.Reconnecting){const i=()=>{this.onTrackAdded(e,t,n),r()},r=()=>{this.off(Io.Reconnected,i),this.off(Io.Connected,i),this.off(Io.Disconnected,r)};return this.once(Io.Reconnected,i),this.once(Io.Connected,i),void this.once(Io.Disconnected,r)}if(this.state===dc.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);const i=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(t.id),r=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),r===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const s=Array.from(this.remoteParticipants.values()).find((e=>e.sid===r));if(!s)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);let c;this.options.adaptiveStream&&(c="object"==typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),s.addSubscribedMediaTrack(e,a,t,n,c)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==dc.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{e.unpublishTrack(t.trackSid)}))})),this.localParticipant.trackPublications.forEach((t=>{var n,i;t.track&&this.localParticipant.unpublishTrack(t.track,e),e&&(null===(n=t.track)||void 0===n||n.detach(),null===(i=t.track)||void 0===i||i.stop())})),this.localParticipant.off(No.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(No.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(No.AttributesChanged,this.onLocalAttributesChanged).off(No.TrackMuted,this.onLocalTrackMuted).off(No.TrackUnmuted,this.onLocalTrackUnmuted).off(No.LocalTrackPublished,this.onLocalTrackPublished).off(No.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(No.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(No.MediaDevicesError,this.onMediaDevicesError).off(No.AudioStreamAcquired,this.startAudio).off(No.ChatMessage,this.onLocalChatMessageSent).off(No.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Oa()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(dc.Disconnected),this.emit(Io.Disconnected,t)}}}handleParticipantDisconnected(e,t){this.remoteParticipants.delete(e),t&&(t.trackPublications.forEach((e=>{t.unpublishTrack(e.trackSid,!0)})),this.emit(Io.ParticipantDisconnected,t))}acquireAudioContext(){return pr(this,void 0,void 0,(function*(){var e,t;if("boolean"!=typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(e=ma())&&void 0!==e?e:void 0),this.audioContext&&"suspended"===this.audioContext.state)try{yield this.audioContext.resume()}catch(e){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:e}))}this.options.webAudioMix&&this.remoteParticipants.forEach((e=>e.setAudioContext(this.audioContext))),this.localParticipant.setAudioContext(this.audioContext);const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(Io.AudioPlaybackStatusChanged,n))}))}createParticipant(e,t){var n;let i;return i=t?mc.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new mc(this.engine.client,"",e,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);if(t){n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity)}return n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(Io.ParticipantConnected,n),n.on(No.TrackPublished,(e=>{this.emitWhenConnected(Io.TrackPublished,e,n)})).on(No.TrackSubscribed,((e,t)=>{e.kind===la.Kind.Audio?(e.on(Do.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(Do.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===la.Kind.Video&&(e.on(Do.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(Do.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Io.TrackSubscribed,e,t,n)})).on(No.TrackUnpublished,(e=>{this.emit(Io.TrackUnpublished,e,n)})).on(No.TrackUnsubscribed,((e,t)=>{this.emit(Io.TrackUnsubscribed,e,t,n)})).on(No.TrackSubscriptionFailed,(e=>{this.emit(Io.TrackSubscriptionFailed,e,n)})).on(No.TrackMuted,(e=>{this.emitWhenConnected(Io.TrackMuted,e,n)})).on(No.TrackUnmuted,(e=>{this.emitWhenConnected(Io.TrackUnmuted,e,n)})).on(No.ParticipantMetadataChanged,(e=>{this.emitWhenConnected(Io.ParticipantMetadataChanged,e,n)})).on(No.ParticipantNameChanged,(e=>{this.emitWhenConnected(Io.ParticipantNameChanged,e,n)})).on(No.AttributesChanged,(e=>{this.emitWhenConnected(Io.ParticipantAttributesChanged,e,n)})).on(No.ConnectionQualityChanged,(e=>{this.emitWhenConnected(Io.ConnectionQualityChanged,e,n)})).on(No.ParticipantPermissionsChanged,(e=>{this.emitWhenConnected(Io.ParticipantPermissionsChanged,e,n)})).on(No.TrackSubscriptionStatusChanged,((e,t)=>{this.emitWhenConnected(Io.TrackSubscriptionStatusChanged,e,t,n)})).on(No.TrackSubscriptionFailed,((e,t)=>{this.emit(Io.TrackSubscriptionFailed,e,n,t)})).on(No.TrackSubscriptionPermissionChanged,((e,t)=>{this.emitWhenConnected(Io.TrackSubscriptionPermissionChanged,e,t,n)})),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce(((e,t)=>(e.push(...t.getTrackPublications()),e)),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&t instanceof fc&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Yo.setInterval((()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Cn.STATE_MISMATCH)))}),4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Yo.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(Io.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach((e=>{let[t,n]=e;this.emit(t,...n)})),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.state===dc.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===dc.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return pr(this,void 0,void 0,(function*(){var t,n;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),r=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Rn({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:nt.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new In({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Io.SignalConnected),this.emit(Io.Connected),this.setAndEmitConnectionState(dc.Connected),i.video){const e=new cc(la.Kind.Video,new An({source:kn.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:yn.AUDIO,name:"video-dummy"}),new Hs(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Va(160*(null!==(t=r.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(No.LocalTrackPublished,e)}if(i.audio){const e=new cc(la.Kind.Audio,new An({source:kn.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:yn.AUDIO}),new Ns(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Wa(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(No.LocalTrackPublished,e)}for(let e=0;e<r.count-1;e+=1){let t=new In({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:Nn.ACTIVE,tracks:[],joinedAt:nt.parse(Date.now())});const i=this.getOrCreateParticipant(t.identity,t);if(r.video){const o=Va(160*(null!==(n=r.aspectRatios[e%r.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),a=new An({source:kn.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:yn.AUDIO});i.addSubscribedMediaTrack(o,a.sid,new MediaStream([o]),new RTCRtpReceiver),t.tracks=[...t.tracks,a]}if(r.audio){const e=Wa(),n=new An({source:kn.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:yn.AUDIO});i.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}i.updateInfo(t)}}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e!==Io.ActiveSpeakersChanged){const t=vc(n).filter((e=>void 0!==e));this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function vc(e){return e.map((e=>{if(e)return Array.isArray(e)?vc(e):"object"==typeof e?"logContext"in e&&e.logContext:e}))}var bc;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(bc||(bc={}));br.EventEmitter;br.EventEmitter;var yc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof e<"u"?e:typeof self<"u"?self:{};function kc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var wc,Sc={exports:{}};wc=Sc,function(e,t){wc.exports?wc.exports=t():e.log=t()}(yc,(function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch{return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments]))}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function u(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function d(e,n){var a,s,l,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch{}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch{}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return l??s??a},d.setLevel=function(e,n){return l=f(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch{}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch{}}}(l),c.call(d)},d.setDefaultLevel=function(e){s=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch{}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),c.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(a=f(o.getLevel())),c.call(d),o===d)for(var e in r)r[e].rebuild()},a=f(o?o.getLevel():"WARN");var m=p();null!=m&&(l=f(m)),c.call(d)}(o=new d).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new d(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o}));const Tc=kc(Sc.exports);var Cc=function(e,t){return Cc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Cc(e,t)};function Ec(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Cc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Pc(e,t,n,i){return new(n||(n=Promise))((function(t,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){e.done?t(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,a)}s((i=i.apply(e,[])).next())}))}function xc(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function Rc(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Oc(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function _c(e,t,n){if(2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function Ic(e){return this instanceof Ic?(this.v=e,this):new Ic(e)}function Nc(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",(function(e){return function(t){return Promise.resolve(t).then(e,l)}})),i[Symbol.asyncIterator]=function(){return this},i;function a(e,t){r[e]&&(i[e]=function(t){return new Promise((function(n,i){o.push([e,t,n,i])>1||s(e,t)}))},t&&(i[e]=t(i[e])))}function s(e,t){try{!function(e){e.value instanceof Ic?Promise.resolve(e.value.v).then(c,l):u(o[0][2],e)}(r[e](t))}catch(e){u(o[0][3],e)}}function c(e){s("next",e)}function l(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function Mc(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Rc(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,r,(t=e[n](t)).done,t.value)}))}}}function Dc(e){return"function"==typeof e}function Lc(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Ac=Lc((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function Uc(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var jc=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,i,r;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Rc(o),s=a.next();!s.done;s=a.next()){s.value.remove(this)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var c=this.initialTeardown;if(Dc(c))try{c()}catch(e){r=e instanceof Ac?e.errors:[e]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=Rc(l),d=u.next();!d.done;d=u.next()){var h=d.value;try{zc(h)}catch(e){r=r??[],e instanceof Ac?r=_c(_c([],Oc(r)),Oc(e.errors)):r.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}if(r)throw new Ac(r)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)zc(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Uc(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&Uc(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),Fc=jc.EMPTY;function Bc(e){return e instanceof jc||e&&"closed"in e&&Dc(e.remove)&&Dc(e.add)&&Dc(e.unsubscribe)}function zc(e){Dc(e)?e():e.unsubscribe()}var Vc=void 0,qc=!1,Wc=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,_c([e,t],Oc(n)))};function Hc(e){Wc((function(){throw e}))}function Kc(){}function Gc(e){e()}var Qc=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Bc(t)&&t.add(n)):n.destination=el,n}return Ec(t,e),t.create=function(e,t,n){return new Yc(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(jc),Jc=Function.prototype.bind;function $c(e,t){return Jc.call(e,t)}var Xc=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Zc(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Zc(e)}else Zc(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Zc(e)}},e}(),Yc=function(e){function t(t,n,i){var r,o,a=e.call(this)||this;Dc(t)||!t?r={next:t??void 0,error:n??void 0,complete:i??void 0}:a&&qc?((o=Object.create(t)).unsubscribe=function(){return a.unsubscribe()},r={next:t.next&&$c(t.next,o),error:t.error&&$c(t.error,o),complete:t.complete&&$c(t.complete,o)}):r=t;return a.destination=new Xc(r),a}return Ec(t,e),t}(Qc);function Zc(e){Hc(e)}var el={closed:!0,next:Kc,error:function(e){throw e},complete:Kc},tl="function"==typeof Symbol&&Symbol.observable||"@@observable";function nl(e){return e}var il=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this,r=function(e){return e&&e instanceof Qc||function(e){return e&&Dc(e.next)&&Dc(e.error)&&Dc(e.complete)}(e)&&Bc(e)}(e)?e:new Yc(e,t,n);return Gc((function(){var e=i,t=e.operator,n=e.source;r.add(t?t.call(r,n):n?i._subscribe(r):i._trySubscribe(r))})),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=rl(t))((function(t,i){var r=new Yc({next:function(t){try{e(t)}catch(e){i(e),r.unsubscribe()}},error:i,complete:t});n.subscribe(r)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[tl]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(e){return 0===e.length?nl:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=rl(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function rl(e){var t;return null!==(t=e??Vc)&&void 0!==t?t:Promise}function ol(e){return function(t){if(function(e){return Dc(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function al(e,t,n,i,r){return new sl(e,t,n,i,r)}var sl=function(e){function t(t,n,i,r,o,a){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=a,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=r?function(e){try{r(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return Ec(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Qc),cl=Lc((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),ll=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Ec(t,e),t.prototype.lift=function(e){var t=new ul(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new cl},t.prototype.next=function(e){var t=this;Gc((function(){var n,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var r=Rc(t.currentObservers),o=r.next();!o.done;o=r.next()){o.value.next(e)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Gc((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Gc((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,i=n.hasError,r=n.isStopped,o=n.observers;return i||r?Fc:(this.currentObservers=null,o.push(e),new jc((function(){t.currentObservers=null,Uc(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,i=t.thrownError,r=t.isStopped;n?e.error(i):r&&e.complete()},t.prototype.asObservable=function(){var e=new il;return e.source=this,e},t.create=function(e,t){return new ul(e,t)},t}(il),ul=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return Ec(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Fc},t}(ll);!function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}Ec(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,i=e._value;if(t)throw n;return this._throwIfClosed(),i},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)}}(ll);var dl=function(){return Date.now()},hl=function(e){function t(t,n){return e.call(this)||this}return Ec(t,e),t.prototype.schedule=function(e,t){return this},t}(jc),pl=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,_c([e,t],Oc(n)))},fl=function(e){return clearInterval(e)},ml=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return Ec(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),pl(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&fl(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,i=!1;try{this.work(e)}catch(e){i=!0,n=e||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Uc(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(hl),gl=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=dl,e}(),vl=function(e){function t(t,n){void 0===n&&(n=gl.now);var i=e.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return Ec(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(gl);function bl(e){return function(e){return e&&Dc(e.schedule)}(function(e){return e[e.length-1]}(e))?e.pop():void 0}new vl(ml);var yl=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function kl(e){return Dc(null==e?void 0:e.then)}function wl(e){return Dc(e[tl])}function Sl(e){return Symbol.asyncIterator&&Dc(null==e?void 0:e[Symbol.asyncIterator])}function Tl(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Cl="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function El(e){return Dc(null==e?void 0:e[Cl])}function Pl(e){return Nc(this,arguments,(function(){var t,n,i;return xc(this,(function(r){switch(r.label){case 0:t=e.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,Ic(t.read())];case 3:return n=r.sent(),i=n.value,n.done?[4,Ic(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,Ic(i)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function xl(e){return Dc(null==e?void 0:e.getReader)}function Rl(e){if(e instanceof il)return e;if(null!=e){if(wl(e))return function(e){return new il((function(t){var n=e[tl]();if(Dc(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}(e);if(yl(e))return function(e){return new il((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}(e);if(kl(e))return function(e){return new il((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Hc)}))}(e);if(Sl(e))return Ol(e);if(El(e))return function(e){return new il((function(t){var n,i;try{for(var r=Rc(e),o=r.next();!o.done;o=r.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}t.complete()}))}(e);if(xl(e))return function(e){return Ol(Pl(e))}(e)}throw Tl(e)}function Ol(e){return new il((function(t){(function(e,t){var n,i,r,o;return Pc(this,0,void 0,(function(){var a,s;return xc(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Mc(e),c.label=1;case 1:return[4,n.next()];case 2:if((i=c.sent()).done)return[3,4];if(a=i.value,t.next(a),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),r={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function _l(e,t,n,i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var o=t.schedule((function(){n(),r?e.add(this.schedule(null,i)):this.unsubscribe()}),i);if(e.add(o),!r)return o}function Il(e,t){return void 0===t&&(t=0),ol((function(n,i){n.subscribe(al(i,(function(n){return _l(i,e,(function(){return i.next(n)}),t)}),(function(){return _l(i,e,(function(){return i.complete()}),t)}),(function(n){return _l(i,e,(function(){return i.error(n)}),t)})))}))}function Nl(e,t){return void 0===t&&(t=0),ol((function(n,i){i.add(e.schedule((function(){return n.subscribe(i)}),t))}))}function Ml(e,t){if(!e)throw new Error("Iterable cannot be null");return new il((function(n){_l(n,t,(function(){var i=e[Symbol.asyncIterator]();_l(n,t,(function(){i.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Dl(e,t){if(null!=e){if(wl(e))return function(e,t){return Rl(e).pipe(Nl(t),Il(t))}(e,t);if(yl(e))return function(e,t){return new il((function(n){var i=0;return t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())}))}))}(e,t);if(kl(e))return function(e,t){return Rl(e).pipe(Nl(t),Il(t))}(e,t);if(Sl(e))return Ml(e,t);if(El(e))return function(e,t){return new il((function(n){var i;return _l(n,t,(function(){i=e[Cl](),_l(n,t,(function(){var e,t,r;try{t=(e=i.next()).value,r=e.done}catch(e){return void n.error(e)}r?n.complete():n.next(t)}),0,!0)})),function(){return Dc(null==i?void 0:i.return)&&i.return()}}))}(e,t);if(xl(e))return function(e,t){return Ml(Pl(e),t)}(e,t)}throw Tl(e)}function Ll(e,t){return ol((function(n,i){var r=0;n.subscribe(al(i,(function(n){i.next(e.call(t,n,r++))})))}))}function Al(e,t,n){return void 0===n&&(n=1/0),Dc(t)?Al((function(n,i){return Ll((function(e,r){return t(n,e,i,r)}))(Rl(e(n,i)))}),n):("number"==typeof t&&(n=t),ol((function(t,i){return function(e,t,n,i,r,o,a){var s=[],c=0,l=0,u=!1,d=function(){u&&!s.length&&!c&&t.complete()},h=function(e){c++;var r=!1;Rl(n(e,l++)).subscribe(al(t,(function(e){t.next(e)}),(function(){r=!0}),void 0,(function(){if(r)try{for(c--;s.length&&c<i;)e=void 0,e=s.shift(),a||h(e);d()}catch(e){t.error(e)}var e})))};return e.subscribe(al(t,(function(e){return c<i?h(e):s.push(e)}),(function(){u=!0,d()}))),function(){}}(t,i,e,n)})))}function Ul(){return function(e){return Al(nl,e)}(1)}function jl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ul()(function(e,t){return t?Dl(e,t):Rl(e)}(e,bl(e)))}function Fl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=bl(e);return ol((function(t,i){(n?jl(e,t,n):jl(e,t)).subscribe(i)}))}Lc((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function Bl(e){return!(typeof e>"u")&&(function(e){var t;return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&typeof(null==(t=e.publication)?void 0:t.track)<"u")}(e)||function(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&typeof e.publication<"u")}(e))}function zl(e){if("string"==typeof e||"number"==typeof e)return`${e}`;if(function(e){return!!e&&e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&typeof e.publication>"u"}(e))return`${e.participant.identity}_${e.source}_placeholder`;if(Bl(e))return`${e.participant.identity}_${e.publication.source}_${e.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${e}`)}function Vl(e){return e instanceof pc}var ql=[...[Io.ConnectionStateChanged,Io.RoomMetadataChanged,Io.ActiveSpeakersChanged,Io.ConnectionQualityChanged,Io.ParticipantConnected,Io.ParticipantDisconnected,Io.ParticipantPermissionsChanged,Io.ParticipantMetadataChanged,Io.ParticipantNameChanged,Io.ParticipantAttributesChanged,Io.TrackMuted,Io.TrackUnmuted,Io.TrackPublished,Io.TrackUnpublished,Io.TrackStreamStateChanged,Io.TrackSubscriptionFailed,Io.TrackSubscriptionPermissionChanged,Io.TrackSubscriptionStatusChanged],Io.LocalTrackPublished,Io.LocalTrackUnpublished];No.TrackPublished,No.TrackUnpublished,No.TrackMuted,No.TrackUnmuted,No.TrackStreamStateChanged,No.TrackSubscribed,No.TrackUnsubscribed,No.TrackSubscriptionPermissionChanged,No.TrackSubscriptionFailed,No.LocalTrackPublished,No.LocalTrackUnpublished;No.ConnectionQualityChanged,No.IsSpeakingChanged,No.ParticipantMetadataChanged,No.ParticipantPermissionsChanged,No.TrackMuted,No.TrackUnmuted,No.TrackPublished,No.TrackUnpublished,No.TrackStreamStateChanged,No.TrackSubscriptionFailed,No.TrackSubscriptionPermissionChanged,No.TrackSubscriptionStatusChanged;No.LocalTrackPublished,No.LocalTrackUnpublished;var Wl=Tc.getLogger("lk-components-js");function Hl(e){return"object"==typeof e}function Kl(e){return Array.isArray(e)&&e.filter(Hl).length>0}function Gl(e){return`lk-${e}`}function Ql(e){if(Bl(e))return e.publication;{const{source:t,name:n,participant:i}=e;if(t&&n)return i.getTrackPublications().find((e=>e.source===t&&e.trackName===n));if(n)return i.getTrackPublicationByName(n);if(t)return i.getTrackPublication(t);throw new Error("At least one of source and name needs to be defined")}}function Jl(e){return function(e,t){return new il((n=>{const i=(...e)=>{n.next(e)};return e.on(t,i),()=>{e.off(t,i)}}))}(e,Io.ConnectionStateChanged).pipe(Ll((([e])=>e)),Fl(e.state))}function $l(e){return function(e,...t){return new il((n=>{const i=()=>{n.next(e)};return t.forEach((t=>{e.on(t,i)})),()=>{t.forEach((t=>{e.off(t,i)}))}})).pipe(Fl(e))}(e,No.TrackMuted,No.TrackUnmuted,No.ParticipantPermissionsChanged,No.TrackPublished,No.TrackUnpublished,No.LocalTrackPublished,No.LocalTrackUnpublished,No.MediaDevicesError,No.TrackSubscriptionStatusChanged).pipe(Ll((e=>{const{isMicrophoneEnabled:t,isCameraEnabled:n,isScreenShareEnabled:i}=e,r=e.getTrackPublication(la.Source.Microphone);return{isCameraEnabled:n,isMicrophoneEnabled:t,isScreenShareEnabled:i,cameraTrack:e.getTrackPublication(la.Source.Camera),microphoneTrack:r,participant:e}})))}function Xl(e,t,n=!0){const i=[e.localParticipant,...Array.from(e.remoteParticipants.values())],r=[];return i.forEach((e=>{t.forEach((t=>{const i=Array.from(e.trackPublications.values()).filter((e=>e.source===t&&(!n||e.track))).map((t=>({participant:e,publication:t,source:t.source})));r.push(...i)}))})),{trackReferences:r,participants:i}}function Yl(e,t,n){var i,r;const o=null!=(i=n.additionalRoomEvents)?i:ql,a=null==(r=n.onlySubscribed)||r;return function(e,...t){return new il((n=>{const i=()=>{n.next(e)};return t.forEach((t=>{e.on(t,i)})),()=>{t.forEach((t=>{e.off(t,i)}))}})).pipe(Fl(e))}(e,...Array.from(new Set([Io.ParticipantConnected,Io.ParticipantDisconnected,Io.ConnectionStateChanged,Io.LocalTrackPublished,Io.LocalTrackUnpublished,Io.TrackPublished,Io.TrackUnpublished,Io.TrackSubscriptionStatusChanged,...o]).values())).pipe(Ll((e=>{const n=Xl(e,t,a);return Wl.debug(`TrackReference[] was updated. (length ${n.trackReferences.length})`,n),n})),Fl(Xl(e,t,a)))}Wl.setDefaultLevel("WARN"),new TextEncoder,new TextDecoder,b.createContext(void 0);const Zl=b.createContext(void 0);function eu(e){const t=b.useContext(Zl),n=e??t;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}b.createContext(void 0);const tu=b.createContext(void 0);function nu(e){const t=b.useContext(tu),n=e??t;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}const iu=b.createContext(void 0);function ru(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=ru(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function ou(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=ru(e))&&(i&&(i+=" "),i+=t);return i}function au(...e){return(...t)=>{for(const n of e)if("function"==typeof n)try{n(...t)}catch(e){}}}function su(...e){const t={...e[0]};for(let n=1;n<e.length;n++){const i=e[n];for(const e in i){const n=t[e],r=i[e];"function"==typeof n&&"function"==typeof r&&"o"===e[0]&&"n"===e[1]&&e.charCodeAt(2)>=65&&e.charCodeAt(2)<=90?t[e]=au(n,r):t[e]="className"!==e&&"UNSAFE_className"!==e||"string"!=typeof n||"string"!=typeof r?void 0!==r?r:n:ou(n,r)}}return t}const cu={connect:!0,audio:!1,video:!1};const lu=b.forwardRef((function(e,t){const{room:n,htmlProps:i}=function(e){const{token:t,serverUrl:n,options:i,room:r,connectOptions:o,connect:a,audio:s,video:c,screen:l,onConnected:u,onDisconnected:d,onError:h,onMediaDeviceFailure:p,onEncryptionError:f,simulateParticipants:m,...g}={...cu,...e};i&&r&&Wl.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[v,y]=b.useState();b.useEffect((()=>{y(r??new gc(i))}),[r]);const k=b.useMemo((()=>{const{className:e}={className:"lk-room-container"};return su(g,{className:e})}),[g]);return b.useEffect((()=>{if(!v)return;const e=()=>{const e=v.localParticipant;Wl.debug("trying to publish local tracks"),Promise.all([e.setMicrophoneEnabled(!!s,"boolean"!=typeof s?s:void 0),e.setCameraEnabled(!!c,"boolean"!=typeof c?c:void 0),e.setScreenShareEnabled(!!l,"boolean"!=typeof l?l:void 0)]).catch((e=>{Wl.warn(e),null==h||h(e)}))},t=e=>{const t=Oo.getFailure(e);null==p||p(t)},n=e=>{null==f||f(e)};return v.on(Io.SignalConnected,e).on(Io.MediaDevicesError,t).on(Io.EncryptionError,n),()=>{v.off(Io.SignalConnected,e).off(Io.MediaDevicesError,t).off(Io.EncryptionError,n)}}),[v,s,c,l,h,f,p]),b.useEffect((()=>{if(v){if(m)return void v.simulateParticipants({participants:{count:m},publish:{audio:!0,useRealTracks:!0}});if(!t)return void Wl.debug("no token yet");if(!n)return Wl.warn("no livekit url provided"),void(null==h||h(Error("no livekit url provided")));a?(Wl.debug("connecting"),v.connect(n,t,o).catch((e=>{Wl.warn(e),null==h||h(e)}))):(Wl.debug("disconnecting because connect is false"),v.disconnect())}}),[a,t,JSON.stringify(o),v,h,n,m]),b.useEffect((()=>{if(!v)return;const e=e=>{switch(e){case dc.Disconnected:d&&d();break;case dc.Connected:u&&u()}};return v.on(Io.ConnectionStateChanged,e),()=>{v.off(Io.ConnectionStateChanged,e)}}),[t,u,d,v]),b.useEffect((()=>{if(v)return()=>{Wl.info("disconnecting on onmount"),v.disconnect()}}),[v]),{room:v,htmlProps:k}}(e);return b.createElement("div",{ref:t,...i},n&&b.createElement(tu.Provider,{value:n},b.createElement(iu.Provider,{value:e.featureFlags},e.children)))}));function uu(e){const t=nu(e);return function(e,t,n=!0){const[i,r]=b.useState(t);return b.useEffect((()=>{if(n&&r(t),typeof window>"u"||!e)return;const i=e.subscribe(r);return()=>i.unsubscribe()}),[e,n]),i}(b.useMemo((()=>Jl(t)),[t]),t.state)}function du(e=[la.Source.Camera,la.Source.Microphone,la.Source.ScreenShare,la.Source.ScreenShareAudio,la.Source.Unknown],t={}){const n=nu(t.room),[i,r]=b.useState([]),[o,a]=b.useState([]),s=b.useMemo((()=>e.map((e=>Hl(e)?e.source:e))),[JSON.stringify(e)]);return b.useEffect((()=>{const e=Yl(n,s,{additionalRoomEvents:t.updateOnlyOn,onlySubscribed:t.onlySubscribed}).subscribe((({trackReferences:e,participants:t})=>{Wl.debug("setting track bundles",e,t),r(e),a(t)}));return()=>e.unsubscribe()}),[n,JSON.stringify(t.onlySubscribed),JSON.stringify(t.updateOnlyOn),JSON.stringify(e)]),b.useMemo((()=>{if(Kl(e)){const t=function(e,t){const n=new Map;if(Kl(e)){const i=e.filter((e=>e.withPlaceholder)).map((e=>e.source));t.forEach((e=>{const t=e.getTrackPublications().map((e=>{var t;return null==(t=e.track)?void 0:t.source})).filter((e=>void 0!==e)),r=Array.from(function(e,t){const n=new Set(e);for(const e of t)n.delete(e);return n}(new Set(i),new Set(t)));r.length>0&&n.set(e.identity,r)}))}return n}(e,o),n=Array.from(i);return o.forEach((e=>{t.has(e.identity)&&(t.get(e.identity)??[]).forEach((t=>{if(i.find((({participant:n,publication:i})=>e.identity===n.identity&&i.source===t)))return;Wl.debug(`Add ${t} placeholder for participant ${e.identity}.`);const r={participant:e,source:t};n.push(r)}))})),n}return i}),[i,o,e])}function hu(e){return void 0!==e}function pu(...e){return su(...e.filter(hu))}function fu(e,t={}){const[n,i]=b.useState(Ql(e)),[r,o]=b.useState(null==n?void 0:n.isMuted),[a,s]=b.useState(null==n?void 0:n.isSubscribed),[c,l]=b.useState(null==n?void 0:n.track),[u,d]=b.useState("landscape"),h=b.useRef(),{className:p,trackObserver:f}=b.useMemo((()=>function(e){const t=Ql(e),n=$l(e.participant).pipe(Ll((()=>Ql(e))),Fl(t));return{className:Gl(e.source===la.Source.Camera||e.source===la.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}(e)),[e.participant.sid??e.participant.identity,e.source,Bl(e)&&e.publication.trackSid]);return b.useEffect((()=>{const e=f.subscribe((e=>{Wl.debug("update track",e),i(e),o(null==e?void 0:e.isMuted),s(null==e?void 0:e.isSubscribed),l(null==e?void 0:e.track)}));return()=>null==e?void 0:e.unsubscribe()}),[f]),b.useEffect((()=>{var n,i;return c&&(h.current&&c.detach(h.current),null!=(n=t.element)&&n.current&&!(Vl(e.participant)&&"audio"===(null==c?void 0:c.kind))&&c.attach(t.element.current)),h.current=null==(i=t.element)?void 0:i.current,()=>{h.current&&(null==c||c.detach(h.current))}}),[c,t.element]),b.useEffect((()=>{var e,t;if("number"==typeof(null==(e=null==n?void 0:n.dimensions)?void 0:e.width)&&"number"==typeof(null==(t=null==n?void 0:n.dimensions)?void 0:t.height)){const e=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(e)}}),[n]),{publication:n,isMuted:r,isSubscribed:a,track:c,elementProps:pu(t.props,{className:p,"data-lk-local-participant":e.participant.isLocal,"data-lk-source":null==n?void 0:n.source,..."video"===(null==n?void 0:n.kind)&&{"data-lk-orientation":u}})}}var mu="object"==typeof yc&&yc&&yc.Object===Object&&yc,gu="object"==typeof self&&self&&self.Object===Object&&self;mu||gu||Function("return this")();const vu=b.forwardRef((function({trackRef:e,onSubscriptionStatusChanged:t,volume:n,muted:i,...r},o){const a=eu(e),s=b.useRef(null);b.useImperativeHandle(o,(()=>s.current));const{elementProps:c,isSubscribed:l,track:u,publication:d}=fu(a,{element:s,props:r});return b.useEffect((()=>{null==t||t(!!l)}),[l,t]),b.useEffect((()=>{void 0===u||void 0===n||(u instanceof ic?u.setVolume(n):Wl.warn("Volume can only be set on remote audio tracks."))}),[n,u]),b.useEffect((()=>{void 0===d||void 0===i||(d instanceof fc?d.setEnabled(!i):Wl.warn("Can only call setEnabled on remote track publications."))}),[i,d,u]),b.createElement("audio",{ref:s,...c})}));function bu({volume:e,muted:t}){const n=du([la.Source.Microphone,la.Source.ScreenShareAudio,la.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter((e=>!Vl(e.participant)&&e.publication.kind===la.Kind.Audio));return b.createElement("div",{style:{display:"none"}},n.map((n=>b.createElement(vu,{key:zl(n),trackRef:n,volume:e,muted:t}))))}function yu(e){var t,n=e.token,i=e.url,r=e.roomName,o=e.isStreaming,a=e.onStreamEnd,s=e.onStreamStart,c=e.setRoom,l=e.setLocalParticipant,u=e.setParticipantIdentity,d=z(b.useState(null),2),h=d[0],p=d[1],f=b.useCallback((function(e){p(e),c(e),s()}),[s,c]),m=b.useCallback((function(){p(null),c(null),a()}),[a,c]);return v.jsx(lu,{token:n,serverUrl:i,name:r,connectOptions:{autoSubscribe:!0,publishDefaults:{simulcast:!0,videoSimulcastLayers:[{width:640,height:360,fps:30}]},audioCaptureDefaults:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}},roomOptions:{adaptiveStream:!0,dynacast:!0,element:(null===(t=document.querySelector("flowon-widget"))||void 0===t||null===(t=t.shadowRoot)||void 0===t?void 0:t.getElementById("flowon-shadow-root"))||void 0},onConnected:f,onDisconnected:m,children:v.jsx(ku,{room:h,isStreaming:o,onStreamEnd:a,setLocalParticipant:l,setParticipantIdentity:u})})}var ku=function(e){var t=e.room,n=e.isStreaming,i=e.onStreamEnd,r=e.setLocalParticipant,o=e.setParticipantIdentity,a=function(e={}){const t=nu(e.room),[n,i]=b.useState(t.localParticipant),[r,o]=b.useState(n.isMicrophoneEnabled),[a,s]=b.useState(n.isMicrophoneEnabled),[c,l]=b.useState(n.lastMicrophoneError),[u,d]=b.useState(n.lastCameraError),[h,p]=b.useState(n.isMicrophoneEnabled),[f,m]=b.useState(void 0),[g,v]=b.useState(void 0),y=e=>{s(e.isCameraEnabled),o(e.isMicrophoneEnabled),p(e.isScreenShareEnabled),v(e.cameraTrack),m(e.microphoneTrack),l(e.participant.lastMicrophoneError),d(e.participant.lastCameraError),i(e.participant)};return b.useEffect((()=>{const e=$l(t.localParticipant).subscribe(y);return()=>e.unsubscribe()}),[t]),{isMicrophoneEnabled:r,isScreenShareEnabled:h,isCameraEnabled:a,microphoneTrack:f,cameraTrack:g,lastMicrophoneError:c,lastCameraError:u,localParticipant:n}}(),s=a.localParticipant,c=uu(),l=z(b.useState(!1),2),u=l[0],d=l[1];return b.useEffect((function(){"connected"===c&&s?(d(!0),console.log("Participant connected with identity:",s.identity),console.log("Connection State:",c),console.log("Local Participant:",s),o(s.identity)):d(!1)}),[c,s,o]),b.useEffect((function(){u&&s&&(s.setMicrophoneEnabled(!0),r(s))}),[u,s,r]),b.useEffect((function(){!n&&t&&(t.disconnect(),i())}),[n,t,i]),b.useEffect((function(){return function(){t&&t.disconnect()}}),[t]),v.jsx(v.Fragment,{children:v.jsx(bu,{})})},wu="https://flowon.ai/api/v1";console.log("API_BASE_URL:",wu);var Su=function(e){var t=e.agentId,n=e.isStreaming,i=e.setIsStreaming,r=e.isLiveKitActive,o=e.setIsLiveKitActive,a=e.token,s=e.setToken,c=e.url,l=e.setUrl,u=e.isConnecting,d=e.setIsConnecting,h=e.onStreamEnd,p=e.onStreamStart,f=e.bypassShowChatInputCondition,m=void 0!==f&&f,g=b.useRef(null);b.useRef(null),b.useRef(null);var y=z(b.useState(null),2),k=y[0],w=y[1],S=z(b.useState(null),2),T=S[0],C=S[1],E=z(b.useState(!1),2),P=E[0],x=E[1],R=z(b.useState(""),2),O=R[0],I=R[1],N=z(b.useState(""),2),M=N[0],D=N[1],L=z(b.useState(""),2),A=L[0],U=L[1],j=z(b.useState(!1),2),B=j[0],V=j[1],q=z(b.useState(null),2),ae=q[0],se=q[1],ce=z(b.useState(null),2),le=ce[0],ue=ce[1],de=z(b.useState(!1),2),he=de[0],pe=de[1],fe=z(b.useState(!1),2),me=fe[0],ge=fe[1],ve=b.useRef();b.useEffect((function(){k&&console.log("LiveKit room set in ChatBotMini:",k.name)}),[k]),b.useEffect((function(){if(le){var e=new EventSource("".concat(wu,"/conversation/events/").concat(le));return e.onmessage=function(e){"show_chat_input"===JSON.parse(e.data).type&&x(!0)},function(){e.close()}}}),[le]),b.useEffect((function(){n||x(!1)}),[n]);var be=b.useCallback(_(F().mark((function e(){var r,a,c,u,h,p,f;return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=8;break}i(!1),o(!1),w(null),C(null),x(!1),e.next=42;break;case 8:return d(!0),e.prev=9,e.next=12,fetch("".concat(wu,"/livekit/token?agent_id=").concat(t,"&user_id=").concat("visitor"),{method:"GET",headers:{"Content-Type":"application/json"}});case 12:return r=e.sent,e.next=15,r.text();case 15:if(a=e.sent,console.log("Raw response:",a),r.ok){e.next=19;break}throw new Error("Failed to fetch token: ".concat(r.status," ").concat(r.statusText));case 19:e.prev=19,c=JSON.parse(a),e.next=27;break;case 23:throw e.prev=23,e.t0=e.catch(19),console.error("Failed to parse response as JSON:",e.t0),new Error("Invalid response format from server");case 27:h=(u=c).accessToken,p=u.url,f=u.roomName,s(h),l(p),C(f),o(!0),i(!0),e.next=39;break;case 35:e.prev=35,e.t1=e.catch(9),console.error("Failed to connect:",e.t1),alert("Failed to connect to the streaming service. Please try again later.");case 39:return e.prev=39,d(!1),e.finish(39);case 42:case"end":return e.stop()}}),e,null,[[9,35,39,42],[19,23]])}))),[t,n,i,o,s,l,d]),ye=b.useCallback(function(){var e=_(F().mark((function e(t){return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),m||P){e.next=4;break}return console.log("Form submission blocked: Chat input not shown"),e.abrupt("return");case 4:return e.prev=4,e.next=7,fetch("".concat(wu,"/conversation/chat_message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:O,email:M,contactNumber:A,user_id:null,room_name:T,participant_identity:le})});case 7:if(e.sent.ok){e.next=10;break}throw new Error("Failed to submit form");case 10:console.log("Form submitted successfully:",{fullName:O,email:M,contactNumber:A}),I(""),D(""),U(""),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(4),console.error("Failed to submit form:",e.t0),alert("Failed to submit form. Please try again.");case 20:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t){return e.apply(this,arguments)}}(),[O,M,A,T,P,m,le]),ke=b.useCallback((function(){if(ae){var e=!B;ae.setMicrophoneEnabled(!e),V(e)}}),[ae,B]);return b.useEffect((function(){return function(){ve.current&&clearTimeout(ve.current)}}),[]),v.jsx("div",{className:"".concat(W," \n        ").concat(he?$:H,"\n        ").concat(me?oe:""),onClick:function(){return!he&&pe(!0)},children:he?v.jsxs(v.Fragment,{children:[v.jsxs("header",{className:K,children:[v.jsx("h2",{children:"Flowon"}),v.jsx("button",{className:ne,onClick:function(e){e.stopPropagation(),ge(!0),ve.current=setTimeout((function(){pe(!1),ge(!1)}),300)},children:""})]}),v.jsxs("div",{className:"".concat(G," flex items-center justify-center"),ref:g,children:[v.jsx(_e,{onStreamToggle:be,isStreaming:n,isConnecting:u}),r&&a&&c&&T&&v.jsxs(v.Fragment,{children:[v.jsx(yu,{token:a,url:c,roomName:T,isStreaming:n,onStreamEnd:h,onStreamStart:p,setRoom:w,setLocalParticipant:se,setParticipantIdentity:ue}),n&&ae&&v.jsx("button",{onClick:ke,className:"".concat(ee," ").concat(B?te:""),children:B?"Unmute":"Mute"})]})]}),P&&n&&v.jsx("div",{className:Q,children:v.jsxs("form",{onSubmit:ye,children:[v.jsx("input",{type:"text",value:O,onChange:function(e){return I(e.target.value)},placeholder:"Full Name",required:!0}),v.jsx("input",{type:"email",value:M,onChange:function(e){return D(e.target.value)},placeholder:"Email Address",required:!0}),v.jsx("input",{type:"tel",value:A,onChange:function(e){return U(e.target.value)},placeholder:"Contact Number (optional)"}),v.jsx("button",{type:"submit",className:X,children:"Submit"})]})}),v.jsxs("footer",{className:J,children:[v.jsx("img",{src:"/flowon_see_though_v2.png",alt:"Flowon.AI Logo",className:Y}),v.jsx("span",{className:Z,children:"Powered by Flowon.AI"})]})]}):v.jsx("div",{className:ie,children:v.jsx("img",{src:"/flowon_see_though_v2.png",alt:"Flowon",className:re})})})},Tu=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=I(this,t,arguments),Object.defineProperty(e,"state",{enumerable:!0,configurable:!0,writable:!0,value:{hasError:!1}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(t,e),function(e,t,n){return t&&N(e.prototype,t),n&&N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"componentDidCatch",value:function(e,t){console.error("Uncaught error:",e,t)}},{key:"render",value:function(){return this.state.hasError?v.jsx("h1",{children:"Sorry.. there was an error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}])}(b.Component),Cu=function(e){var t=e.children;return v.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:v.jsx("div",{className:"w-full max-w-md",children:t})})};function Eu(e){var t=e.agentId;e.domain;var n=e.containerId,i=void 0===n?"flowon-widget-root":n,r=z(b.useState(!1),2),o=r[0],a=r[1],s=z(b.useState(!1),2),c=s[0],l=s[1],u=z(b.useState(null),2),d=u[0],h=u[1],p=z(b.useState(null),2),f=p[0],m=p[1],g=z(b.useState(!1),2),y=g[0],k=g[1];return v.jsx(Cu,{children:v.jsx("div",{id:i,className:"flowon-widget-container",style:{isolation:"isolate",all:"unset",fontFamily:"inherit",boxSizing:"border-box"},children:v.jsx(Tu,{children:v.jsx(Su,{agentId:t,isStreaming:o,setIsStreaming:a,isLiveKitActive:c,setIsLiveKitActive:l,token:d,setToken:h,url:f,setUrl:m,isConnecting:y,setIsConnecting:k,onStreamEnd:function(){console.log("Stream ended")},onStreamStart:function(){console.log("Stream started")},bypassShowChatInputCondition:!0,localParticipant:null,setLocalParticipant:function(){},userId:"test-user-id"})})})})}q(":root{--flowon-colors-primary:#0baadf;--flowon-colors-secondary:#0b8aaf;--flowon-colors-background:#fff;--flowon-colors-text:#000;--flowon-colors-border:#eee;--flowon-colors-gradient-start:rgba(45,45,45,.95);--flowon-colors-gradient-end:rgba(75,75,75,.95);--flowon-colors-shadow:rgba(0,0,0,.2);--flowon-colors-error:#721c24;--flowon-colors-error-bg:#f8d7da;--flowon-spacing-xs:8px;--flowon-spacing-sm:10px;--flowon-spacing-md:20px;--flowon-spacing-lg:32px;--flowon-border-radius-sm:10px;--flowon-border-radius-md:20px;--flowon-border-radius-full:9999px;--flowon-transition-duration:0.3s;--flowon-transition-timing:ease-in-out;--flowon-z-index-base:2147483647;--flowon-z-index-overlay:2147483648;--flowon-chat-min-size:60px;--flowon-chat-expanded-width:350px;--flowon-chat-expanded-height:500px}.flowon-widget-root{all:initial;all:initial!important;bottom:var(--flowon-spacing-md);box-sizing:border-box;contain:content;contain:content!important;font-family:system-ui,-apple-system,sans-serif;isolation:isolate;isolation:isolate!important;pointer-events:none;position:fixed;right:var(--flowon-spacing-md);z-index:var(--flowon-z-index-base)}.flowon-widget-root *{box-sizing:border-box;pointer-events:auto}.flowon-widget-root,.flowon-widget-root *,.flowon-widget-root :after,.flowon-widget-root :before{all:revert;font-family:inherit}.container{isolation:isolate}",{insertAt:"top"});var Pu="FlowonWidget",xu=function(e){var t;if(null!==(t=window[Pu])&&void 0!==t&&t.initialized)console.warn("Widget already initialized");else{var n=document.getElementById(e);if(n){var i=window.embeddedChatbotConfig;if(i&&i.agentId&&i.domain)x.createRoot(n).render(v.jsx(y.StrictMode,{children:v.jsx(Eu,{agentId:i.agentId,domain:i.domain})})),window[Pu]={initialized:!0,initialize:xu,version:"0.0.0"};else console.error("EmbeddedChatbotConfig is missing or incomplete.")}else console.error('Container with id "'.concat(e,'" not found'))}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){return xu("embedded-chatbot-container")})):xu("embedded-chatbot-container"),window.EmbeddedChatbot={initialize:xu}}()}();
//# sourceMappingURL=embed.min.js.map
