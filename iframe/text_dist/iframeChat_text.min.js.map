{"version":3,"file":"iframeChat_text.min.js","sources":["../iframeChat_text.js"],"sourcesContent":["class TextChatWidget {\n  constructor(config = {}) {\n    this.config = {\n      agentId: config.agentId || 'null',\n      widgetDomain: config.widgetDomain || '/textwidget',\n      iframeDomain: config.iframeDomain || 'iframe_domain_not_defined',\n      position: config.position || 'right',\n    };\n    \n    this.isExpanded = false;\n    this.isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || window.innerWidth <= 768;\n    window.addEventListener('resize', () => {\n      this.isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || window.innerWidth <= 768;\n    });\n    \n    if (!document.querySelector('meta[name=\"viewport\"]')) {\n      const viewport = document.createElement('meta');\n      viewport.name = 'viewport';\n      viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';\n      document.getElementsByTagName('head')[0].appendChild(viewport);\n    }\n    \n    this.iframeLoaded = false;\n    this.init();\n    this.setupMessageListener();\n  }\n\n  init() {\n    // Updated styles to include both collapsed and expanded states\n    const styles = `\n      .text-chat-widget-container {\n        position: fixed;\n        ${this.config.position}: 20px;\n        bottom: 50px;\n        z-index: 9999;\n      }\n\n      .text-chat-widget-container .chat-frame {\n        position: absolute;\n        bottom: 90px;\n        ${this.config.position}: 0;\n        width: 430px;\n        aspect-ratio: 9/16;\n        border-radius: 12px;\n        background: white;\n        border: 1px solid rgba(255, 255, 255, 0.25);\n        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);\n        opacity: 0;\n        visibility: hidden;\n        transition: all 0.3s ease;\n      }\n\n      .text-chat-widget-container.expanded .chat-frame {\n        opacity: 1;\n        visibility: visible;\n      }\n\n      .text-chat-widget-button {\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background: white;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 12px;\n      }\n\n      .text-chat-widget-icon {\n        width: 100%;\n        height: 100%;\n        transition: transform 0.3s ease;\n      }\n\n      .text-chat-widget-icon.chat {\n        display: block;\n      }\n\n      .text-chat-widget-icon.arrow {\n        display: none;\n        transform: rotate(180deg);\n      }\n\n      .expanded .text-chat-widget-icon.chat {\n        display: none;\n      }\n\n      .expanded .text-chat-widget-icon.arrow {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .text-chat-widget-icon img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n\n      .text-chat-widget-iframe {\n        display: none;\n        width: 100%;\n        height: 100%;\n        border: none;\n        border-radius: 12px;\n        margin: 0;\n        padding: 0;\n      }\n\n      .expanded .text-chat-widget-iframe {\n        display: block;\n        width: 100%;\n        height: 100%;\n        border: none;\n        border-radius: 12px;\n      }\n\n      @media (max-width: 640px) {\n        .text-chat-widget-container.expanded {\n          width: 90%;\n          ${this.config.position}: 10px;\n          bottom: 10px;\n        }\n      }\n\n      /* New Mobile Styles */\n      @media (max-width: 768px), (hover: none) {\n        .text-chat-widget-container {\n          ${this.config.position}: 10px;\n          bottom: calc(20px + env(safe-area-inset-bottom));\n        }\n\n        .text-chat-widget-button {\n          width: 50px;\n          height: 50px;\n          padding: 10px;\n        }\n\n        .text-chat-widget-container.expanded {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          margin: 0;\n          padding: 0;\n          ${this.config.position}: 0;\n          padding-bottom: env(safe-area-inset-bottom);\n          padding-top: env(safe-area-inset-top);\n          z-index: 2147483647;\n        }\n\n        .text-chat-widget-container.expanded .chat-frame {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          margin: 0;\n          padding: 0;\n          border: none;\n          border-radius: 0;\n          transform: none;\n          z-index: 2147483647;\n        }\n\n        .text-chat-widget-container.expanded .text-chat-widget-iframe {\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          margin: 0;\n          padding: 0;\n          border: none;\n          border-radius: 0;\n          transform: none;\n          z-index: 2147483647;\n        }\n\n        .text-chat-widget-container .close-button {\n          display: none;\n        }\n\n        .text-chat-widget-container.expanded .close-button {\n          display: none;\n        }\n      }\n\n      /* Base close button styles */\n      .text-chat-widget-close-btn {\n        display: none;  /* Hidden by default */\n        position: fixed;  /* Always fixed position */\n        top: 20px;\n        right: 20px;\n        width: 40px;  /* Slightly larger for better touch target */\n        height: 40px;\n        border-radius: 50%;\n        background: rgba(0, 0, 0, 0.2);\n        border: none;\n        cursor: pointer;\n        align-items: center;\n        justify-content: center;\n        z-index: 2147483647;\n      }\n\n      /* Remove any conflicting mobile styles elsewhere */\n      @media (max-width: 768px), (hover: none) {\n        .text-chat-widget-container.expanded .text-chat-widget-close-btn {\n          display: flex !important;  /* Force display on mobile */\n        }\n\n        /* Ensure iframe is below the close button */\n        .text-chat-widget-container.expanded .chat-frame,\n        .text-chat-widget-container.expanded .text-chat-widget-iframe {\n          z-index: 2147483646;\n        }\n      }\n\n      /* Remove any other close button related styles in other media queries */\n\n      .text-chat-widget-close-btn:hover {\n        background: rgba(0, 0, 0, 0.2);\n      }\n\n      .text-chat-widget-close-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n    `;\n\n    // Create container with initial collapsed state\n    this.container = document.createElement('div');\n    this.container.className = 'text-chat-widget-container collapsed';\n    \n    // Add chat icon and iframe\n    this.container.innerHTML = `\n      <div class=\"chat-frame\">\n        <button class=\"text-chat-widget-close-btn\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M18 6L6 18M6 6l12 12\" stroke=\"#000000\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </button>\n        <iframe \n          class=\"text-chat-widget-iframe\"\n          src=\"${this.config.widgetDomain}/?agentId=${this.config.agentId}\"\n          allow=\"microphone; camera\"\n          sandbox=\"allow-same-origin allow-scripts allow-forms allow-popups\"\n          crossorigin=\"anonymous\"\n        ></iframe>\n      </div>\n      <div class=\"text-chat-widget-button\">\n        <div class=\"text-chat-widget-icon chat\">\n          <img src=\"${this.config.iframeDomain}/live-chat.png\" alt=\"Live Chat\">\n        </div>\n        <div class=\"text-chat-widget-icon arrow\">\n          <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M7 14l5-5 5 5\" stroke=\"#000000\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </div>\n      </div>\n    `;\n\n    // After appending the container to the DOM, add the click handler\n    const chatButton = this.container.querySelector('.text-chat-widget-button');\n    chatButton.addEventListener('click', () => this.toggleWidget());\n\n    // Add click handler for close button\n    const closeButton = this.container.querySelector('.text-chat-widget-close-btn');\n    closeButton.addEventListener('click', () => this.toggleWidget());\n\n    // Add styles and container to DOM\n    const styleSheet = document.createElement('style');\n    styleSheet.textContent = styles;\n    document.head.appendChild(styleSheet);\n    document.body.appendChild(this.container);\n\n    // Add a load event listener to the iframe\n    const iframe = this.container.querySelector('.text-chat-widget-iframe');\n    iframe.addEventListener('load', () => {\n      this.iframeLoaded = true;\n      this.injectIframeStyles();\n    });\n  }\n\n  toggleWidget() {\n    this.isExpanded = !this.isExpanded;\n    if (this.isExpanded) {\n      this.container.classList.remove('collapsed');\n      this.container.classList.add('expanded');\n      if (this.isMobile) {\n        // Prevent all scrolling and bouncing effects\n        document.body.style.overflow = 'hidden';\n        document.body.style.position = 'fixed';\n        document.body.style.width = '100%';\n        document.body.style.height = '100%';\n        \n        // Store the current scroll position\n        this.scrollPosition = window.pageYOffset;\n        document.body.style.top = `-${this.scrollPosition}px`;\n      }\n    } else {\n      this.container.classList.remove('expanded');\n      this.container.classList.add('collapsed');\n      if (this.isMobile) {\n        // Restore scrolling and position\n        document.body.style.overflow = '';\n        document.body.style.position = '';\n        document.body.style.width = '';\n        document.body.style.height = '';\n        document.body.style.top = '';\n        \n        // Restore scroll position\n        window.scrollTo(0, this.scrollPosition);\n      }\n    }\n  }\n\n  injectIframeStyles() {\n    const iframe = this.container.querySelector('.text-chat-widget-iframe');\n    const styles = `\n      ._chatContainer_1dfai_1 {\n        width: 100% !important;\n        height: 100% !important;\n        max-width: 100% !important;\n        max-height: 100% !important;\n        margin: 0 !important;\n        padding: 0 !important;\n        border: none !important;\n        border-radius: 0 !important;\n      }\n    `;\n\n    try {\n      const styleElement = document.createElement('style');\n      styleElement.textContent = styles;\n      iframe.contentDocument.head.appendChild(styleElement);\n    } catch (e) {\n      // If direct injection fails due to same-origin policy, use message passing\n      iframe.contentWindow.postMessage({\n        type: 'INJECT_STYLES',\n        styles: styles\n      }, '*');\n    }\n  }\n\n  setupMessageListener() {\n    window.addEventListener('message', (event) => {\n      console.log('Message received:', event.data);\n      \n      // If the iframe is requesting style injection\n      if (event.data.type === 'READY_FOR_STYLES' && this.iframeLoaded) {\n        this.injectIframeStyles();\n      }\n    });\n  }\n}\n\nwindow.TextChatWidget = TextChatWidget;\n// # prevent caching of iframe file\n// location /demo/chat/iframeChat_text.js {\n//     expires off;\n//     add_header Cache-Control \"no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0\";\n// }"],"names":["TextChatWidget","_createClass","_this","this","config","arguments","length","undefined","_classCallCheck","agentId","widgetDomain","iframeDomain","position","isExpanded","isMobile","test","navigator","userAgent","window","innerWidth","addEventListener","document","querySelector","viewport","createElement","name","content","getElementsByTagName","appendChild","iframeLoaded","init","setupMessageListener","key","value","_this2","styles","concat","container","className","innerHTML","toggleWidget","styleSheet","textContent","head","body","injectIframeStyles","classList","remove","add","style","overflow","width","height","scrollPosition","pageYOffset","top","scrollTo","iframe","styleElement","contentDocument","e","contentWindow","postMessage","type","_this3","event","console","log","data"],"mappings":"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"}